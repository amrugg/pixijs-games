<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Direction ship</title>
</head>
    <style>* {padding: 0; margin: 0}</style>
    <script src="pixi/pixi.min.js"></script>
    <script src="usefulFunctions.js"></script>
<body>
  <script type="text/javascript">
    "use strict";
    
    var params = getParams();
    function getParams() {
      var params = {};
      location.search.substr(1).split("&").forEach(function(el) {
        var data = el.replace(/\+/g, " ").split("=");
        params[decodeURIComponent(data[0])] = data[1] ? decodeURIComponent(data[1]) : true;
      });
      return params;
    }
    PIXI.utils.skipHello();
    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;
    let Application = PIXI.Application,
        Container = PIXI.Container,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        TextureCache = PIXI.utils.TextureCache,
        Sprite = PIXI.Sprite,
        Rectangle = PIXI.Rectangle,
        Graphics = PIXI.Graphics;
    let app = new Application({ 
        width: 800,
        height: 800,              
        antialias: true,
        transparent: true,
        resolution: 1
      }
    );
    app.renderer.backgroundColor = 0x55DD55;
    /// Fill the screen 
    app.renderer.view.style.position = "absolute";
    app.renderer.view.style.display = "block";
    app.renderer.autoResize = true;
    app.renderer.resize(window.innerWidth, window.innerHeight);
    document.body.appendChild(app.view);
    var spritesToAdd = [];
    var namesToAdd = ["ui/prepare.png", "ui/heal.png", "ui/move.png", "ui/sleep.png", "ui/moves.png", "characters/elmer.png", "characters/shadow.png", "characters/iger.png", "ui/gather.png", "ui/nut.png", "ui/uno.png",
    "ui/attack.png", "houses/chesselnut.png", "houses/elmer.png", "houses/wooly.png", "houses/spot.png", "houses/kit.png", "houses/plata.png", "houses/humber.png", "houses/shadow.png", "ui/next.png", "characters/ion.png", "characters/igeron-king.png", 
      "characters/chesselnut.png", "characters/eleanor.png", "characters/kit.png", "characters/spot.png", "characters/humber.png", "characters/plata.png", "houses/cave.png", "houses/cavel.png", "houses/caver.png", "ui/sun.png", "ui/food.png", "ui/ability.png"];
    
    var landscape = ["apple.png", "bamboo.png", "flower2.png", "flower3.png", "flower.png", "forest2.png", "forest.png", "grass.png", "honey.png", "nut.png", "water.png", "forest3.png", "cattails.png","path.png", "mustard.png",];
    var landscapeSeasonPrime = [184, 150, 92, 92, 92, 185, Infinity, Infinity, 135, 184, 285, 184, 214, Infinity, 123];
    var landscapeFoodMax = [12,8,6,6,6,0,0,0,15,12,0,0,10,0,5];
    var landscapeSeasonEnd = [224, 180, 150, 150, 150, 258]
    var day = 1;
    var food = 50;
    var general = "Eleanor";
    for(let i = 0; i < namesToAdd.length; i++) {
        spritesToAdd.push("sprites/civ/" + namesToAdd[i]);
    }
    for(let i = 0; i < landscape.length; i++) {
        spritesToAdd.push("sprites/civ/landscape/" + landscape[i]);
        spritesToAdd.push("sprites/civ/landscape/fall/" + landscape[i]);
        spritesToAdd.push("sprites/civ/landscape/winter/" + landscape[i]);
    }
    loader.add("sprites/civ/characters/wooly.png").add(spritesToAdd).load(setup);
    var state;
    var keys = {};
    var mouseX,mouseY;
    var boardPieces = new PIXI.Container();
    var forceNextTurnButton;
    var boardLandcapeState = [[7,11,7,7,11,7,11,6,6,6,6,7,7,11,11,6,11,11,11,11,11,6,11,11,7,7,7,6,6,11,7,11,7,6,11,11,11,11,11,11,6,11,7,6,11,11,6,11,6,11,11,11,11,7,11,6,7,11,6,7,6,7,11,11,11,6,11,7,11,11,6,11,11,7,7,6,11,11,11,11,6,11,11,7,6,11,11,11,11,6,7,6,6,11,11,6,6,11,6,6],[11,11,7,7,11,11,6,7,7,11,7,11,11,7,11,11,11,6,7,6,11,7,6,7,11,7,11,11,11,11,11,11,6,11,7,7,7,7,11,6,6,7,6,6,6,7,11,11,7,6,7,11,7,6,7,11,11,6,6,11,6,7,6,11,6,11,6,6,11,6,6,11,11,7,6,11,11,7,11,6,11,11,11,11,7,6,6,6,6,7,11,6,11,6,7,6,11,6,6,11],[7,6,6,11,6,11,11,11,11,6,6,6,7,11,11,6,7,11,11,7,11,7,11,11,11,11,7,7,11,6,6,11,11,6,11,6,7,11,11,6,7,11,11,11,11,7,7,7,6,11,7,7,7,11,6,6,7,6,6,11,11,11,7,11,11,6,11,11,11,11,11,11,7,6,11,7,11,11,11,6,6,7,7,6,11,11,6,6,7,7,7,11,11,11,11,7,6,11,11,11],[11,11,6,6,6,11,11,6,11,11,11,11,6,11,11,6,6,6,11,11,11,7,7,7,11,7,11,6,7,11,11,11,11,11,6,11,6,6,7,7,11,11,11,6,6,7,6,7,6,11,6,11,7,11,6,6,11,11,6,7,7,6,7,7,11,6,11,11,11,11,6,11,11,7,11,7,6,11,11,11,11,11,6,11,11,6,11,11,6,11,7,11,11,7,11,11,7,7,6,11],[11,6,11,7,11,11,7,11,11,11,11,7,11,6,6,7,11,7,6,11,7,11,6,11,11,11,11,7,6,11,6,11,7,6,7,7,11,6,7,11,11,6,6,7,11,11,7,11,7,6,7,11,11,6,7,6,11,11,11,11,6,7,11,6,11,11,11,6,11,11,11,11,11,11,6,7,6,11,11,6,7,6,11,11,6,11,11,7,11,7,7,6,6,11,7,11,11,6,11,11],[7,7,6,7,11,7,6,11,6,7,6,7,11,6,6,11,11,7,7,7,7,11,11,6,11,6,7,11,11,11,11,7,7,6,7,11,11,11,7,6,6,11,11,6,11,6,6,11,6,6,7,11,11,6,11,7,6,7,11,6,11,6,11,7,6,7,6,11,6,11,11,7,11,11,11,7,7,7,11,11,11,7,11,7,11,11,7,11,7,11,6,11,7,7,11,11,6,6,11,11],[6,6,7,11,11,11,7,6,7,7,11,11,7,6,7,11,6,11,11,6,11,11,6,11,6,6,7,11,11,7,11,11,7,7,6,11,7,6,11,11,11,6,6,11,7,11,6,6,7,7,7,11,6,6,6,6,11,6,7,11,7,7,7,6,6,11,11,11,11,7,6,11,7,11,6,11,11,7,6,6,11,6,11,6,6,11,11,11,7,11,7,11,11,11,11,6,11,6,11,6],[6,6,11,11,11,6,7,7,11,11,11,11,11,11,6,11,11,7,11,11,11,7,7,7,11,11,11,6,6,11,11,11,6,11,11,11,7,11,11,11,6,11,6,11,11,11,6,11,7,11,7,11,11,6,6,11,6,7,7,7,11,11,11,6,6,11,11,11,7,7,7,6,11,7,6,6,11,7,6,7,7,11,7,11,7,7,6,6,7,7,11,11,6,6,7,6,6,11,11,6],[6,11,6,11,6,6,11,11,6,6,7,11,6,7,11,11,6,6,6,11,7,6,11,11,7,11,11,11,11,11,6,6,11,6,7,7,6,11,11,7,7,6,6,6,6,11,11,6,11,7,11,6,11,11,7,6,11,11,11,11,11,7,6,11,11,6,11,7,6,6,7,7,11,6,6,11,6,11,7,6,11,6,6,7,7,11,11,11,11,11,6,11,7,6,11,6,11,11,11,6],[7,7,7,11,11,11,7,7,7,11,11,6,6,11,7,11,7,6,7,11,11,11,6,11,11,6,6,11,6,7,7,11,6,6,6,6,11,11,6,7,11,6,11,11,7,11,11,11,11,11,6,6,11,7,11,11,6,6,6,7,11,11,11,11,7,11,6,6,7,6,6,11,11,11,7,11,6,11,11,7,7,11,11,6,11,6,11,11,11,11,11,6,11,7,7,7,6,6,7,6],[6,7,6,11,6,11,6,11,6,6,6,6,11,11,11,11,6,11,6,6,11,7,7,11,11,11,11,6,6,11,11,6,6,7,11,6,11,11,7,7,7,7,11,7,7,11,7,7,7,6,11,6,11,6,11,6,11,6,11,11,11,7,6,11,11,11,11,7,7,7,11,11,6,11,7,11,11,6,11,11,6,11,11,6,11,7,11,11,11,11,11,6,6,6,6,7,11,6,6,11],[11,11,11,6,6,7,6,7,11,11,11,6,11,11,6,6,11,11,6,11,11,6,7,11,11,11,11,11,11,6,6,11,7,6,6,11,6,11,6,11,6,6,11,11,11,6,11,6,11,11,11,6,7,11,6,11,11,11,6,7,11,6,11,11,11,6,11,7,11,11,11,6,7,11,11,11,11,11,11,7,7,6,11,11,11,6,6,11,6,7,7,6,6,11,6,7,6,7,7,7],[11,7,6,6,6,11,7,7,7,6,11,11,6,7,7,11,6,7,11,6,6,7,11,11,11,7,11,11,11,11,11,11,6,7,11,6,11,6,11,11,11,11,11,11,6,7,11,11,6,7,6,7,7,11,7,6,6,7,6,11,7,6,11,11,6,6,11,7,6,11,11,11,6,11,11,11,7,11,6,11,11,11,6,11,7,7,6,11,11,11,11,6,7,11,11,7,6,6,6,6],[6,7,6,7,11,11,11,11,11,7,11,6,11,11,11,11,6,6,11,7,11,6,11,6,6,7,11,11,11,6,11,6,11,7,11,11,6,11,6,11,6,11,7,11,11,11,6,7,11,11,6,6,11,7,7,7,7,6,11,11,6,11,11,11,7,11,6,11,11,11,6,6,11,6,6,11,6,6,11,11,6,6,7,11,11,6,11,7,6,7,11,11,6,7,11,11,11,7,6,6],[7,6,11,11,11,11,6,6,6,11,7,7,7,7,6,11,11,6,11,7,7,11,11,11,6,7,6,7,11,6,6,11,6,7,7,6,11,7,6,7,6,6,11,11,6,7,11,6,11,11,7,11,11,6,11,6,7,11,6,11,7,6,6,11,11,6,11,6,11,6,7,11,7,11,6,7,11,11,11,11,7,6,11,6,6,6,7,7,6,7,6,7,11,11,7,6,11,6,7,7],[6,7,6,6,11,7,11,11,7,11,11,11,11,11,6,11,6,11,11,11,6,7,7,11,7,11,7,11,6,11,7,11,7,6,6,6,6,11,6,7,7,11,6,7,6,11,6,7,7,6,11,11,6,7,11,7,6,6,11,11,11,11,6,11,6,11,11,6,7,7,11,11,11,11,11,7,6,6,7,11,11,6,11,11,6,11,7,11,11,6,6,11,6,11,11,6,6,11,11,7],[7,11,7,11,11,11,6,6,11,6,6,7,6,7,11,11,7,7,7,7,7,6,11,11,11,7,11,6,7,11,6,11,6,11,11,6,11,11,6,11,7,11,6,6,6,11,6,7,7,7,11,7,6,11,11,6,11,6,7,11,6,11,6,11,6,7,11,7,6,11,6,11,7,6,6,11,11,11,11,7,11,6,6,6,6,11,6,7,6,7,11,11,11,6,11,7,11,11,6,6],[6,6,11,6,11,11,11,7,11,6,6,7,11,11,6,11,7,6,11,11,11,7,6,11,11,11,11,11,11,7,7,11,7,11,7,11,6,7,11,11,6,11,6,6,6,11,6,11,11,11,11,11,7,11,6,11,11,6,11,11,7,7,6,11,7,11,7,11,6,6,11,6,6,6,11,11,11,6,11,6,6,7,11,7,7,6,6,7,11,11,11,6,7,7,7,11,7,6,6,11],[6,11,11,11,11,7,6,11,6,11,6,6,11,6,11,11,11,7,6,6,11,11,11,7,11,6,7,11,11,7,11,7,7,11,6,11,11,6,6,11,11,11,6,11,11,7,6,7,11,11,7,11,6,11,11,7,6,7,6,7,11,11,6,6,6,6,6,6,11,11,11,11,11,7,11,11,6,6,7,7,11,11,6,7,11,11,7,7,7,11,11,6,11,11,7,11,11,6,6,11],[6,11,7,7,6,11,6,6,11,11,6,6,11,6,7,6,11,6,6,6,11,7,11,6,6,6,6,11,11,11,11,11,11,11,11,6,7,11,6,11,11,11,6,7,6,11,6,11,6,11,6,11,6,7,11,11,6,7,7,11,6,11,11,11,11,6,11,11,7,6,11,11,6,6,6,7,6,6,6,6,11,11,11,6,11,7,11,11,11,6,6,6,7,6,7,11,7,6,7,11],[11,11,7,11,11,7,11,11,7,11,7,6,6,6,6,7,6,6,11,11,7,6,11,6,7,11,11,11,6,11,11,6,6,6,11,6,6,6,7,6,11,6,6,7,6,11,7,6,7,6,11,6,6,11,11,11,11,7,11,7,7,11,6,7,11,6,11,7,6,11,6,11,7,6,6,6,6,6,11,7,11,11,11,7,7,11,11,7,11,11,11,7,6,6,11,11,11,11,7,6],[11,6,11,11,6,11,6,7,7,6,11,6,11,11,6,6,11,6,6,6,11,11,6,6,7,6,11,7,6,7,6,11,7,11,11,7,11,6,6,11,7,6,11,11,7,6,11,6,11,11,6,6,6,7,7,7,11,11,7,11,6,7,6,11,7,6,6,6,6,11,11,11,6,6,11,11,11,6,6,6,6,11,7,6,11,11,11,6,11,11,6,6,11,7,6,11,6,11,11,6],[7,11,7,7,7,6,7,11,11,11,11,6,7,11,6,11,6,6,7,11,11,6,11,11,6,6,11,7,7,7,11,6,11,11,11,6,11,6,6,11,11,7,11,7,7,7,6,11,11,6,11,11,11,11,6,11,11,6,11,7,6,6,11,11,7,11,11,6,6,11,6,6,7,11,11,11,11,6,7,6,7,6,6,6,11,6,7,6,7,6,6,7,7,6,6,11,11,11,7,6],[6,6,11,11,11,11,11,6,6,7,7,11,11,6,6,6,7,11,11,7,7,6,6,11,11,6,7,6,6,6,11,7,6,6,11,11,11,6,11,11,6,11,11,6,7,11,11,11,6,6,11,11,11,7,11,7,11,11,6,7,7,11,6,11,11,7,11,11,11,11,7,11,11,11,11,11,7,6,11,6,11,11,7,11,11,11,11,11,7,11,6,11,11,11,11,11,6,11,11,11],[11,11,6,11,6,6,11,11,7,6,11,7,6,6,6,6,11,7,7,11,11,11,7,6,6,7,11,11,7,6,11,6,11,6,7,11,11,6,6,7,6,11,6,11,6,7,6,11,6,11,11,6,6,11,11,6,7,6,6,6,11,7,11,11,11,11,11,11,11,11,11,11,6,11,6,6,7,6,11,6,11,6,7,11,11,7,6,11,11,7,6,11,6,11,11,11,7,6,6,7],[7,11,6,7,7,11,6,11,11,11,6,11,6,11,6,6,6,11,6,11,7,7,6,11,11,6,7,7,11,6,11,11,11,11,7,7,11,6,11,11,6,11,11,11,6,11,11,7,7,7,7,11,11,11,11,11,11,11,6,11,6,11,11,11,11,11,6,6,11,11,11,6,11,6,6,6,11,7,11,6,7,6,11,11,7,11,6,11,7,11,7,11,11,11,11,11,11,11,6,11],[11,11,6,7,6,11,11,7,11,7,11,11,11,11,11,6,6,11,11,6,7,11,11,6,7,6,7,11,11,6,11,11,11,11,11,7,11,6,11,6,6,11,11,11,11,11,11,6,11,11,11,6,6,6,11,7,11,11,11,7,11,7,11,7,6,6,6,11,11,11,7,11,6,11,6,11,11,11,6,11,11,7,11,6,6,6,11,11,11,11,7,11,11,6,11,11,6,7,11,7],[11,6,6,11,6,7,11,7,7,7,11,6,7,11,11,11,6,11,7,7,6,11,11,6,11,6,7,6,6,6,6,7,11,7,11,6,11,6,6,7,11,6,11,6,7,11,11,6,11,11,6,11,7,7,6,11,11,11,6,7,11,11,11,6,6,7,7,6,11,11,7,6,11,7,7,6,7,11,6,11,11,11,11,7,6,7,6,6,11,7,11,11,11,11,11,11,11,6,11,7],[11,11,11,11,6,11,11,11,6,7,11,6,11,11,6,11,6,7,11,7,11,6,6,7,11,7,7,11,11,6,6,7,11,11,11,6,11,11,6,11,6,6,7,11,7,11,11,11,11,11,7,11,6,6,7,11,7,7,11,11,11,7,11,6,11,6,7,7,7,6,6,6,6,11,7,7,11,11,11,11,7,6,6,7,11,11,7,6,11,11,11,11,11,6,11,11,6,7,11,11],[11,11,11,11,11,6,7,6,11,11,11,6,7,6,11,11,11,11,7,11,11,11,6,6,7,11,7,7,11,6,7,11,11,7,6,11,7,6,11,7,11,6,6,11,11,7,6,6,11,11,7,7,11,6,11,6,11,11,11,6,6,6,6,6,11,11,6,7,7,6,6,6,6,11,11,11,7,6,11,11,11,6,11,11,6,11,6,11,11,11,11,7,7,11,7,7,7,11,11,6],[6,6,11,7,6,7,11,11,11,7,11,11,11,11,6,11,7,6,7,11,11,11,11,6,7,6,7,11,11,7,11,11,6,6,11,6,7,11,11,7,6,7,6,6,11,6,11,6,11,11,11,11,7,11,6,11,11,11,7,11,11,6,11,6,6,11,6,7,7,11,11,7,11,11,11,11,11,6,7,7,7,7,6,6,11,7,11,11,7,7,6,7,7,6,6,11,11,6,11,6],[11,6,11,11,6,11,6,11,7,11,11,6,11,7,11,7,7,7,11,11,11,11,7,11,6,11,6,11,11,6,7,11,6,11,11,6,11,7,11,11,11,11,7,11,11,7,11,6,6,6,11,7,11,7,7,6,11,11,7,6,6,6,11,7,6,11,6,7,6,11,11,6,11,7,6,6,11,11,11,6,6,6,7,11,11,11,11,11,11,11,7,11,6,6,7,11,7,6,11,6],[11,6,6,6,11,11,11,11,6,6,11,7,11,11,6,11,7,7,6,6,7,6,11,11,11,11,7,11,11,11,11,7,6,6,11,11,11,6,11,6,6,11,7,11,11,11,11,6,6,6,11,11,6,6,11,11,11,7,6,11,6,11,11,11,11,11,6,11,11,11,6,7,11,6,6,11,6,11,11,7,11,6,11,6,11,6,6,11,6,6,11,11,11,11,11,6,7,11,6,11],[11,11,11,11,6,11,6,11,11,11,7,11,7,11,11,7,6,6,11,6,6,7,11,6,11,7,7,11,6,11,6,11,7,11,11,11,11,11,11,7,11,6,11,11,6,6,6,11,11,7,6,6,7,6,6,7,11,11,6,11,11,11,11,7,7,11,11,11,11,7,6,11,11,6,7,11,6,11,7,11,7,6,11,11,7,11,6,7,7,6,11,11,11,11,11,11,11,11,11,6],[6,6,11,6,11,11,6,11,11,6,11,6,11,11,6,6,11,7,7,7,11,6,6,7,11,11,11,7,6,11,11,6,11,11,6,11,11,11,11,11,11,6,11,7,11,11,11,11,6,11,6,11,7,6,11,11,11,11,7,7,6,11,7,11,7,7,11,11,6,11,7,11,11,11,11,7,11,7,6,11,11,6,6,11,6,11,11,6,11,6,7,7,11,6,6,11,7,11,11,11],[11,6,11,6,11,11,11,6,7,6,11,7,11,6,7,11,11,6,11,6,7,11,6,11,11,6,7,7,6,6,11,7,7,11,6,11,11,6,6,7,7,7,6,11,11,6,11,7,6,11,11,6,11,6,11,6,7,6,11,11,7,7,11,11,7,11,11,11,11,6,11,6,6,6,6,11,11,11,6,11,7,11,11,11,11,6,7,6,11,11,11,11,7,6,6,11,11,11,6,11],[11,11,11,11,7,7,11,11,11,7,11,6,6,7,11,11,11,11,6,7,7,6,6,11,7,11,11,7,6,11,11,6,11,6,6,11,11,6,6,11,11,7,11,11,11,6,6,7,11,11,11,11,6,11,6,11,7,7,7,7,6,11,11,6,6,11,7,11,6,11,11,11,11,11,6,7,7,7,11,6,11,11,11,11,11,7,6,6,11,7,11,6,6,11,6,7,11,6,6,6],[11,6,11,11,11,11,6,6,11,6,11,11,11,6,6,11,6,11,11,6,11,6,6,7,7,11,11,11,11,6,11,7,11,7,11,7,11,11,11,7,11,6,11,11,6,11,11,7,6,11,6,11,11,6,11,6,11,11,11,11,7,7,0,11,6,11,11,7,11,7,11,6,6,6,11,11,11,11,6,7,11,11,6,11,7,7,6,6,6,11,11,7,6,6,11,11,11,11,6,6],[7,6,11,6,6,11,11,7,11,11,11,6,11,11,6,11,11,11,11,6,6,7,6,7,11,7,6,6,11,11,6,11,6,11,7,6,11,11,7,11,7,11,7,11,11,11,11,11,6,11,7,6,6,6,11,11,6,6,11,7,7,11,6,6,6,6,7,11,6,6,6,11,11,7,7,11,11,6,11,11,7,11,6,7,7,6,11,11,11,11,11,11,11,6,7,6,11,7,7,7],[11,11,11,11,11,6,6,6,7,6,11,6,6,6,11,7,11,11,6,11,6,6,6,11,11,6,7,11,6,6,11,6,7,6,7,6,6,11,7,11,11,11,6,7,6,11,11,6,11,6,6,11,7,11,11,11,6,11,6,11,7,11,7,6,6,6,6,7,11,11,11,6,6,7,6,11,11,11,11,6,6,11,11,11,6,6,11,6,7,11,11,6,11,11,11,11,7,11,11,7],[7,11,6,7,6,6,11,7,6,7,11,7,11,6,11,7,6,11,6,7,11,6,6,6,11,11,11,6,11,7,6,7,11,11,7,6,7,7,6,6,6,7,6,7,7,11,11,11,11,11,11,11,6,6,11,7,11,11,7,11,6,6,6,11,11,7,11,11,11,7,11,6,11,6,11,11,11,7,11,11,11,11,6,6,6,11,11,11,7,11,6,11,7,11,6,7,11,11,11,6],[11,6,6,6,6,6,6,11,11,11,7,7,7,11,6,6,6,11,7,6,11,11,11,11,7,11,7,11,11,11,6,7,11,6,6,6,11,7,7,6,6,6,6,7,6,11,11,11,11,11,11,11,6,11,11,7,7,6,6,11,6,11,11,11,7,11,11,6,11,11,6,11,7,11,6,11,7,11,6,7,11,11,6,7,11,11,11,11,11,6,6,11,11,11,6,6,6,6,11,6],[11,11,11,6,11,11,11,6,11,11,6,11,7,11,6,7,11,11,11,7,7,6,11,7,11,6,11,11,11,11,11,11,11,11,6,11,11,11,11,11,7,11,7,11,7,11,11,6,11,7,6,11,7,6,11,7,11,6,11,6,7,11,6,11,6,11,11,11,11,11,11,11,11,6,11,11,11,11,11,6,11,11,6,11,11,6,6,6,6,11,11,6,11,11,7,11,7,6,6,11],[11,11,6,7,11,6,11,7,11,7,6,11,11,11,6,6,11,7,6,6,7,11,11,7,7,7,11,11,11,7,7,11,11,7,11,11,7,6,7,6,6,7,6,11,11,6,11,7,11,11,7,11,11,6,6,7,11,7,6,7,11,11,11,6,7,11,6,11,11,6,11,6,11,6,6,6,6,7,6,11,11,7,11,11,6,6,11,6,6,11,11,7,11,11,11,6,6,6,7,11],[7,11,11,7,11,11,6,11,11,7,7,11,11,11,11,11,7,7,11,7,11,11,11,6,6,11,11,11,7,11,6,7,6,11,7,7,11,11,7,6,11,11,11,11,7,6,7,11,7,11,7,7,6,6,11,7,6,11,11,11,11,11,11,11,11,7,11,6,7,7,7,6,7,11,7,11,6,7,6,11,11,6,7,11,7,11,7,7,6,11,11,7,7,6,11,11,11,6,11,11],[11,7,7,11,11,11,6,11,6,11,11,11,7,11,7,11,7,11,11,11,6,11,11,7,11,7,6,6,11,11,11,11,11,11,11,7,11,11,11,11,6,7,11,11,7,11,11,7,6,7,6,11,11,7,11,11,6,6,6,11,11,11,11,6,6,7,11,6,7,11,6,11,11,11,11,11,11,6,6,6,11,11,11,11,11,11,11,11,11,7,11,7,11,6,11,11,11,11,11,6],[6,11,11,7,6,11,11,6,6,11,6,7,11,7,11,11,11,7,7,11,11,11,11,11,11,7,7,11,11,11,6,6,11,11,11,11,11,7,11,11,6,6,6,11,11,6,11,11,11,11,7,6,7,6,6,7,6,11,11,11,11,6,11,6,11,11,11,11,6,7,6,6,6,6,11,6,11,11,6,6,11,11,7,11,11,7,11,11,11,7,6,6,7,11,11,11,7,11,11,11],[11,6,6,11,6,7,11,6,11,11,6,7,11,11,6,11,11,6,11,11,11,6,6,7,6,6,7,11,7,11,11,6,11,7,6,6,6,11,7,11,11,11,11,6,6,11,11,11,6,11,6,11,11,11,11,11,7,7,11,11,7,6,11,11,11,7,11,11,11,6,11,7,11,7,6,11,11,11,6,7,11,11,11,11,6,11,11,7,11,11,11,7,7,6,11,11,11,6,11,11],[11,6,7,6,6,11,6,6,7,6,7,6,11,7,7,7,6,11,11,6,11,11,7,11,11,6,6,11,7,11,11,6,7,6,11,11,11,6,6,11,6,11,11,11,7,11,6,11,11,6,11,7,11,11,7,7,11,6,11,6,11,11,7,11,7,6,7,11,11,6,11,11,7,7,7,6,11,7,11,6,6,11,6,6,11,7,11,7,6,11,6,11,11,7,11,11,7,6,7,7],[10,10,10,10,12,12,12,12,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,10,10,10,10,10,12,12,12,12,10,10,10,10,10,10,10,10,12,12,12,12,10,10,10,10,10,10,10,10,12,12,10,10,10,10,10,10,10,10,10,10,10,12,12,10,10,10,10,10,12,12,12,12,10,10,10,10,10,10,10,10,10,12,12,12,12,10,10,10,10,12,12,13,12,12,10],[10,12,12,10,10,10,10,10,12,12,12,12,12,12,12,10,10,10,10,12,10,10,10,10,10,10,10,10,10,12,10,10,12,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,10,10,10,10,12,12,12,12,12,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,10,10,10,10,10,10,12,12,12,12,10,12,12,12,12,10,10,12,12,13,12,12,10],[7,7,7,6,7,7,7,7,7,7,7,9,7,7,2,7,7,7,7,7,7,7,6,7,7,7,0,7,7,7,7,0,7,7,5,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,7,6,3,5,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7],[7,7,7,7,7,9,7,5,7,7,7,7,7,7,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,7,6,7,7,7,7,7,7,5,5,5,5,5,5,5,5,5,5,5,7,7,7,7,7,7,7,7,7,5,5,7,7,7,5,7,7,7,7,7,7,7,7,7,5,9,7,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,3,7,7,7,7,7,5,7,7,0,7,5,7,7,5,7,7,7,7,7,7,7,7,7,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,7,5,0,0,0,0,0,0,7,5,7,7,7,7,7,3,2,4,3,4,7,7,7,7,7,0,7,7,7,0,7,7,7,7,7,4,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,2,7,7,7,7,7,7,9,5,7,5,4,7,5,2,5,7,5,7,5,7,0,0,0,5,0,5,0,7,5,7,7,7,7,7,2,3,3,3,3,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,7,7],[7,7,7,7,7,7,14,14,14,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,9,9,7,7,7,6,7,7,7,0,4,5,7,5,7,0,5,0,0,0,0,5,7,5,7,7,5,5,7,2,3,7,2,2,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,14,7,7,8,14,14,14,7,7,7,7,7,7,7,7,5,7,7,0,5,7,7,7,0,7,8,8,5,7,6,7,7,0,2,7,7,5,7,5,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,4,2,2,4,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,14,14,14,14,14,14,14,7,0,7,7,8,7,7,7,7,7,7,7,7,7,7,9,6,0,7,7,7,7,7,7,7,7,0,0,7,7,7,5,7,1,1,1,1,1,1,1,7,5,7,7,7,7,7,2,3,3,2,4,7,7,7,7,7,0,7,7,7,0,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,3,7,7,7,7,7,7,7,7,7,7,5,7,7],[7,6,14,14,14,14,14,14,14,7,5,7,7,7,7,7,7,5,7,6,7,7,7,9,6,7,0,7,7,7,7,4,7,9,0,7,7,7,7,7,5,7,1,1,1,1,1,1,1,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,6,7,7,6,7,7,7,7,0,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,9,7,7,3,7,7,5,7,7,7,1,1,1,7,7,7,5,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,4,7,0,0,7,7,7,5,6,7],[7,7,9,9,8,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,5,7,7,7,6,7,7,7,7,7,8,7,5,6,7,7,5,7,5,7,7,7,7,7,7,7,7,7,5,7,7,5,5,0,5,5,0,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,4,6,7,7,7,7,7,7,7,8,0,0,7,7,5,7,9,6,9],[7,7,9,9,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,5,5,5,5,7,7,7,5,5,5,5,7,7,5,0,0,0,0,5,7,5,7,7,7,7,7,7,7,7,7,6,7,7,7,9,9,7,7,7,2,2,7,4,7,2,7,7,5,7,7,7,0,0,0,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,4,6,7,6,7,7,7,7,7,7,7,7,7,7,9,9,7,7,7,7,5,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,7,0,0,0,5,7,7,7,7,7,7,7,7,7,5,7,3,7,7,7,7,7,7,3,7,7,2,7,7,7,7,7,7,7,7,7,7,0,7,7,7,7,5,7,7,7],[7,6,7,7,7,6,7,7,7,7,7,7,7,7,7,6,7,7,6,0,7,7,7,0,0,7,7,9,9,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,5,0,0,6,0,7,7,7,7,7,8,7,7,7,7,7,8,7,7,7,6,7,7,7,9,5,7,7,7,4,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,8,7,7,7,7,4,7,7,7,7,4,7,7,7,0,0,7,7,7,9,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,9,8,0,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,7,7,7,6,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,4,4,7,7,7,7,6,3,7,7,7,9,7,9,7,7,7,7,7,0,0,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,5,5,7,7,9,7,7,7,7,2,6,3,6,7,7,7,7,7,7,7,7,7,7,7,2,7,7,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,5,7,8],[7,8,7,4,4,3,4,4,4,2,3,3,7,7,7,7,9,9,7,7,7,0,7,7,7,7,8,7,7,7,7,7,7,7,7,7,9,2,7,7,0,7,7,7,7,7,7,7,7,7,7,7,7,0,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,3,4,2,2,4,2,3,7,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,0,7,7,7,7,7,5,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,7,7,7,7,7,7,7,7,7,7,5,7,7,0,6,7,7,7,7,0,7,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5],[7,7,8,7,2,3,3,2,4,3,4,7,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,5,7,7,6,7,7,7,6,3,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,0,9,7,7,8,7,9,7,7,8,7,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4],[7,7,7,2,4,3,2,2,3,3,4,7,7,7,7,7,7,7,8,7,7,7,7,7,7,7,5,7,7,5,7,7,7,7,7,2,7,7,7,9,7,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,7,5,0,7,6,5,9,8,9,7,7,2,7,7,7,7,7,7,7,7,7,7,1,7,6,7,7,7,7,7,7,7,7,7,7,7,2,7,7,7,7,8],[7,7,7,2,4,3,2,2,4,4,7,7,6,7,6,7,7,7,7,7,7,7,7,7,9,7,7,7,7,6,6,7,5,7,7,7,2,7,7,7,7,7,7,4,7,7,7,7,7,7,7,9,7,7,7,7,7,0,7,7,7,7,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,7,6,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,6],[7,7,8,7,7,3,3,7,7,9,7,7,7,7,7,7,8,7,7,7,7,7,7,9,7,7,7,7,7,7,7,7,7,5,7,5,0,5,7,7,9,7,7,7,7,1,7,7,7,3,7,7,5,7,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,7,7,7,7,7,7,7,7,7,7,5,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,5,7,7,5,2,1,7,7,7,7,7,7,9,9,7,7,7,7,7,7,8,7,7,7,7,0,0,0,7,5,7,7,7,7,1,1,1,7,7,7,6,7,7,7,7,6,7,7,7,7,5,7,7,7,2,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,9,7,7,7,7,6,5,7,7],[7,7,7,7,8,0,0,5,7,7,7,7,7,7,7,5,1,7,7,1,1,7,8,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,0,7,7,7,7,7,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,5,7,3,7,7,5,7,7,7,7,2,2,7,7,7,7,7,7,7,7,7,7,7,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,8,6,0,7,0,0,0,0,7,7,7,5,7,7,7,7,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,7,5,7,7,7,7,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,5,7,7,0,7,7,7,7,7,7,7,7,7,9,7,7,7,8,7,7,4,7,7,7,7,7,6,7,7,7,7],[7,7,7,7,9,7,0,0,0,0,0,7,7,7,7,7,7,7,7,5,7,0,7,3,7,7,7,6,7,7,7,7,7,6,7,7,7,5,7,7,7,7,7,7,7,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,5,0,0,7,7,7,7,7,0,7,7,9,5,5,2,7,7,7,9,9,7,7,7,7,0,7,7,7,7,9,7,5,7,7,7,7,7],[7,7,7,7,7,7,7,0,0,0,6,5,7,7,7,7,7,7,7,7,7,2,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,5,7,8,1,7,1,1,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,2,7,0,7,7,7,7,7,7,7,7,7,7,9,9,9,7,7,7,7,7,7,5,7,7,7,7,4,7,7],[7,7,7,7,7,7,7,0,0,4,7,7,7,7,7,5,5,7,7,7,7,9,5,7,7,7,7,8,7,7,7,7,7,7,5,7,7,4,7,7,7,7,7,5,7,7,1,7,7,8,5,7,7,7,7,0,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,9,7,6,7,7,7,1,7,7,7,9,4,6,7,7,7,7,7,7,0,7,7,7,2,7,7,7,0],[7,7,0,7,7,7,7,7,7,7,4,7,7,7,7,7,5,7,6,7,7,7,7,7,7,7,7,7,7,7,0,7,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,7,7,3,7,7,0,7,8,7,4,7,6,7,0,7,7,9,9,7,7,7,9,7,7,7,7,7,7,7,6,7,1,7,7,9,7,7,7,7,7,7,7,7,7,0,7,7,7,5,7,7,7,5],[7,7,7,7,7,7,7,7,7,7,7,7,7,9,8,7,7,0,7,8,7,7,7,7,5,5,7,7,7,7,7,7,7,7,7,7,3,0,7,7,7,8,7,7,7,7,5,7,7,7,7,7,7,1,7,7,7,3,7,7,7,0,0,7,7,7,7,7,7,7,7,7,7,7,7,1,1,7,7,0,6,7,9,7,7,7,7,7,7,7,9,7,7,5,7,5,6,7,2,7],[7,7,7,8,7,7,7,8,7,7,7,7,7,7,6,7,9,7,7,7,5,6,7,7,7,7,7,7,7,7,7,7,6,7,7,5,3,0,7,7,7,3,5,5,7,7,6,7,7,7,3,7,7,7,7,7,7,0,7,7,8,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,7,5,7,7,7],[7,7,7,2,2,7,7,7,7,6,7,7,7,9,7,7,7,7,7,7,5,6,7,7,1,7,7,5,7,0,5,6,7,7,7,7,7,7,7,7,0,7,7,7,7,7,7,7,7,7,1,7,5,7,2,7,7,7,7,7,8,8,7,7,7,7,7,7,7,4,7,7,7,7,6,7,7,7,7,7,2,0,7,7,7,7,1,7,7,7,7,7,7,7,7,7,5,7,7,5],[7,7,5,7,7,7,7,4,0,7,7,7,7,7,7,7,7,7,7,7,2,7,6,0,2,7,5,7,7,3,8,7,8,7,7,7,5,7,7,8,7,0,7,7,9,4,9,9,9,1,5,7,7,7,7,4,7,7,7,7,7,7,7,7,8,7,7,1,4,5,7,7,7,7,7,7,7,7,7,7,7,0,7,7,7,7,1,7,7,2,7,7,6,7,7,4,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,2,7,7,7,7,7,6,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,7,7,6,6,0,0,6,4,7,7,9,7,5,7,7,7,1,7,4,7,7,7,7,7,7,7,7,7,7,7,1,9,7,7,7,7,7,7,7,7,7,7,7,7,0,7,7,7,7,7,7,5,7,3,7,1,6,7,9,6,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,7,7,7,7,7,7,7,7,0,7,5,7,7,7,3,7,6,7,7,7,7,7,7,3,7,7,7,7,9,9,7,8,7,7,8,7,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,7,7,7,7,7,0,7,7,7,7,7,7,7,8,5,7,7,7,7,6,7,7,9,7,0],[7,9,7,7,7,7,7,7,14,14,7,14,14,7,7,7,7,7,7,7,7,6,5,7,7,5,5,7,7,7,7,7,7,7,7,7,7,5,5,7,7,7,7,7,7,9,0,7,7,5,7,7,8,0,0,0,0,6,7,7,8,7,7,7,7,7,7,7,3,9,7,7,7,7,7,7,7,7,7,7,7,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,14,14,14,14,14,14,14,7,7,7,7,7,7,5,5,7,7,7,7,7,7,8,7,7,7,7,7,5,7,7,7,7,7,7,0,0,7,0,7,7,7,7,7,7,7,0,7,0,0,7,7,7,7,6,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,6,8,0,7,7,7,7,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,14,14,14,14,14,14,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,4,7,7,7,7,0,6,0,7,6,7,7,5,7,5,0,7,7,7,6,7,7,7,7,2,7,7,0,7,7,7,7,9,7,7,7,7,5,7,7,0,2,3,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,9,7,7,7,7,6,7,7,6,7,5,5,5,7,7,7,7,7,7,7,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,7,2,7,7,5,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,0,7,7,7,7,9,7,6,7,7,0,7,2,5,7,7,7,7,7,7,7,7,7,8,6,7,7,7,5,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,7,7,7,7,3,7,7,7,7,7,0,7,7,7,7,7,7,7,5,0,7,9,9,7,7,5,2,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,9,7,7,7,7,5,7,7,7,7,7,7,7,5,7,7,4,7,7,0,7,7,7,7,7,7,7,7,7,7,6,0,7,9,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,7,7,7,5,8,7,0,7,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,9,7,0,7,7,3,7,7,7,7,7,7,7,7,0,0,7,7,7,7,7,4,7,7,7,7,7,7,7,7,5,7,5,8,7,7,7,7,6,7,7,7,7,3,7,7,7,7,7,7,4,7,7,7,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,2,7,7,7,7,7,7,9,7,7,7,6,7,7,7,7,7,7,7,7,6,7,4,7,7,5,0,7,7,7,7,7,7,2,6,7,7,7,7,0,7,7,7,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,6,7,7,7,7,7,7,7,7,7,0,7,7,6,7,5,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,2,7,7,7,1,1,7,7,7,7,7,0,7,7,7,7,7,7,5,4,8,7,7,7,7,7,6,7,7,7,7,7,6,0,7,7,7,7,6,7,7,7,7,7,7,7,7,3,7,7,7,7,7,7,7,7,7,5,7,8,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,0,0,7,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,8,7,1,1,7,7,7,7,7,7,7,7,7,7,6,7,3,1,7,8,7,7,2,7,0,0,7,7,7,7,0,0,0,7,7,6,7,7,7,7,7,6,7,7,7,7,7,7,5,6,7,7,7,7,6,7,7,7,7,7,7,7,7,6,7,7,7,6,7,7,8,7,3,0,7,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[7,7,7,7,7,1,4,7,2,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,0,0,0,7,3,7,0,7,7,7,7,7,7,7,7,7,7,7,7,7,5,7,6,6,7,7,7,7,7,7,7,7,7,7,4,4,4,6,7,7,7,7,7,7,9,5,7,7,7,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,9,9,5,7,7,7],[7,8,7,4,6,1,1,7,7,7,4,6,7,7,7,9,9,7,7,7,7,7,7,7,7,7,7,7,7,0,7,0,8,0,0,0,7,7,7,5,7,7,7,7,5,7,7,7,7,7,7,7,7,7,4,7,7,7,7,7,7,7,2,2,2,7,7,7,7,8,7,7,6,7,7,7,7,7,9,7,7,7,7,7,7,7,7,7,7,7,7,5,9,9,5,9,9,5,5,7],[7,6,7,7,8,1,0,7,6,7,7,7,7,7,7,7,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,7,0,7,0,0,0,7,7,5,5,7,6,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,2,7,7,5,7,7,7,5,7,6,7,7,7,7,7,7,7,7,7,7,9,9,5,9,9,7,5,7],[7,3,7,7,3,7,7,9,7,7,7,7,7,7,3,7,7,7,7,7,7,0,7,7,7,7,7,7,7,5,0,7,0,0,7,7,0,0,7,7,5,5,7,5,7,7,6,7,2,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,7,7,7,7,7,7,5,7,7,6,7,7,7,7,7,7,0,7,7,9,9,9,7,7,9,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7]]
    /*for(let i = 0; i < 100; i++) {
        boardLandcapeState.push([]);
        for(let j = 0; j < 100; j++) {
            var rand = Math.random();
            if(i === 49 || i === 50) {
                boardLandcapeState[i].push(10);
            } else if(i < 49) {
                if(rand < 0.5) {
                    boardLandcapeState[i].push(11);
                } else if(rand < 0.8) {
                    boardLandcapeState[i].push(6);
                } else {
                    boardLandcapeState[i].push(7);
                }
            } else {
                var probabilities = [];
                var baseProbabilities = [5,1,3,3,3,10,10,150,5,5];
                var trendBonus = [50,50,5,5,5,3,3,20,3,33]
                /// Put things that can't be on this side last
                for(let k = 0; k < 10; k++) {
                    var extra = 0;
                    if(j !== 0) {
                        if(boardLandcapeState[i][j-1] === k) {
                            extra += trendBonus[k];
                        }
                        if(boardLandcapeState[i-1][j-1] === k) {
                            extra += trendBonus[k];
                        }
                    }
                    if(j !== 99) {
                        if(boardLandcapeState[i-1][j+1] === k) {
                            extra += trendBonus[k];
                        }
                    }
                    if(boardLandcapeState[i-1][j] === k) {
                        extra += trendBonus[k];
                    }
                    probabilities.push(baseProbabilities[k] + extra);
                }
                var sum = probabilities.reduce(function(a,b) {
                    return a+b;
                });
                var accumulator = 0;
                for(let k = 0; k < 10; k++) {
                    if(rand < probabilities[k]/sum + accumulator) {
                        boardLandcapeState[i].push(k);
                        break;
                    }
                    accumulator += probabilities[k]/sum;
                }
            }
        }
    }*/
    var projectile;
    var foodLandscapeState = [];
    for(let i = 0; i < 100; i++) {
        foodLandscapeState.push([]);
        for(let j = 0; j < 100; j++) {
            if(boardLandcapeState[i][j] === 0) {
                foodLandscapeState[i].push(randInt(4,8));
            } else if(boardLandcapeState[i][j] === 1) {
                foodLandscapeState[i].push(randInt(2,4));
            } else if(boardLandcapeState[i][j] > 1 && boardLandcapeState[i][j] < 5) {
                foodLandscapeState[i].push(randInt(1,3));
            } else if(boardLandcapeState[i][j] === 8) {
                foodLandscapeState[i].push(randInt(6,9) * (general === "Wooly" ? 2 : 1));
            } else if(boardLandcapeState[i][j] === 9) {
                foodLandscapeState[i].push(randInt(2,4));
            } else if(boardLandcapeState[i][j] === 12) {
                foodLandscapeState[i].push(randInt(1,7));
            } else if(boardLandcapeState[i][j] === 14) {
                foodLandscapeState[i].push(randInt(2,4));
            } else {
                foodLandscapeState[i].push(0);
            }
        }
    }
    var canFight = true;
    var igerStrength = {strength: 0, invading: 0, IgeronKing: false};
    var currentBoardX = 50;
    var currentBoardY = 50;
    var colorTiles = new PIXI.Container();
    var ui = new PIXI.Container();
    var characters = [];
    var houses = [];
    var nextTurnButton;
    var foodText;
    var sunText;
    var messageText;
    function setup() {
        state = play;
        app.stage.addChild(boardPieces)
        // var testSprite = new Sprite(resources["sprites/civ/landscape/grass.png"].texture);
        // app.stage.addChild(testSprite);
        addFriends();
        addEnemies();
        /*var Iger = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 59,
            y: 54,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }
        var Iger2 = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 58,
            y: 54,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }

        var Iger3 = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 60,
            y: 54,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }

        var Iger4 = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 59,
            y: 56,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }
        var Iger5 = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 58,
            y: 56,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }
        var Iger6 = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 60,
            y: 56,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }
        var Iger7 = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 60,
            y: 55,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }

        var Iger8 = {
            name: "Iger",
            attackStrength: 1,
            defenseStrength: 1,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: true,
            x: 58,
            y: 55,
            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
            good: false,
        }
        app.stage.addChild(Iger.sprite);
        characters.push(Iger);
        app.stage.addChild(Iger2.sprite);
        characters.push(Iger2);
        app.stage.addChild(Iger3.sprite);
        characters.push(Iger3);
        app.stage.addChild(Iger4.sprite);
        characters.push(Iger4);
        app.stage.addChild(Iger5.sprite);
        characters.push(Iger5);
        app.stage.addChild(Iger6.sprite);
        characters.push(Iger6);
        app.stage.addChild(Iger7.sprite);
        characters.push(Iger7);
        app.stage.addChild(Iger8.sprite);
        characters.push(Iger8);*/

        nextTurnButton = new Sprite(resources["sprites/civ/ui/uno.png"].texture);
        forceNextTurnButton = new Sprite(resources["sprites/civ/ui/next.png"].texture);
        app.stage.addChild(nextTurnButton);
        app.stage.addChild(forceNextTurnButton);
        nextTurnButton.x = 10;
        nextTurnButton.y = innerHeight - 100;

        forceNextTurnButton.x = 10;
        forceNextTurnButton.y = innerHeight - 160;
        addHouses();
        drawBoard();

        var foodIcon = new Sprite(resources["sprites/civ/ui/food.png"].texture);
        var sunIcon = new Sprite(resources["sprites/civ/ui/sun.png"].texture);
        foodText = new PIXI.Text("50", {fontFamily: "Arial", fontSize: 24});
        foodText.anchor.set(0,0.5);
        foodText.x = 52;
        foodText.y = 32;
        app.stage.addChild(foodText);

        messageText = new PIXI.Text("", {fontFamily: "Arial", fontSize: 24});
        app.stage.addChild(messageText);

        messageText.anchor.set(0.5,0.5);
        messageText.x = innerWidth/2;
        messageText.y = 32;

        sunIcon.x = innerWidth - 128;
        sunText =  new PIXI.Text("1", {fontFamily: "Arial", fontSize: 24});
        sunText.y = 16;
        sunText.x = innerWidth-60;
        foodText.anchor.set(0,0.5);

        app.stage.addChild(sunText);
        app.stage.addChild(foodIcon);
        app.stage.addChild(sunIcon);

        app.stage.addChild(ui);
        app.stage.addChild(colorTiles);
        ui.y = innerHeight - 200;
        ui.x = 4;
        var heal = new Sprite(resources["sprites/civ/ui/heal.png"].texture);
        var move = new Sprite(resources["sprites/civ/ui/move.png"].texture);
        move.x += 140;
        var prepare = new Sprite(resources["sprites/civ/ui/prepare.png"].texture);
        prepare.x += 140*2;
        var sleep = new Sprite(resources["sprites/civ/ui/sleep.png"].texture);
        sleep.x += 140*3;
        var gather = new Sprite(resources["sprites/civ/ui/gather.png"].texture);
        gather.x += 140*4;
        var special = new Sprite(resources["sprites/civ/ui/ability.png"].texture);
        special.x += 140*5;
        var healthBar = new PIXI.Graphics();
        healthBar.x = 140*6;
        ui.addChild(heal);        
        ui.addChild(move)
        ui.addChild(prepare);
        ui.addChild(sleep);
        ui.addChild(gather);
        ui.addChild(special);
        ui.addChild(healthBar);
        ui.healthBar = healthBar;
        ui.visible = false;
        app.ticker.add(delta => gameLoop(delta));
    }
    function addEnemies() {
        for(let i = 0; i < 5; i++) {
            var newSpriteIon = new Sprite(resources["sprites/civ/characters/ion.png"].texture);
            var newSpriteIger = new Sprite(resources["sprites/civ/characters/iger.png"].texture);
            app.stage.addChild(newSpriteIon);
            app.stage.addChild(newSpriteIger);
            characters.push({
                name: "Ion",
                attackStrength: 16,
                defenseStrength: 14,
                maxMovement: 5,
                movement: 5,
                health: 10,
                healing: false,
                prepared: true,
                x: 55+i,
                y: 10,
                sprite: newSpriteIon,
                guard: true,
                good: false
            });
            characters.push({
                name: "Iger",
                attackStrength: 15,
                defenseStrength: 18,
                maxMovement: 5,
                movement: 5,
                health: 10,
                healing: false,
                prepared: true,
                x: 55+i,
                y: 11,
                sprite: newSpriteIger,
                guard: true,
                good: false
            });
        }
    }
    function getClosestEnemy (x,y) {
        var enemy = false;
        var bestDistance = Infinity;
        for(let i = 0; i < characters.length; i++) {
            if(!characters[i].good) {
                if(getDistance(x,y,characters[i].x,characters[i].y) < bestDistance && (characters[i].x !== x || characters[i].y !== y)) {
                    enemy = characters[i];
                    bestDistance = getDistance(x,y,characters[i].x,characters[i].y);

                }
            }
        }
        return enemy;
    }
    function addEffect(character, effect) {
        if(character.effects) {
            character.effects.push(effect);
        } else {
            character.effects = [effect];
        }
    }
    function addFriends() {
        var Wooly = {
            name: "Wooly",
            attackStrength: 8,
            defenseStrength: 8,
            rangedAttack: 0,
            maxMovement: 4,
            movement: 4,
            health: 10,
            healing: false,
            prepared: false,
            x: 62,
            y: 93,
            sprite: new Sprite(resources["sprites/civ/characters/wooly.png"].texture),
            good: true,
            special: function(me) {
                var igersNearMe = [];
                for(let i = 0; i < characters.length; i++) {
                    if(getDistance(characters[i].x, characters[i].y, me.x, me.y) < 2 && characters[i].good === false) {
                        igersNearMe.push(characters[i]);
                    }
                }
                for(let i = 0; i < igersNearMe.length; i++) {
                    var closestEnemy = getClosestEnemy(igersNearMe[i].x, igersNearMe[i].y)
                    if(getDistance(closestEnemy.x,closestEnemy.y, igersNearMe[i].x, igersNearMe[i].y) < 2) {
                        var damage1 = (igersNearMe[i].attackStrength/closestEnemy.defenseStrength)*5
                        var damage2 = (closestEnemy.defenseStrength/igersNearMe[i].attackStrength)*5
                        closestEnemy.health = Math.max(1, closestEnemy.health-damage1);
                        igersNearMe[i].health = Math.max(1, igersNearMe[i].health-damage2);
                        messageText.text = "Wooly Confused two adjacent enemies!";
                        me.health = Math.max(1, me.health - 3);
                        setTimeout(function(){
                            messageText.text = "";
                        }, 2000);
                        me.movement = 0;
                        state = fight;
                        fighters = {unit1: igersNearMe[i], unit2: closestEnemy};
                        fighters.midPointX = (fighters.unit1.sprite.x + fighters.unit2.sprite.x)/2;
                        fighters.midPointY = (fighters.unit1.sprite.y + fighters.unit2.sprite.y)/2;
                        fighters.result = 0;
                        /// moving towards
                        fighters.phase = 0;
                        fighters.reps = 1;
                        fighters.ticker = 0;
                        fighters.originalPoint1 = {x:fighters.unit1.sprite.x,y:fighters.unit1.sprite.y};
                        fighters.originalPoint2 = {x:fighters.unit2.sprite.x,y:fighters.unit2.sprite.y};
                        fighters.unit1.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};
                        fighters.returnFunction = play;
                        fighters.unit2.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};

                        return true;
                    }
                }
                return false;
            }
        };
        var Elmer = {
            name: "Elmer",
            attackStrength: 17,
            defenseStrength: 23,
            rangedAttack: 0,
            maxMovement: 5,
            movement: 5,
            health: 10,
            healing: false,
            prepared: false,
            x: 44,
            y: 56,
            sprite: new Sprite(resources["sprites/civ/characters/elmer.png"].texture),
            good: true,
            lastDBG: -10,
            special: function(me) {
                if(day - me.lastDBG < 3) {
                    return false;
                }
                var enemiesToEvaluate = [];
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(getDistance(me.x, me.y,char.x,char.y) < 3 && char !== me) {
                        enemiesToEvaluate.push(char);
                    }
                }
                enemiesToEvaluate.sort(function(a,b) {
                    return getDistance(b.x,b.y,me.x,me.y)-getDistance(a.x,a.y,me.x,me.y);
                });
                for(var i = 0; i < enemiesToEvaluate.length; i++) {
                    var enemy = enemiesToEvaluate[i];
                    var newX = enemy.x;
                    var newY = enemy.y;
                    if(enemy.x < me.x) {
                        --newX;
                    } else if(enemy.x > me.x) {
                        ++newX;
                    }
                    if(enemy.y < me.y) {
                        --newY;
                    } else if(enemy.y > me.y) {
                        ++newY;
                    }
                    if(!getCharacterAt(newX,newY)) {
                        if(enemy.captive) {
                            enemy.captive.x = newX;
                            enemy.captive.y = newY;
                        }
                        enemy.x = newX;
                        enemy.y = newY;
                    }
                    addEffect(enemy,{name: "Deadly Battle Gases", duration: 2, effect: 0.8});
                }
                if(i) {
                    messageText.text = "Elmer used Deadly Battle Gases to drive off the enemy troops!";
                    me.lastDBG = day;

                    setTimeout(function() {
                        messageText.text = "";
                    }, 2000);
                    drawBoard();
                    return true;
                } else {
                    return false;
                }
            }
        };
        var Shadow = {
            name: "Shadow",
            attackStrength: 21,
            defenseStrength: 13,
            rangedAttack: 0,
            maxMovement: 9,
            movement: 9,
            health: 10,
            healing: false,
            prepared: false,
            x: 69,
            y: 55,
            special: function(me) {
                if(day-me.lastHS < 3) {
                    return false;
                }
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(!char.good && getDistance(me.x,me.y,char.x,char.y) < 3) {
                        char.movement = 0;
                    }
                    if(char.good && getDistance(me.x,me.y,char.x,char.y < 3) && general === "Shadow") {
                        addEffect(char, {name: "The Art of War", duration: 10, effect: 1.05});
                    }
                }
                me.movement = 0;
                messageText.text = "Shadow gave a history lesson!";
                setTimeout(function(){
                    messageText.text = "";
                }, 2000);
                me.lastHS = day;
                return true;
            },
            sprite: new Sprite(resources["sprites/civ/characters/shadow.png"].texture),
            good: true,
        }
        var Eleanor = {
            name: "Eleanor",
            attackStrength: 9,
            defenseStrength: 9,
            rangedAttack: 0,
            maxMovement: 3,
            movement: 3,
            health: 10,
            healing: false,
            prepared: false,
            x: 64,
            y: 93,
            special: function(me) {
                var peopleHealed = 0;
                for(let i = 0; i < characters.length; i++) {
                    if(characters[i].good && getDistance(characters[i].x,characters[i].y,me.x,me.y) < 2 && characters[i] !== me) {
                        characters[i].health = Math.min(10,characters[i].health + 2);
                        ++peopleHealed;
                    }
                }
                setTimeout(function(){
                    messageText.text = "";
                }, 1000);
                messageText.text = "Eleanor healed " + peopleHealed + " units!";
                me.movement = 0;
                return true;
            },
            sprite: new Sprite(resources["sprites/civ/characters/eleanor.png"].texture),
            good: true,
        }
        var Humber = {
            name: "Humber",
            attackStrength: 7,
            defenseStrength: 5,
            rangedAttack: 0,
            maxMovement: 8,
            movement: 8,
            health: 10,
            healing: false,
            prepared: false,
            x: 59,
            y: 55,
            special: function (me) {
                messageText.text = "Humber became invisible!"
                me.invisible = true;
                me.sprite.alpha = 0.5;
                setTimeout(function(){
                    messageText.text = "";
                }, 1000);
                return true;
            },
            sprite: new Sprite(resources["sprites/civ/characters/humber.png"].texture),
            good: true,
        }
        var Kit = {
            name: "Kit",
            attackStrength: 9,
            defenseStrength: 9,
            rangedAttack: 0,
            maxMovement: 4,
            lastMOR: -10,
            movement: 4,
            health: 10,
            healing: false,
            prepared: false,
            x: 98,
            y: 54,
            special: function(me) {
                fighters = {unit1: me, unit2: getClosestEnemy(me.x,me.y)};
                if(getDistance(fighters.unit2.x,fighters.unit2.y,me.x,me.y) >= 2) {
                    if(general === "Kit" && day-me.lastMOR > 5) {
                        me.lastMOR = day;
                        for(let i = 0; i < characters.length; i++) {
                            var char = characters[i];
                            if(char.good) {
                                char.movement *= 2;
                            }
                        }
                        canFight = false;
                        messageText.text = "Kit meowed the sound of retreat!"
                        setTimeout(function(){
                            messageText.text = ""
                        },1000);
                        return true;
                    }
                    return false;
                }
                state = fight;
                fighters.midPointX = (fighters.unit1.sprite.x + fighters.unit2.sprite.x)/2;
                fighters.midPointY = (fighters.unit1.sprite.y + fighters.unit2.sprite.y)/2;

                var attackStrength1 = fighters.unit1.attackStrength;
                var defenseStrength2 = fighters.unit2.defenseStrength;
                if(fighters.unit1.effects) {
                    fighters.unit1.effects.forEach(function(effect){
                        attackStrength1 *= effect.effect;
                    });
                }
                if(fighters.unit2.effects) { 
                    fighters.unit2.effects.forEach(function(effect){
                        defenseStrength2 *= effect.effect;
                    });
                }
                fighters.damage1 = (attackStrength1/(defenseStrength2 * (fighters.unit2.prepared? 1.5 : 1)) * (5 + Math.random()*2-1));
                fighters.damage2 = 0;//((defenseStrength2 * (fighters.unit2.prepared? 1.5 : 1))/attackStrength1) * (5 + Math.random()*2-1);
                fighters.unit1.health -= Math.round(fighters.damage2);
                fighters.unit2.health -= Math.round(fighters.damage1);
                if(fighters.unit1.health <= 0 && fighters.unit2.health > 0) {
                    fighters.result = 1;
                } else if(fighters.unit2.health <= 0 && fighters.unit1.health > 0) {
                    fighters.result = -1;
                } else if(fighters.unit1.health > 0 && fighters.unit2.health > 0)  {
                    fighters.result = 0;
                } else if(fighters.unit1.health + Math.round(fighters.damage2) > fighters.unit2.health + Math.round(fighters.damage1)){
                    fighters.unit1.health = 1;
                    fighters.result = -1;
                } else if(fighters.unit2.health + Math.round(fighters.damage1) > fighters.unit1.health + Math.round(fighters.damage2)){
                    fighters.unit2.health = 1;
                    fighters.result = 1;
                }
                /// moving towards
                fighters.phase = 0;
                fighters.reps = 1;
                fighters.ticker = 0;
                fighters.originalPoint1 = {x:fighters.unit1.sprite.x,y:fighters.unit1.sprite.y};
                fighters.originalPoint2 = {x:fighters.unit2.sprite.x,y:fighters.unit2.sprite.y};
                fighters.unit1.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};
                fighters.returnFunction = play;
                fighters.unit2.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};
                messageText.text = "Kit did a flee attack for no damage!"
                return true;
            },
            sprite: new Sprite(resources["sprites/civ/characters/kit.png"].texture),
            good: true,
        }
        var Spot = {
            name: "Spot",
            attackStrength: 10,
            defenseStrength: 9,
            rangedAttack: 0,
            maxMovement: 4,
            movement: 4,
            health: 10,
            lastBOI: -10,
            healing: false,
            prepared: false,
            x: 98,
            y: 57,
            special: function(me) {
                var unitsInspired = 0;
                if(day-me.lastBOI < 3) {
                    return false;
                }
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(getDistance(char.x,char.y,me.x,me.y) < 3 && char.good && char !== me) {
                        char.movement += me.movement;
                        ++unitsInspired;
                    }
                }
                me.movement = 0;
                messageText.text = "Spot inspired " + unitsInspired + " units!";
                setTimeout(function(){
                    messageText.text = "";
                }, 2000);
                return true;
            },
            sprite: new Sprite(resources["sprites/civ/characters/spot.png"].texture),
            good: true,
        }
        var Plata = {
            name: "Plata",
            attackStrength: 12,
            defenseStrength: 14,
            rangedAttack: 0,
            maxMovement: 2,
            movement: 2,
            health: 10,
            healing: false,
            prepared: false,
            special: function (me) {
                if(boardLandcapeState[me.y][me.x] !== 12 && boardLandcapeState[me.y][me.x] !== 10) {
                    return false;
                }
                me.invisible = true;
                me.sprite.alpha = 0.25;
                messageText.text = "Plata dived!";
                setTimeout(function() {
                    messageText.text = "";
                }, 2000);
                return true;
            },
            x: 87,
            y: 51,
            sprite: new Sprite(resources["sprites/civ/characters/plata.png"].texture),
            good: true,
        }
        var Chesselnut = {
            name: "Chesselnut",
            attackStrength: 6,
            defenseStrength: 6,
            rangedAttack: 6,
            range: 3,
            maxMovement: 8,
            movement: 8,
            health: 10,
            healing: false,
            prepared: false,
            x: 94,
            y: 97,
            special: function (me) {
                characterSelected = me;
                me.movement -= 3;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(!char.good && getDistance(char.x,char.y,me.x,me.y) <= 3) {
                        actionSelected = "ranged";
                        return "continue";
                    }
                }
                return false;
            },
            sprite: new Sprite(resources["sprites/civ/characters/chesselnut.png"].texture),
            good: true,
        }

        app.stage.addChild(Wooly.sprite);
        characters.push(Wooly);
        app.stage.addChild(Elmer.sprite);
        characters.push(Elmer);
        app.stage.addChild(Shadow.sprite);
        characters.push(Shadow);
        app.stage.addChild(Eleanor.sprite);
        characters.push(Eleanor);
        app.stage.addChild(Humber.sprite);
        characters.push(Humber);
        app.stage.addChild(Kit.sprite);
        characters.push(Kit);
        app.stage.addChild(Spot.sprite);
        characters.push(Spot);
        app.stage.addChild(Plata.sprite);
        characters.push(Plata);
        app.stage.addChild(Chesselnut.sprite);
        characters.push(Chesselnut);
    }
    function addHouses() {
        houses.push({
            name: "Wooly's House",
            health: 20,
            strength: 15,
            x: 63,
            y: 93,
            sprite: new Sprite(resources["sprites/civ/houses/wooly.png"].texture)
        });
        houses.push({
            name: "Elmer's House",
            health: 20,
            strength: 15,
            x: 45,
            y: 56,
            sprite: new Sprite(resources["sprites/civ/houses/elmer.png"].texture)
        });
        houses.push({
            name: "Humber's House",
            health: 20,
            strength: 15,
            x: 58,
            y: 55,
            sprite: new Sprite(resources["sprites/civ/houses/humber.png"].texture)
        });
        houses.push({
            name: "Shadow's House",
            health: 20,
            strength: 15,
            x: 68,
            y: 55,
            sprite: new Sprite(resources["sprites/civ/houses/shadow.png"].texture)
        });
        houses.push({
            name: "Kit's House",
            health: 20,
            strength: 15,
            x: 98,
            y: 54,
            sprite: new Sprite(resources["sprites/civ/houses/kit.png"].texture)
        });
        houses.push({
            name: "Spot's House",
            health: 20,
            strength: 15,
            x: 98,
            y: 57,
            sprite: new Sprite(resources["sprites/civ/houses/spot.png"].texture)
        });
        houses.push({
            name: "Plata's House",
            health: 20,
            strength: 15,
            x: 87,
            y: 50,
            sprite: new Sprite(resources["sprites/civ/houses/plata.png"].texture)
        });
        houses.push({
            name: "Chesselnut's House",
            health: 20,
            strength: 15,
            x: 94,
            y: 97,
            sprite: new Sprite(resources["sprites/civ/houses/chesselnut.png"].texture)
        });

        houses.push({
            name: "Igeron King's Cave",
            health: 100,
            strength: 15,
            x: 57,
            y: 9,
            sprite: new Sprite(resources["sprites/civ/houses/cave.png"].texture),
            good: false
        });
        houses.push({
            name: "Igeron King's Cave",
            health: 20000000000,
            strength: 15,
            x: 56,
            y: 9,
            sprite: new Sprite(resources["sprites/civ/houses/cavel.png"].texture),
            good: false
        });
        houses.push({
            name: "Igeron King's Cave",
            health: 20000000000,
            strength: 15,
            x: 58,
            y: 9,
            sprite: new Sprite(resources["sprites/civ/houses/caver.png"].texture),
            good: false
        });
        app.stage.addChild(houses[0].sprite);
        app.stage.addChild(houses[1].sprite);
        app.stage.addChild(houses[2].sprite);
        app.stage.addChild(houses[3].sprite);
        app.stage.addChild(houses[4].sprite);
        app.stage.addChild(houses[5].sprite);
        app.stage.addChild(houses[6].sprite);
        app.stage.addChild(houses[7].sprite);
        app.stage.addChild(houses[8].sprite);
        app.stage.addChild(houses[9].sprite);
        app.stage.addChild(houses[10].sprite);
    }
    function gameLoop(delta) {
      state(delta)
    }
    var fighters;
    var editorSetting = 0;
    var actionSelected;
    var characterSelected;
    function play(){
        if(params.edit) {
            if(keys.mouse) {
                var changeX = Math.floor(mouseX/128) + currentBoardX;
                var changeY = Math.floor(mouseY/128) + currentBoardY;
                console.log(changeX,changeY);
                if(boardLandcapeState[changeY][changeX] !== editorSetting) {
                    boardLandcapeState[changeY][changeX] = editorSetting;
                    drawBoard();
                }
            } else if (press("0")) {
                editorSetting = 0;
            } else if(press("1")) {
                editorSetting = 1;
            } else if(press("2")) {
                editorSetting = 2;
            } else if(press("3")) {
                editorSetting = 3;
            } else if (press("4")) {
                editorSetting = 4;
            } else if(press("5")) {
                editorSetting = 5;
            } else if(press("6")) {
                editorSetting = 6;
            } else if(press("7")) {
                editorSetting = 7;
            } else if (press("8")) {
                editorSetting = 8;
            } else if(press("9")) {
                editorSetting = 9;
            } else if(press("a") && editorSetting+1 < landscape.length) {
                editorSetting++;
            } else if(press("b") && editorSetting > 0) {
                editorSetting--;
            } else if(press("ArrowLeft") && currentBoardX > 0) {
                currentBoardX--;
                drawBoard();
            } else if(press("ArrowRight") && currentBoardX + Math.ceil(innerWidth/128) < 100) {
                currentBoardX++;
                drawBoard();
            } else if(press("ArrowUp") && currentBoardY > 0) {
                currentBoardY--;
                drawBoard();
            } else if(press("ArrowDown") && currentBoardY + Math.ceil(innerHeight/128) < 100) {
                currentBoardY++;
                drawBoard();
            } else if(press("p")) {
                console.log(JSON.stringify(boardLandcapeState));
            }
        } else if(actionSelected) {
            if(actionSelected === "heal") {
                if(characterSelected.name === "Eleanor") {
                    characterSelected.health = Math.min(10,characterSelected.health + 1);
                }
                characterSelected.movement = 0;
                characterSelected.prepared = false;
                characterSelected.healing = true;
                actionSelected = false;
                characterSelected = false;
                ui.visible = false;
                var foundOne = false;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(char.good && char.movement >= 1) {
                        foundOne = true;
                        break;
                    }
                }

                if(foundOne) {
                    nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                    forceNextTurnButton.visible = true;
                } else {
                    nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                    forceNextTurnButton.visible = false;
                }
            } else if (actionSelected === "prepare") {
                characterSelected.movement = 0;
                characterSelected.prepared = true;
                characterSelected.healing = false;
                actionSelected = false;
                characterSelected = false;
                ui.visible = false;
                var foundOne = false;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(char.good && char.movement >= 1) {
                        foundOne = true;
                        break;
                    }
                }

                if(foundOne) {
                    nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                    forceNextTurnButton.visible = true;
                } else {
                    nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                    forceNextTurnButton.visible = false;
                }
            } else if(actionSelected === "sleep") {
                characterSelected.movement = 0;
                characterSelected.prepared = false;
                characterSelected.healing = false;
                actionSelected = false;
                characterSelected = false;
                ui.visible = false;
                var foundOne = false;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(char.good && char.movement >= 1) {
                        foundOne = true;
                        break;
                    }
                }

                if(foundOne) {
                    nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                    forceNextTurnButton.visible = true;
                } else {
                    nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                    forceNextTurnButton.visible = false;
                }
            } else if(actionSelected === "move") {
                if(!characterSelected.name === "Plata" || (boardLandcapeState[characterSelected.y][characterSelected.x] !== 10 && boardLandcapeState[characterSelected.y][characterSelected.x] !== 12)) {
                    var minI = Math.max(0, characterSelected.x - Math.floor(characterSelected.movement));
                    var maxI = Math.min(99,characterSelected.x + Math.floor(characterSelected.movement));
                    var minJ = Math.max(0, characterSelected.y - Math.floor(characterSelected.movement));
                    var maxJ = Math.min(99,characterSelected.y + Math.floor(characterSelected.movement));
                } else {
                    var minI = Math.max(0, characterSelected.x - Math.floor(characterSelected.movement*6));
                    var maxI = Math.min(99,characterSelected.x + Math.floor(characterSelected.movement*6));
                    var minJ = Math.max(0, characterSelected.y - Math.floor(characterSelected.movement*6));
                    var maxJ = Math.min(99,characterSelected.y + Math.floor(characterSelected.movement*6));
                }
                for(var i = minI; i <= maxI; i++) {
                    for(var j = minJ; j <= maxJ; j++) {
                        if(getDistance(i,j,characterSelected.x,characterSelected.y) <= characterSelected.movement || (characterSelected.name === "Plata" && (boardLandcapeState[j][i] === 10 || boardLandcapeState[j][i] === 12) && (boardLandcapeState[characterSelected.y][characterSelected.x] === 10 || boardLandcapeState[characterSelected.y][characterSelected.x] === 12) &&getDistance(i,j,characterSelected.x,characterSelected.y) < characterSelected.movement * 6)) {
                            if(friendAtTile(i,j) === false && (characterSelected.name === "Humber" || characterSelected.name === "Plata" || boardLandcapeState[j][i] !== 10 && boardLandcapeState[j][i] !== 12)) {
                                var glow = new Sprite(resources["sprites/civ/ui/moves.png"].texture);
                                glow.x = (i - currentBoardX) * 128;
                                glow.y = (j - currentBoardY) * 128;
                                colorTiles.addChild(glow);
                            } else if(friendAtTile(i,j) === "enemy" && canFight) {
                                var glow = new Sprite(resources["sprites/civ/ui/attack.png"].texture);
                                glow.x = (i - currentBoardX) * 128;
                                glow.y = (j - currentBoardY) * 128;
                                colorTiles.addChild(glow);
                            }
                        }
                    }
                }
                actionSelected = "moving";
            } else if(actionSelected === "moving") {
                if(press("mouse")) {
                    var clickX = Math.floor(mouseX/128) + currentBoardX;
                    var clickY = Math.floor(mouseY/128) + currentBoardY;
                    if(getDistance(characterSelected.x, characterSelected.y, clickX, clickY) <= characterSelected.movement || (characterSelected.name === "Plata" && (boardLandcapeState[characterSelected.y][characterSelected.x] === 10 || boardLandcapeState[characterSelected.y][characterSelected.x] === 12) && (boardLandcapeState[clickY][clickX] === 10 || boardLandcapeState[clickY][clickX] === 12) && getDistance(clickX,clickY,characterSelected.x,characterSelected.y) < characterSelected.movement * 6)) {
                        if(!friendAtTile(clickX,clickY)) {
                            var movementSpent = 0;
                            var charX = characterSelected.x;
                            var charY = characterSelected.y;
                            var sim = true;
                            var moveThroughFriendOk = true;
                            var lastTimeHitFriend = false;
                            while(sim) {
                                var dist = 0;
                                var acc = 0;
                                var cx = 0;
                                var cy = 0;
                                if(clickX < charX) {
                                    charX--;
                                    cx = -1;
                                    dist++;
                                } else if(clickX > charX) {
                                    charX++;
                                    cx = 1;
                                } else {
                                    acc++;
                                }
                                if(clickY < charY) {
                                    charY--;
                                    cy = -1;
                                    dist++;
                                } else if(clickY > charY) {
                                    charY++;
                                    cy = 1;
                                } else {
                                    acc++;
                                }
                                if(acc === 2) {
                                    sim = false;
                                    lastTimeHitFriend = false;
                                } else if(((friendAtTile(charX,charY) !== "enemy" && moveThroughFriendOk) || !friendAtTile(charX,charY)) && (characterSelected.name === "Humber" || characterSelected.name === "Plata" || boardLandcapeState[charY][charX] !== 10 && boardLandcapeState[charY][charX] !== 12)){
                                    movementSpent += Math.sqrt(dist);
                                    if(friendAtTile(charX,charY)) {
                                        lastTimeHitFriend = true;
                                    } else {
                                        lastTimeHitFriend = false;
                                    }
                                } else if(!lastTimeHitFriend) {
                                    sim = "FAIL";
                                    charX -= cx;
                                    charY -= cy;
                                    break;
                                } else {
                                    movementSpent = 0;
                                    charX = characterSelected.x;
                                    charY = characterSelected.y;
                                    sim = true;
                                    moveThroughFriendOk = false;
                                    lastTimeHitFriend = false;
                                }
                            }
                            if(sim === "FAIL") {
                                characterSelected.movement -= movementSpent;
                                characterSelected.x = charX;
                                characterSelected.y = charY;
                            } else {
                                if((boardLandcapeState[clickY][clickX] === 10 || boardLandcapeState[clickY][clickX] === 12) && (characterSelected.name === "Plata" && (boardLandcapeState[characterSelected.y][characterSelected.x] === 10 || boardLandcapeState[characterSelected.y][characterSelected.x] === 12))) {
                                    characterSelected.movement -= getDistance(characterSelected.x, characterSelected.y, clickX, clickY)/6;
                                } else {
                                    characterSelected.movement -= getDistance(characterSelected.x, characterSelected.y, clickX, clickY);
                                }
                                characterSelected.x = clickX;
                                characterSelected.y = clickY;
                            }
                            drawBoard();
                            if(characterSelected.name === "Plata" && characterSelected.invisible && (boardLandcapeState[clickY][clickX] !== 10 && boardLandcapeState[clickY][clickX] !== 12)) {
                                characterSelected.invisible = false;
                                characterSelected.sprite.alpha = 1;
                            }
                            characterSelected.healing = false;
                            characterSelected.prepared = false;
                            actionSelected = false;
                            characterSelected = false;
                            ui.visible = false;
                            colorTiles.removeChildren();
                            var foundOne = false;
                            for(let i = 0; i < characters.length; i++) {
                                var char = characters[i];
                                if(char.good && char.movement >= 1) {
                                    foundOne = true;
                                    console.log(char,"char");
                                    break;
                                }
                            }
                            if(foundOne) {
                                nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                            } else {
                                nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                            }
                        } else if(friendAtTile(clickX, clickY) === "enemy" && canFight) {
                            var movementSpent = 0;
                            var charX = characterSelected.x;
                            var charY = characterSelected.y;
                            var sim = true;
                            var moveThroughFriendOk = true;
                            var lastTimeHitFriend = false;
                            while(sim) {
                                var dist = 0;
                                var acc = 0;
                                var cx = 0;
                                var cy = 0;
                                if(clickX < charX) {
                                    charX--;
                                    cx = -1;
                                    dist++;
                                } else if(clickX > charX) {
                                    charX++;
                                    cx = 1;
                                } else {
                                    acc++;
                                }
                                if(clickY < charY) {
                                    charY--;
                                    cy = -1;
                                    dist++;
                                } else if(clickY > charY) {
                                    charY++;
                                    cy = 1;
                                } else {
                                    acc++;
                                }

                                if(acc === 2) {
                                    sim = false;
                                    lastTimeHitFriend = false;
                                } else if(((friendAtTile(charX,charY) !== "enemy" && moveThroughFriendOk) || !friendAtTile(charX,charY)) && (characterSelected.name === "Humber" || characterSelected.name === "Plata" || boardLandcapeState[charY][charX] !== 10 && boardLandcapeState[charY][charX] !== 12)){
                                    movementSpent += Math.sqrt(dist);
                                    if(friendAtTile(charX,charY)) {
                                        lastTimeHitFriend = true;
                                    } else {
                                        lastTimeHitFriend = false;
                                    }
                                } else if(getDistance(charX-cx,charY-cy,clickX,clickY) < 2) {
                                    sim = "FIGHT";
                                    charX -= cx;
                                    charY -= cy;
                                    break;
                                } else if(!lastTimeHitFriend) {
                                    sim = "FAIL";
                                    charX -= cx;
                                    charY -= cy;
                                    break;
                                } else {
                                    movementSpent = 0;
                                    charX = characterSelected.x;
                                    charY = characterSelected.y;
                                    sim = true;
                                    moveThroughFriendOk = false;
                                    lastTimeHitFriend = false;
                                }
                            }
                            if(sim === "FIGHT") {
                                characterSelected.x = charX;
                                characterSelected.y = charY;
                                characterSelected.movement -= getDistance(characterSelected.x, characterSelected.y, clickX, clickY);

                                drawBoard();

                                state = fight;
                                fighters = {unit1: characterSelected, unit2: getCharacterAt(clickX,clickY,false)}
                                fighters.midPointX = (fighters.unit1.sprite.x + fighters.unit2.sprite.x)/2;
                                fighters.midPointY = (fighters.unit1.sprite.y + fighters.unit2.sprite.y)/2;

                                var attackStrength1 = fighters.unit1.attackStrength * (fighters.unit1.invisible ? 1.5 : 1);
                                var defenseStrength2 = fighters.unit2.defenseStrength;
                                if(fighters.unit1.effects) {
                                    fighters.unit1.effects.forEach(function(effect){
                                        attackStrength1 *= effect.effect;
                                    });
                                }
                                if(fighters.unit2.effects) { 
                                    fighters.unit2.effects.forEach(function(effect){
                                        defenseStrength2 *= effect.effect;
                                    });
                                }
                                fighters.damage1 = (attackStrength1/(defenseStrength2 * (fighters.unit2.prepared? 1.5 : 1)) * (5 + Math.random()*2-1));
                                fighters.damage2 = ((defenseStrength2 * (fighters.unit2.prepared? 1.5 : 1))/attackStrength1) * (5 + Math.random()*2-1);
                                fighters.unit1.health -= Math.round(fighters.damage2);
                                fighters.unit2.health -= Math.round(fighters.damage1);
                                if(fighters.unit1.health <= 0 && fighters.unit2.health > 0) {
                                    fighters.result = 1;
                                } else if(fighters.unit2.health <= 0 && fighters.unit1.health > 0) {
                                    fighters.result = -1;
                                } else if(fighters.unit1.health > 0 && fighters.unit2.health > 0)  {
                                    fighters.result = 0;
                                } else if(fighters.unit1.health + Math.round(fighters.damage2) > fighters.unit2.health + Math.round(fighters.damage1)){
                                    fighters.unit1.health = 1;
                                    fighters.result = -1;
                                } else if(fighters.unit2.health + Math.round(fighters.damage1) > fighters.unit1.health + Math.round(fighters.damage2)){
                                    fighters.unit2.health = 1;
                                    fighters.result = 1;
                                }
                                /// moving towards
                                fighters.phase = 0;
                                fighters.reps = 1;
                                fighters.ticker = 0;
                                fighters.originalPoint1 = {x:fighters.unit1.sprite.x,y:fighters.unit1.sprite.y};
                                fighters.originalPoint2 = {x:fighters.unit2.sprite.x,y:fighters.unit2.sprite.y};
                                fighters.unit1.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};
                                fighters.returnFunction = play;
                                fighters.unit2.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};
                            }
                            drawBoard();
                            if(characterSelected.name === "Plata" && boardLandcapeState[characterSelected.y][characterSelected.x] !== 12 && boardLandcapeState[characterSelected.y][characterSelected.x] !== 10) {
                                characterSelected.invisible = false;
                                characterSelected.sprite.alpha = 1;
                            }
                            characterSelected.healing = false;
                            characterSelected.prepared = false;
                            actionSelected = false;
                            characterSelected = false;
                            ui.visible = false;
                            colorTiles.removeChildren();
                            var foundOne = false;
                            for(let i = 0; i < characters.length; i++) {
                                var char = characters[i];
                                if(char.good && char.movement >= 1) {
                                    foundOne = true;
                                    console.log(char,"char");
                                    break;
                                }
                            }
                            if(foundOne) {
                                nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                            } else {
                                nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                            }
                        }
                    } else {
                        colorTiles.removeChildren();
                        actionSelected = false;
                    }
                }
            } else if(actionSelected === "gather") {
                var curTile = boardLandcapeState[characterSelected.y][characterSelected.x];
                var foodOnTile = foodLandscapeState[characterSelected.y][characterSelected.x];
                var bonus = 1;;
                if(foodOnTile <= 0) {
                    actionSelected = false;
                    characterSelected = false;
                    ui.visible = false;
                    messageText.text = "There is no food on this tile!";
                    setTimeout(function(){
                        messageText.text = "";
                    }, 1000);
                    return;
                } else if((characterSelected.name !== "Humber" && curTile > 1 && curTile < 5 && general !== "Humber") || (curTile === 12 && characterSelected.name !== "Plata")) {
                    actionSelected = false;
                    ui.visible = false;
                    messageText.text = characterSelected.name + " cannot gather food from this tile!";
                    setTimeout(function(){
                        messageText.text = "";
                    }, 1000);
                    characterSelected = false;

                    return;
                } else if((characterSelected.name === "Wooly" && curTile === 8) || (characterSelected.name === "Plata" && curTile === 12) || (characterSelected.name === "Humber" && curTile > 1 && curTile < 5) || 
                (characterSelected.name === "Elmer" && curTile < 2) || (characterSelected.name === "Shadow" && curTile === 0) || (characterSelected.name === "Chesselnut" && curTile === 9) || (characterSelected.name === "Plata" && curTile === 12)) {
                    var possibleFoodGathered = Math.round(characterSelected.movement*2);
                    ++bonus;
                    if(characterSelected.name === "Plata") {
                        possibleFoodGathered *= 3;
                        bonus *= 3;
                    }
                } else {
                    var possibleFoodGathered = Math.round(characterSelected.movement);
                }
                if(curTile === 9 && general === "Chesselnut") {
                    possibleFoodGathered *= 2;
                    bonus *= 2;
                }
                if(foodOnTile > possibleFoodGathered) {
                    messageText.text = "You gathered " + possibleFoodGathered + " food!";
                    setTimeout(function(){
                        messageText.text = "";
                    }, 1000);
                    foodLandscapeState[characterSelected.y][characterSelected.x] -= possibleFoodGathered;
                    food += possibleFoodGathered;
                    characterSelected.movement = 0;
                } else if(general === "Eleanor") {
                    messageText.text = "You gathered " + (foodOnTile+1) + " food!";
                    setTimeout(function(){
                        messageText.text = "";
                    }, 1000);
                    foodLandscapeState[characterSelected.y][characterSelected.x] = 0;
                    food += foodOnTile+1;
                    console.log(Math.ceil(foodOnTile/bonus));
                    characterSelected.movement -= Math.ceil(foodOnTile/bonus);
                } else {
                    messageText.text = "You gathered " + foodOnTile + " food!";
                    setTimeout(function(){
                        messageText.text = "";
                    }, 1000);
                    foodLandscapeState[characterSelected.y][characterSelected.x] = 0;
                    food += foodOnTile;
                    console.log(Math.ceil(foodOnTile/bonus));
                    characterSelected.movement -= Math.ceil(foodOnTile/bonus);
                }
                foodText.text = food;
                actionSelected = false;
                characterSelected = false;
                ui.visible = false;
                var foundOne = false;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(char.good && char.movement >= 1) {
                        foundOne = true;
                        break;
                    }
                }

                if(foundOne) {
                    nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                    forceNextTurnButton.visible = true;
                } else {
                    nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                    forceNextTurnButton.visible = false;
                }
            } else if(actionSelected === "special") {
                var result = characterSelected.special(characterSelected);
                if(!result) {
                    messageText.text = "That special ability does not work right now.";
                    setTimeout(function() {
                        messageText.text = "";
                    }, 2000);
                } else if(result === "continue") {
                    return;
                }
                actionSelected = false;
                characterSelected = false;
                ui.visible = false;
                var foundOne = false;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(char.good && char.movement >= 1) {
                        foundOne = true;
                        break;
                    }
                }

                if(foundOne) {
                    nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                    forceNextTurnButton.visible = true;
                } else {
                    nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                    forceNextTurnButton.visible = false;
                }
            } else if(actionSelected === "ranged") {
                var minI = Math.max(0, characterSelected.x - Math.floor(characterSelected.range));
                var maxI = Math.min(99,characterSelected.x + Math.floor(characterSelected.range));
                var minJ = Math.max(0, characterSelected.y - Math.floor(characterSelected.range));
                var maxJ = Math.min(99,characterSelected.y + Math.floor(characterSelected.range));
                for(var i = minI; i <= maxI; i++) {
                    for(var j = minJ; j <= maxJ; j++) {
                        if(getDistance(i,j,characterSelected.x,characterSelected.y) <= characterSelected.range) {
                            if(friendAtTile(i,j) === "enemy") {
                                var glow = new Sprite(resources["sprites/civ/ui/attack.png"].texture);
                                glow.x = (i - currentBoardX) * 128;
                                glow.y = (j - currentBoardY) * 128;
                                colorTiles.addChild(glow);
                            }
                        }
                    }
                }
                actionSelected = "shooting";
                var foundOne = false;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(char.good && char.movement >= 1) {
                        foundOne = true;
                        break;
                    }
                }

                if(foundOne) {
                    nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                    forceNextTurnButton.visible = true;
                } else {
                    nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                    forceNextTurnButton.visible = false;
                }
            } else if(actionSelected === "shooting") {
                if(press("mouse")) {
                    var clickX = Math.floor(mouseX/128) + currentBoardX;
                    var clickY = Math.floor(mouseY/128) + currentBoardY;
                    for(let i = 0; i < characters.length; i++) {
                        var char = characters[i];
                        if(getDistance(char.x,char.y,characterSelected.x,characterSelected.y) <= 3 && !char.good && char.x === clickX && char.y === clickY) {
                            state = shoot;
                            projectile = {sprite: new Sprite(resources["sprites/civ/ui/nut.png"].texture), attackX: char.sprite.x, attackY: char.sprite.y, enemy: char, phase: 0, ticker: 0, tickerMax: getDistance(char.x,char.y,characterSelected.x,characterSelected.y) * 50/3};
                            projectile.sprite.x = characterSelected.sprite.x + characterSelected.sprite.width/2;
                            projectile.sprite.y = characterSelected.sprite.y + characterSelected.sprite.height/2;
                            app.stage.addChild(projectile.sprite);
                            projectile.sprite.scale.set(2);
                            projectile.sprite.anchor.set(0.5,0.5);
                            
                            projectile.rateX = ((char.sprite.x+char.sprite.width/2)-projectile.sprite.x)/projectile.tickerMax;
                            projectile.rateY = ((char.sprite.y+char.sprite.height/2)-projectile.sprite.y)/projectile.tickerMax;
                            char.health -= Math.round((characterSelected.rangedAttack/char.defenseStrength)*5);
                            if(char.health <= 0) {
                                projectile.result = 1;
                                if(char.captive) {
                                    char.captive.captor = false;
                                    char.captive = false;
                                }
                            } else {
                                projectile.result = 0;
                            }
                            characterSelected.healing = false;
                            characterSelected.prepared = false;
                            actionSelected = false;
                            characterSelected = false;
                            ui.visible = false;
                            colorTiles.removeChildren();
                            console.log(projectile);
                            break;
                        }
                    }
                }
                var foundOne = false;
                for(let i = 0; i < characters.length; i++) {
                    var char = characters[i];
                    if(char.good && char.movement >= 1) {
                        foundOne = true;
                        break;
                    }
                }

                if(foundOne) {
                    nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
                    forceNextTurnButton.visible = true;
                } else {
                    nextTurnButton.texture = resources["sprites/civ/ui/next.png"].texture;
                    forceNextTurnButton.visible = false;
                }
            }
        } else if(characterSelected) {
            if(press("mouse")) {
                if(characterSelected.movement >= 1 || (characterSelected.name === "Plata" && characterSelected.movement > 0)) {
                    if(within(mouseX,mouseY,4,innerHeight-200,128,128)) {
                        actionSelected = "heal";
                    } else if(within(mouseX,mouseY,4+140,innerHeight-200,128,128)) {
                        actionSelected = "move";
                    } else if(within(mouseX,mouseY,4+280,innerHeight-200,128,128)) {
                        actionSelected = "prepare";
                    } else if(within(mouseX,mouseY,4+420,innerHeight-200,128,128)) {
                        actionSelected = "sleep";
                    } else if(within(mouseX,mouseY,4+560,innerHeight-200,128,128)) {
                        actionSelected = "gather";
                    } else if(within(mouseX,mouseY,4+700,innerHeight-200,128,128)) {
                        actionSelected = "special";
                    }else {
                        characterSelected = false;
                        ui.visible = false;
                    }
                } else {
                    characterSelected = false;
                    ui.visible = false;
                }
            }
        } else {
            if(press("mouse")) {
                if(within(mouseX, mouseY, 10, innerHeight - 160, 128, 64) && forceNextTurnButton.visible) {    
                    state = nextTurn;
                    forceNextTurnButton.visible = false;
                    characters.forEach(function(character) {
                        if(character.good) {
                            if(character.healing) {
                                for(let i = 0; i < houses.length; i++) {
                                    if(character.x === houses[i].x && character.y === houses[i].y) {
                                        character.health = Math.min(character.health + 2, 10);
                                    }
                                }
                                character.health = Math.min(character.health + 1, 10);
                            }
                            character.movement = character.maxMovement;
                        }
                    });
                } else if(within(mouseX, mouseY, 10, innerHeight - 100, 128, 64)) {    
                    var foundOne = false;
                    for(let i = 0; i < characters.length; i++) {
                        var char = characters[i];
                        if(char.good && char.movement > 1) {
                            foundOne = char;
                            break;
                        }
                    }
                    if(foundOne) {
                        console.log(foundOne);
                        currentBoardX = foundOne.x - Math.ceil(innerWidth/128)/2;
                        currentBoardY = foundOne.y - Math.ceil(innerHeight/128)/2;
                        currentBoardX = Math.min(99-Math.ceil(innerWidth/128),currentBoardX);
                        currentBoardX = Math.round(Math.max(0,currentBoardX));
                        currentBoardY = Math.min(99-Math.ceil(innerHeight/128),currentBoardY);
                        currentBoardY = Math.round(Math.max(0,currentBoardY));
                        drawBoard();
                        return;
                    }
                    state = nextTurn;
                    nextTurnButton.visible = false;
                    characters.forEach(function(character) {
                        if(character.good) {
                            if(character.healing) {
                                for(let i = 0; i < houses.length; i++) {
                                    if(character.x === houses[i].x && character.y === houses[i].y) {
                                        character.health = Math.min(character.health + 2, 10);
                                    }
                                }
                                character.health = Math.min(character.health + 1, 10);
                            }
                            character.movement = character.maxMovement;
                        }
                    });
                } else {
                    var clickX = Math.floor(mouseX/128) + currentBoardX;
                    var clickY = Math.floor(mouseY/128) + currentBoardY;
                    for(let i = 0; i < characters.length; i++) {
                        if(characters[i].good && characters[i].x === clickX && characters[i].y === clickY && !characters[i].captor) {
                            characterSelected = characters[i];
                            ui.visible = true;
                            ui.healthBar.clear();
                            ui.healthBar.beginFill(0xffffff);
                            ui.healthBar.lineStyle(5,0x000000);
                            ui.healthBar.drawRect(0,0,32,128);
                            if(characterSelected.health > 5) {
                                var fill = ((characterSelected.health-5)*0x00ff00 + (10-characterSelected.health)*0xffff00)/5
                            } else {
                                var fill = ((characterSelected.health)*0xffff00 + (5-characterSelected.health)*0xff0000)/5
                            }
                            ui.healthBar.beginFill(fill);
                            ui.healthBar.lineStyle(5,0x000000);
                            ui.healthBar.drawRect(0,128*(1-characterSelected.health/10),32,128*characterSelected.health/10);
                            if(characterSelected.movement >= 1 || (characterSelected.name === "Plata" && characterSelected.movement > 0)) {
                                ui.alpha = 1;
                            } else {
                                ui.alpha = 0.5;
                            }
                            break;
                        }
                    }
                }
            } else if(press("ArrowLeft") && currentBoardX > 0) {
                currentBoardX--;
                drawBoard();
            } else if(press("ArrowRight") && currentBoardX + Math.ceil(innerWidth/128) < 100) {
                currentBoardX++;
                drawBoard();
            } else if(press("ArrowUp") && currentBoardY > 0) {
                currentBoardY--;
                drawBoard();
            } else if(press("ArrowDown") && currentBoardY + Math.ceil(innerHeight/128) < 100) {
                currentBoardY++;
                drawBoard();
            }
        }
    }
    function nextTurn() {
        var didSomethingThisTurn = false;
        for(let i = 0; i < characters.length; i++) {
            if(!characters[i].good && characters[i].movement && !characters[i].captive) {
                var enemy = characters[i];
                if(getDistance(getClosestFriend(enemy.x,enemy.y).x, getClosestFriend(enemy.x,enemy.y).y, enemy.x, enemy.y) < 2 && !enemy.captive) {
                    fighters = {unit1: enemy, unit2: getClosestFriend(enemy.x, enemy.y)};
                    fighters.midPointX = (fighters.unit1.sprite.x + fighters.unit2.sprite.x)/2;
                    fighters.midPointY = (fighters.unit1.sprite.y + fighters.unit2.sprite.y)/2;
                    var attackStrength1 = fighters.unit1.attackStrength;
                    var defenseStrength2 = fighters.unit2.defenseStrength;
                    if(fighters.unit1.effects) { 
                        fighters.unit1.effects.forEach(function(effect){
                            attackStrength1 *= effect.effect;
                        });
                    }
                    if(fighters.unit2.effects) { 
                        fighters.unit2.effects.forEach(function(effect){
                            defenseStrength2 *= effect.effect;
                        });
                    }
                    fighters.damage1 = (attackStrength1/(defenseStrength2 * (fighters.unit2.prepared? 1.5 : 1))) * (5 + Math.random()*2-1);
                    fighters.damage2 = ((defenseStrength2 * (fighters.unit2.prepared? 1.5 : 1))/attackStrength1) * (5 + Math.random()*2-1);
                    fighters.unit1.health -= Math.round(fighters.damage2);
                    fighters.unit2.health -= Math.round(fighters.damage1);
                    if(fighters.unit1.health <= 0 && fighters.unit2.health > 0) {
                        fighters.result = 1;
                    } else if(fighters.unit2.health <= 0 && fighters.unit1.health > 0) {
                        fighters.result = -1;
                    } else if(fighters.unit1.health > 0 && fighters.unit2.health > 0)  {
                        fighters.result = 0;
                    } else if(fighters.unit1.health + Math.round(fighters.damage2) > fighters.unit2.health + Math.round(fighters.damage1)){
                        fighters.unit1.health = 1;
                        fighters.result = -1;
                    } else if(fighters.unit2.health + Math.round(fighters.damage1) > fighters.unit1.health + Math.round(fighters.damage2)){
                        fighters.unit2.health = 1;
                        fighters.result = 1;
                    }
                    /// moving towards
                    fighters.phase = 0;
                    fighters.reps = 1;
                    fighters.ticker = 0;
                    fighters.originalPoint1 = {x:fighters.unit1.sprite.x,y:fighters.unit1.sprite.y};
                    fighters.originalPoint2 = {x:fighters.unit2.sprite.x,y:fighters.unit2.sprite.y};
                    fighters.unit1.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};
                    fighters.unit2.targetPoint = {x: fighters.midPointX, y:fighters.midPointY};
                    fighters.returnFunction = nextTurn;
                    state = fight;
                    didSomethingThisTurn = true;
                    fighters.unit1.health = Math.max(0,fighters.unit1.health);
                    fighters.unit2.health = Math.max(0,fighters.unit2.health);
                    break;
                } else if(getDistance(getClosestFriend(enemy.x,enemy.y).x, getClosestFriend(enemy.x,enemy.y).y, enemy.x, enemy.y) <= enemy.movement || !enemy.guard) {
                    var target = getClosestFriend(enemy.x,enemy.y)
                    var targetX = target.x// + randInt(-1,1);
                    var targetY = target.y// + randInt(-1,1);

                    var movementSpent = 0;
                    var charX = enemy.x;
                    var charY = enemy.y;
                    var sim = true;
                    while(sim) {
                        var dist = 0;
                        var acc = 0;
                        var cx = 0;
                        var cy = 0;
                        if(targetX < charX) {
                            charX--;
                            cx = -1;
                            dist++;
                        } else if(targetX > charX) {
                            charX++;
                            cx = 1;
                        } else {
                            acc++;
                        }
                        if(targetY < charY) {
                            charY--;
                            cy = -1;
                            dist++;
                        } else if(targetY > charY) {
                            charY++;
                            cy = 1;
                        } else {
                            acc++;
                        }
                        ++movementSpent;
                        if(acc === 2) {
                            sim = false;
                        } else if((!friendAtTile(charX,charY) && boardLandcapeState[charY][charX] !== 10 && boardLandcapeState[charY][charX] !== 12) || movementSpent > enemy.movement){
                            movementSpent += Math.sqrt(dist);
                            if(movementSpent > enemy.movement) {
                                sim = "FAIL";
                                charX -= cx;
                                charY -= cy;
                                break;
                            }
                        } else {
                            sim = "FAIL";
                            charX -= cx;
                            charY -= cy;
                            break;
                        }
                    }
                    if(sim === "FAIL") {
                        enemy.movement -= movementSpent;
                        enemy.x = charX;
                        enemy.y = charY;
                    } else {
                        enemy.movement -= getDistance(enemy.x, enemy.y, targetX, targetY);
                        enemy.x = targetX;
                        enemy.y = targetY;
                    }
                    ui.visible = false;
                    drawBoard();
                }
            }
        }
        if(!didSomethingThisTurn) {
            nextTurnButton.texture = resources["sprites/civ/ui/uno.png"].texture;
            state = play;
            for(let i = 0; i < characters.length; i++) {
                if(!characters[i].good) {
                    characters[i].movement = characters[i].maxMovement;
                }
                if(characters[i].good && general === "Elmer") {
                    addEffect(characters[i], {name: "General Food Bonus", duration: 2, effect: Math.max(1,1+(food-200)/100)});
                }
                if(!characters[i].effects) {
                    continue;
                }
                for(let j = 0; j < characters[i].effects.length; j++) {
                    --characters[i].effects[j].duration;
                    if(characters[i].effects[j].duration <= 0) {
                        characters[i].effects.splice(j,1);
                        --j;
                    }
                }
            }
            nextTurnButton.visible = true;
            forceNextTurnButton.visible = true;
            ++day;
            sunText.text = day;
            food -= 3;
            if(food < 0) {
                dfadf = 20;
            }
            foodText.text = food;
            if(day % 10 === 0) {
                for(let i = 0; i < foodLandscapeState.length; i++) {
                    for(let j = 0; j < foodLandscapeState[i].length; j++) {
                        var curFood = foodLandscapeState[i][j];
                        var curTile = boardLandcapeState[i][j];
                        if(landscapeSeasonPrime[curTile] > day) {
                            foodLandscapeState[i][j]++;
                        } else {
                            foodLandscapeState[i][j]--;
                        }
                    }
                }
            }
            // ++igerStrength.strength;
            if(!igerStrength.invading) {
                if(igerStrength.strength > 12 && Math.random() < 0.1) {
                    var notDone = false;
                    var beginX = randInt(1,98);
                    var beginY = randInt(52,54);

                    while(true) {
                        if(getCharacterAt(beginX,beginY) === false){
                            break;
                        } else {
                            beginX = randInt(1,98);
                            beginY = randInt(52,54);
                        }
                    }
                    if(!isAlive("Igeron King")) {
                        var igeronKing = {
                            name: "Igeron King",
                            attackStrength: 21,
                            defenseStrength: 21,
                            maxMovement: 6,
                            movement: 6,
                            health: 10,
                            healing: false,
                            prepared: false,
                            x: beginX,
                            y: beginY,
                            sprite: new Sprite(resources["sprites/civ/characters/igeron-king.png"].texture),
                            good: false
                        }

                        characters.push(igeronKing);
                        app.stage.addChild(igeronKing.sprite);
                    }
                    for(let i = 0; i < igerStrength.strength / 7; i++) {
                        var newIger = {
                            name: "Iger",
                            attackStrength: 15,
                            defenseStrength: 18,
                            maxMovement: 5,
                            movement: 5,
                            health: 10,
                            healing: false,
                            prepared: true,
                            x: beginX+randInt(-Math.floor(igerStrength.strength/7), Math.floor(igerStrength.strength/7)),
                            y: beginY+randInt(-Math.floor(igerStrength.strength/7), Math.floor(igerStrength.strength/7)),
                            sprite: new Sprite(resources["sprites/civ/characters/iger.png"].texture),
                            good: false
                        };
                        var newIon = {
                            name: "Ion",
                            attackStrength: 16,
                            defenseStrength: 14,
                            maxMovement: 5,
                            movement: 5,
                            health: 10,
                            healing: false,
                            prepared: true,
                            x: beginX+randInt(-Math.floor(igerStrength.strength/7), Math.floor(igerStrength.strength/7)),
                            y: beginY+randInt(-Math.floor(igerStrength.strength/7), Math.floor(igerStrength.strength/7)),
                            sprite: new Sprite(resources["sprites/civ/characters/ion.png"].texture),
                            good: false
                        };
                        if(newIon.x > -1 && newIon.x < 99 && newIon.y > -1 && newIon.y < 99) {
                            if(getCharacterAt(newIon.x,newIon.y) === false && boardLandcapeState[newIon.y][newIon.x] !== 10 && boardLandcapeState[newIon.y][newIon.x] !== 12) {
                                app.stage.addChild(newIon.sprite);
                                characters.push(newIon);
                            }
                        }
                        if(newIger.x > -1 && newIger.x < 99 && newIger.y > -1 && newIger.y < 99) {
                            if(getCharacterAt(newIger.x,newIger.y) === false && boardLandcapeState[newIger.y][newIger.x] !== 10 && boardLandcapeState[newIger.y][newIger.x] !== 12) {
                                app.stage.addChild(newIger.sprite);
                                characters.push(newIger);
                            }
                        }
                    }
                    igerStrength.invading = 10;
                    igerStrength.strength = false;
                    messageText.text = "The Igeron King has breached the river!";
                    setTimeout(function(){
                        messageText.text = "";
                    }, 5000);
                }
            } else {
                igerStrength.invading--;
                igerStrength.strength--;
            }
            canFight = true;
            drawBoard();
        }
    }
    function isAlive(name) {
        for(let i = 0; i < characters.length; i++) {
            if(characters[i].name === name) {
                return true;
            } 
        }
        return false;
    }
    function getClosestFriend(x,y) {
        var friend = false;
        var bestDistance = Infinity;
        for(let i = 0; i < characters.length; i++) {
            if(characters[i].good && !characters[i].captor && !characters[i].invisible) {
                if(getDistance(x,y,characters[i].x,characters[i].y) < bestDistance) {
                    bestDistance = getDistance(x,y,characters[i].x,characters[i].y);
                    friend = characters[i];
                }
            }
        }
        return friend;
    }
    function shoot() {
        if(projectile.phase === 0) {
            ++projectile.ticker;
            projectile.sprite.x += projectile.rateX;
            projectile.sprite.y += projectile.rateY;
            projectile.sprite.rotation += Math.PI*4/projectile.tickerMax;
            if(projectile.ticker > projectile.tickerMax) {
                projectile.phase = 1;
                projectile.ticker = 0;
                app.stage.removeChild(projectile.sprite);
            }
        } else {
            if(projectile.result) {
                projectile.enemy.sprite.alpha -= 1/projectile.tickerMax;
            }
            ++projectile.ticker;
            if(projectile.ticker > projectile.tickerMax) {
                if(projectile.result) {
                    app.stage.removeChild(projectile.enemy.sprite);
                    for(let i = 0; i < characters.length; i++) {
                        if(characters[i] === projectile.enemy) {
                            characters.splice(i,1);
                            break;
                        }
                    }
                }
                state = play;
            }
        }
    }
    function fight() {
        if(fighters.unit1.sprite.x < fighters.unit1.targetPoint.x) {
            fighters.unit1.sprite.x++;
        } else if(fighters.unit1.sprite.x > fighters.unit1.targetPoint.x) {
            fighters.unit1.sprite.x--;
        }
        if(fighters.unit1.sprite.y < fighters.unit1.targetPoint.y) {
            fighters.unit1.sprite.y++;
        } else if(fighters.unit1.sprite.y > fighters.unit1.targetPoint.y) {
            fighters.unit1.sprite.y--;
        }
        if(fighters.unit1.dying) {
            fighters.unit1.sprite.alpha -= 0.02;
        }
        if(fighters.unit2.sprite.x < fighters.unit2.targetPoint.x) {
            fighters.unit2.sprite.x++;
        } else if(fighters.unit2.sprite.x > fighters.unit2.targetPoint.x) {
            fighters.unit2.sprite.x--;
        }
        if(fighters.unit2.sprite.y < fighters.unit2.targetPoint.y) {
            fighters.unit2.sprite.y++;
        } else if(fighters.unit2.sprite.y > fighters.unit2.targetPoint.y) {
            fighters.unit2.sprite.y--;
        }

        if(fighters.unit2.dying) {
            fighters.unit2.sprite.alpha -= 0.02;
        }
        ++fighters.ticker;
        if(fighters.ticker > 49) {
            if(fighters.phase === 0) {
                --fighters.reps;
                if(fighters.reps < 1) {
                    if(fighters.result === 0) {
                        fighters.unit1.targetPoint = fighters.originalPoint1;
                        fighters.unit2.targetPoint = fighters.originalPoint2;
                    } else if(fighters.unit1.good) {
                        if(fighters.result === -1 && !fighters.unit2.captive) {
                            fighters.unit1.targetPoint =  fighters.originalPoint2;
                            fighters.unit2.dying = true;
                            fighters.unit1.x = fighters.unit2.x;
                            fighters.unit1.y = fighters.unit2.y;
                            for(let i = 0; i < characters.length; i++) {
                                if(characters[i] === fighters.unit2) {
                                    characters.splice(i,1);
                                    break;
                                }
                            }
                        } else if(fighters.result === -1) {
                            fighters.unit1.targetPoint = fighters.originalPoint1;
                            fighters.unit2.dying = true;
                            fighters.unit2.captive.captor = false;
                            fighters.unit2.captive.health = 1;
                            fighters.unit2.captive.movement = 0;
                            for(let i = 0; i < characters.length; i++) {
                                if(characters[i] === fighters.unit2) {
                                    characters.splice(i,1);
                                    break;
                                }
                            }
                        } else if(fighters.result === 1 && !fighters.unit2.captive) {
                            fighters.unit1.targetPoint = fighters.originalPoint2;
                            fighters.unit2.targetPoint = fighters.originalPoint2;
                            fighters.unit1.x = fighters.unit2.x;
                            fighters.unit1.y = fighters.unit2.y;
                            fighters.unit2.captive = fighters.unit1;
                            fighters.unit1.captor = fighters.unit2;
                        } else {
                            fighters.unit1.targetPoint = fighters.originalPoint1;
                            fighters.unit2.targetPoint = fighters.originalPoint2;
                            fighters.unit1.health = 1;
                            fighters.unit1.movement = 0;
                        }
                    } else {
                        if(fighters.result === -1) {
                            fighters.unit1.targetPoint = fighters.originalPoint2;
                            fighters.unit2.targetPoint = fighters.originalPoint2;
                            fighters.unit1.x = fighters.unit2.x;
                            fighters.unit1.y = fighters.unit2.y;
                            fighters.unit1.captive = fighters.unit2;
                            fighters.unit2.captor = fighters.unit1;
                        } else if(fighters.result === 1) {
                            fighters.unit2.targetPoint = fighters.originalPoint2;
                            fighters.unit1.dying = true;
                            if(fighters.unit2.captive) {
                                fighters.unit2.captive.captor = false;
                                fighters.unit2.captive.health = 1;
                                fighters.unit2.captive.movement = 0;
                            }
                            for(let i = 0; i < characters.length; i++) {
                                if(characters[i] === fighters.unit1) {
                                    characters.splice(i,1);
                                    break;
                                }
                            }
                        } else {
                            fighters.unit1.targetPoint = fighters.originalPoint1;
                            fighters.unit2.targetPoint = fighters.originalPoint2;
                            fighters.unit1.health = 1;
                            fighters.unit1.movement = 0;
                        }
                    }
                } else {
                    fighters.unit1.targetPoint = fighters.originalPoint1;
                    fighters.unit2.targetPoint = fighters.originalPoint2;
                }
                fighters.phase = 1;
                fighters.ticker = 0;
            } else {
                fighters.phase = 0;
                fighters.ticker = 0;
                if(fighters.reps > 0) {
                    fighters.unit1.targetPoint = {x:fighters.midPointX,y:fighters.midPointY};
                    fighters.unit2.targetPoint = {x:fighters.midPointX,y:fighters.midPointY};
                }
                if(fighters.reps < 1) {
                    drawBoard();
                    state = fighters.returnFunction;
                    fighters.unit1.invisible = false;
                    fighters.unit2.invisible = false;
                    fighters.unit1.sprite.alpha = 1;
                    fighters.unit2.sprite.alpha = 1;
                    if(fighters.result === -1 && fighters.unit1.good) {
                        app.stage.removeChild(fighters.unit2.sprite);
                    } else if(fighters.result === 1 && fighters.unit2.good) {
                        app.stage.removeChild(fighters.unit1.sprite);
                    }
                    fighters.unit1.movement = 0;
                }
            }
        }
    }
    function friendAtTile(x,y) {
        for(let i = 0; i < characters.length; i++) {
            if(characters[i].x === x && characters[i].y === y) {
                if(characters[i].good) {
                    if(!characters[i].captor) {
                        return true;
                    }
                } else {
                    return "enemy";
                }
            }
        }
        return false;
    }
    function getCharacterAt(x,y,captive) {
        for(let i = 0; i < characters.length; i++) {
            if(characters[i].x === x && characters[i].y === y) {
                if((characters[i].captor && captive || (!characters[i].captor && !captive))) { 
                    return characters[i];
                }
            }
        }
        return false;
    }
    function within(x,y,rectX,rectY,width,height) {
        if(x >= rectX && x <= rectX + width && y >= rectY && y <= rectY + height) {
            return true;
        }
        return false;
    }
    function drawBoard() {
        var numOfSquaresToDrawX = Math.ceil(innerWidth/128);
        var numOfSquaresToDrawY = Math.ceil(innerHeight/128);
        boardPieces.removeChildren();
        for(let i = currentBoardY; i < currentBoardY+numOfSquaresToDrawY; i++){
            for(let j = currentBoardX; j < currentBoardX+numOfSquaresToDrawX; j++) {
                if(landscapeSeasonPrime[boardLandcapeState[i][j]] < day) {
                    var tile = new Sprite(resources["sprites/civ/landscape/fall/" + landscape[boardLandcapeState[i][j]]].texture);
                } else {
                    var tile = new Sprite(resources["sprites/civ/landscape/" + landscape[boardLandcapeState[i][j]]].texture);
                }
                tile.y = (i-currentBoardY)*128;
                tile.x = (j-currentBoardX)*128;
                tile.zIndex = 100;
                boardPieces.addChild(tile);
            }
        }
        for(let i = 0; i < characters.length; i++) {
            var character = characters[i];
            if (character.x >= currentBoardX && character.x <= currentBoardX + numOfSquaresToDrawX && character.y >= currentBoardY && character.y <= currentBoardY + numOfSquaresToDrawY) {
                character.sprite.visible = true;

                character.sprite.x = (character.x - currentBoardX) * 128;
                character.sprite.y = (character.y - currentBoardY) * 128;
            } else {
                character.sprite.visible = false;
            }
        }
        for(let i = 0; i < houses.length; i++) {
            var house = houses[i];
            if (house.x >= currentBoardX && house.x <= currentBoardX + numOfSquaresToDrawX && house.y >= currentBoardY && house.y <= currentBoardY + numOfSquaresToDrawY) {
                house.sprite.visible = true;

                house.sprite.x = (house.x - currentBoardX) * 128;
                house.sprite.y = (house.y - currentBoardY) * 128;
            } else {
                house.sprite.visible = false;
            }
        }
    }
    function press(key){
        if(keys[key]){
            keys[key] = false;
            return true;
        }
        return false;
    }
    addEventListener("mousedown",function(e){
        if(e.button == 0) {
            keys.mouse = true;
        } else if(e.button == 2) {
            keys.rightMouse = true;
        }
        mouseX = e.pageX;
        mouseY = e.pageY;
    });
    addEventListener("mouseup",function(e){
        if(e.button == 0) { 
            keys.mouse = false;
        } else if(e.button == 2) {
            keys.rightMouse = true;
        }
    });
    addEventListener("blur", function (){
        keys = {};
    });
    addEventListener("mousemove",function(e){
        mouseX = e.pageX;
        mouseY = e.pageY;
    });
    addEventListener("keydown", function (e){
        keys[e.key] = true;
    });
    addEventListener("keyup", function (e){
        keys[e.key] = false;
    });
  </script>
</body>
</html> 
