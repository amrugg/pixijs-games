<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>RA Blaster</title>
</head>
    <style>* {padding: 0; margin: 0}</style>
    <script src="pixi/pixi.min.js"></script>
    <script src="usefulFunctions.js"></script>
    <script src="howler.core.min.js"></script>
    <div id="central"></div>
    <select style="position:absolute", id="chapter">
        <option>Daniel 1</option>
        <option>Daniel 2</option>
        <option>Daniel 3</option>
        <option>Daniel 4</option>
        <option>Daniel 5</option>
        <option>Daniel 6</option>
        <option>Daniel 1-6</option>
    </select>
    <select style="position:absolute; top: 20px", id="level">
        <option>Invincible</option>
        <option>Novice</option>
        <option>Easy</option>
        <option>Medium</option>
        <option>Hard</option>
        <option>Insane</option>
    </select>
    <input type="text" value="1-4" style="position:absolute; top: 40px", id="range">
    <input type="checkbox" style="position: absolute; top: 60px; z-index: 100;" id="gauntlet"> <span style="position: absolute; left: 15px; top: 60px; z-index: 100; color:white;" id="gauntletT">Gauntlet</span>
    <input type="checkbox" style="position: absolute; top: 80px; z-index: 100;" id="reverse"> <span style="position: absolute; left: 15px; top: 80px; z-index: 100; color:white;" id="reverseT">Reverse (fire weapons with 1, 2, 3)</span>
    <button id="start", style="position: absolute; top: 100px">&nbsp;Start&nbsp;</button>
<body>
  <script type="text/javascript">
    "use strict";
    
    var params = getParams();
    function getParams() {
      var params = {};
      location.search.substr(1).split("&").forEach(function(el) {
        var data = el.replace(/\+/g, " ").split("=");
        params[decodeURIComponent(data[0])] = data[1] ? decodeURIComponent(data[1]) : true;
      });
      return params;
    }
    PIXI.utils.skipHello();
    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;
    let Application = PIXI.Application,
        Container = PIXI.Container,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        TextureCache = PIXI.utils.TextureCache,
        Sprite = PIXI.Sprite,
        Rectangle = PIXI.Rectangle,
        Graphics = PIXI.Graphics;
    let app = new Application({ 
        width: 800,
        height: 800,              
        antialias: true,
        transparent: false,
        resolution: 1
      }
    );
    var chapterEl = document.getElementById("chapter");
    var levelEl = document.getElementById("level");
    levelEl.selectedIndex = 3;
    var inputEl = document.getElementById("range");
    var buttonStartEl = document.getElementById("start");
    var invincible = false;
    var verseTracking = {"1.1": {correct:0,incorrect:1}};
    var restoreHealthWithQuestion = false;
    var toCrack = false;
    var reverse = false;
    chapterEl.style.zIndex = "100";
    levelEl.style.zIndex = "100";
    inputEl.style.zIndex = "100";
    buttonStartEl.style.zIndex = "100";
    buttonStartEl.addEventListener("click", function() {
        if(chapterEl.selectedIndex === 6) {
            chapter = false;
        } else {
            chapter = chapterEl.selectedIndex+1;
        }
        rangeDiv.innerHTML = inputEl.value;
        params.min = inputEl.value.split("-")[0];
        params.max = inputEl.value.split("-")[1];
        questionsLeft = params.max;

        if(levelEl.selectedIndex === 0) {
            difficulty = 1;
            invincible = true;
        } else if(levelEl.selectedIndex === 1) {
            difficulty = 0.25;
            restoreHealthWithQuestion = true;
        } else if(levelEl.selectedIndex === 2) {
            difficulty = 0.5;
            restoreHealthWithQuestion = true;
        } else if(levelEl.selectedIndex === 3) {
            difficulty = 0.75;
        } else if(levelEl.selectedIndex === 4) {
            difficulty = 1;
        } else if(levelEl.selectedIndex === 5) {
            difficulty = 1.25;
        }
        chapterEl.remove();
        levelEl.remove();
        inputEl.remove();
        buttonStartEl.remove();
        reverse = document.getElementById("reverse").checked;
        if(!reverse) {
            toCrack = document.getElementById("gauntlet").checked;
        }
        document.getElementById("gauntlet").remove();
        document.getElementById("gauntletT").remove();
        document.getElementById("reverse").remove();
        document.getElementById("reverseT").remove();
        curVerse = randVerse();
        correctAnswer = curVerse[0];
        curVerse = curVerse[1];
        if(reverse) {
            numDiv.innerHTML = correctAnswer;
            if(keys.ctrl) {
                typeBonus = 1;
            }
        } else {
            textDiv.innerHTML = curVerse;
        }
        intro.fade(0.5,0, 3000);
        setTimeout(function() {
            music.play();
            music.fade(0, 0.5, 3000);
        },3000);
        state = play;
        app.ticker.add(delta => gameLoop(delta));
    });
    var central = document.getElementById("central");
    central.style.position = "absolute";
    central.style.zIndex = "100";
    central.style.width = (innerWidth- 200) + "px";
    central.style.display = "flex";
    central.style.left = "100px";
    // central.style.alignItems = "center";
    central.style.justifyContent = "center";
    app.renderer.backgroundColor = 0x000015;
    /// Fill the screen 
    app.renderer.view.style.position = "absolute";
    app.renderer.view.style.display = "block";
    app.renderer.autoResize = true;
    app.renderer.resize(window.innerWidth, window.innerHeight);
    document.body.appendChild(app.view);
    loader.add(["sprites/exp1.png","sprites/exp2.png","sprites/exp3.png", "sprites/enemy.png", "sprites/rocket.png", "sprites/laser.png", "sprites/medium.png", "sprites/emp.png", "sprites/enemyEMP.png", "sprites/boss1.png", "sprites/missile.png", "sprites/boss2.png", "sprites/drone.png", "sprites/boss3.png", "sprites/enemy-laser.png", "sprites/mothership.png"]).load(setup);
    var textDiv = document.createElement("div");
    textDiv.style.position = "relative";
    // textDiv.innerHTML = "In the beginning was the Word."
    textDiv.style.fontSize = "30px";
    textDiv.style.color = "white";
    central.appendChild(textDiv);
    var numDiv = document.createElement("div");
    numDiv.style.position = "absolute";
    numDiv.style.right = "-100px";
    numDiv.innerHTML = "";
    numDiv.style.fontSize = "30px";
    numDiv.style.color = "white";
    central.appendChild(numDiv);
    var typeBonus = 2;
    var rangeDiv = document.createElement("div");
    rangeDiv.style.position = "absolute";
    rangeDiv.style.left = "-100px";
    rangeDiv.style.top = innerHeight-40 + "px";
    rangeDiv.innerHTML = "1-4";
    params.min = 1;
    params.max = 4;
    var questionsLeft = 4;
    rangeDiv.style.fontSize = "30px";
    rangeDiv.style.color = "white";
    central.appendChild(rangeDiv);
    var energyHolder = new PIXI.Graphics();
    energyHolder.lineStyle(5, 0x00AAAA,10);
    energyHolder.beginFill(0x000015);
    energyHolder.drawRect(0,0,200,25)
    app.stage.addChild(energyHolder);
    energyHolder.x = innerWidth - 225;
    energyHolder.y = innerHeight - 50;
    var energyBar = new PIXI.Graphics();
    energyBar.lineStyle(5, 0x00AAAA,10);
    energyBar.beginFill(0x00AAAA, 10);
    energyBar.drawRect(0,0,200,25);
    energyBar.x = innerWidth - 225;
    energyBar.y = innerHeight - 50;
    app.stage.addChild(energyBar);



    var healthHolder = new PIXI.Graphics();
    healthHolder.lineStyle(5, 0xFF0000,10);
    healthHolder.beginFill(0x000015);
    healthHolder.drawRect(0,0,200,25)
    app.stage.addChild(healthHolder);
    healthHolder.x = innerWidth - 225;
    healthHolder.y = innerHeight - 100;
    var healthBar = new PIXI.Graphics();
    healthBar.lineStyle(5, 0xFF0000,10);
    healthBar.beginFill(0xFF0000, 10);
    healthBar.drawRect(0,0,200,25);
    healthBar.x = innerWidth - 225;
    healthBar.y = innerHeight - 100;
    app.stage.addChild(healthBar);
    var canUseMissiles = false;
    var canUseEMP = false;
    var canUseLaser = false;
    var intro = new Howl({src: ["music/intro.mp3"], autoplay: true, loop: true, volume: 0.5});
    var music = new Howl({src: ["music/level1.mp3"], autoplay: false, loop: true, volume: 0.5});
    /// TODO: Change intro to intro after we get intro and music to battle after the intro ends.
    var boss1 = new Howl({src: ["music/boss1.mp3"], autoplay: false, loop: true, volume: 0});
    var boss2 = new Howl({src: ["music/boss2.mp3"], autoplay: false, loop: true, volume: 0});
    var boss3 = new Howl({src: ["music/boss3.mp3"], autoplay: false, loop: true, volume: 0});
    var mothership = new Howl({src: ["music/mothership.mp3"], autoplay: false, loop: true, volume: 0});

    var gauntletArr = [
        ["In the third year| of the reign of Jehoiakim king of Judah| came Nebuchadnezzar king of Babylon unto Jerusalem,| and besieged it.","And the Lord gave Jehoiakim king of Judah into his hand,| with part of the vessels of the house of God:| which he carried into the land of Shinar| to the house of his god;| and he brought the vessels into the treasure house of his god.","And the king spake unto Ashpenaz the master of his eunuchs,| that he should bring certain of the children of Israel,| and of the king’s seed, and of the princes;","Children in whom was no blemish,| but well favoured, and skilful in all wisdom,| and cunning in knowledge, and understanding science,| and such as had ability in them to stand in the king’s palace,| and whom they might teach the learning and the tongue of the Chaldeans.","And the king appointed them a daily provision of the king’s meat,| and of the wine which he drank:| so nourishing them three years,| that at the end thereof they might stand before the king.","Now among these were of the children of Judah,| Daniel, Hananiah, Mishael, and Azariah:","Unto whom the prince of the eunuchs gave names:| for he gave unto Daniel the name of Belteshazzar;| and to Hananiah, of Shadrach;| and to Mishael, of Meshach;| and to Azariah, of Abed-nego.","But Daniel purposed in his heart that he would not defile himself with the portion of the king’s meat, nor with the wine which he drank:| therefore he requested of the prince of the eunuchs that he might not defile himself.","Now God had brought Daniel| into favour and tender love with the prince of the eunuchs.","And the prince of the eunuchs said unto Daniel,| I fear my lord the king, who hath appointed your meat and your drink:| for why should he see your faces worse liking than the children which are of your sort?| then shall ye make me endanger my head to the king.","Then said Daniel to Melzar,| whom the prince of the eunuchs had set over Daniel, Hananiah, Mishael, and Azariah,","Prove thy servants, I beseech thee, ten days;| and let them give us pulse to eat, and water to drink.","Then let our countenances be looked upon before thee,| and the countenance of the children that eat of the portion of the king’s meat:| and as thou seest, deal with thy servants.","So he consented to them in this matter,| and proved them ten days.","And at the end of ten days| their countenances appeared fairer and fatter in flesh than all the children which did eat the portion of the king’s meat.","Thus Melzar took away the portion of their meat,| and the wine that they should drink;| and gave them pulse.","As for these four children,| God gave them knowledge and skill in all learning and wisdom:| and Daniel had understanding in all visions and dreams.","Now at the end of the days that the king had said he should bring them in,| then the prince of the eunuchs brought them in before Nebuchadnezzar.","And the king communed with them;| and among them all was found none like Daniel, Hananiah, Mishael, and Azariah:| therefore stood they before the king.","And in all matters of wisdom and understanding, that the king inquired of them,| he found them ten times better than all the magicians and astrologers that were in all his realm.","And Daniel continued even unto the first year of king Cyrus."],
        ["And in the second year of the reign of Nebuchadnezzar| Nebuchadnezzar dreamed dreams, wherewith his spirit was troubled,| and his sleep brake from him.","Then the king commanded to call |the magicians, and the astrologers, and the sorcerers, and the Chaldeans,| for to shew the king his dreams.| So they came and stood before the king.","And the king said unto them, |I have dreamed a dream,| and my spirit was troubled to know the dream.","Then spake the Chaldeans to the king in Syriack,| O king, live for ever: tell thy servants the dream,| and we will shew the interpretation.","The king answered and said to the Chaldeans,| The thing is gone from me:| if ye will not make known unto me the dream, with the interpretation thereof,| ye shall be cut in pieces, and your houses shall be made a dunghill.","But if ye shew the dream, and the interpretation thereof,| ye shall receive of me gifts and rewards and great honour:| therefore shew me the dream, and the interpretation thereof.","They answered again and said, Let the king tell his servants the dream,| and we will shew the interpretation of it.","The king answered and said, I know of certainty that ye would gain the time,| because ye see the thing is gone from me.","But if ye will not make known unto me the dream, there is but one decree for you:| for ye have prepared lying and corrupt words to speak before me, till the time be changed:| therefore tell me the dream, and I shall know that ye can shew me the interpretation thereof.","The Chaldeans answered before the king, and said, There is not a man upon the earth that can shew the king’s matter:| therefore there is no king, lord, nor ruler,| that asked such things at any magician, or astrologer, or Chaldean.","And it is a rare thing that the king requireth,| and there is none other that can shew it before the king,| except the gods, whose dwelling is not with flesh.","For this cause the king was angry and very furious,| and commanded to destroy all the wise men of Babylon.","And the decree went forth that the wise men should be slain;| and they sought Daniel and his fellows to be slain.","Then Daniel answered with counsel and wisdom to Arioch the captain of the king’s guard,| which was gone forth to slay the wise men of Babylon:","He answered and said to Arioch the king’s captain, Why is the decree so hasty from the king?| Then Arioch made the thing known to Daniel.","Then Daniel went in, and desired of the king that he would give him time,| and that he would shew the king the interpretation.","Then Daniel went to his house,| and made the thing known to Hananiah, Mishael, and Azariah, his companions:","That they would desire mercies of the God of heaven concerning this secret;| that Daniel and his fellows should not perish with the rest of the wise men of Babylon.","Then was the secret revealed unto Daniel in a night vision.| Then Daniel blessed the God of heaven.","Daniel answered and said, Blessed be the name of God for ever and ever:| for wisdom and might are his:","And he changeth the times and the seasons:| he removeth kings, and setteth up kings:| he giveth wisdom unto the wise,| and knowledge to them that know understanding:","He revealeth the deep and secret things:| he knoweth what is in the darkness,| and the light dwelleth with him.","I thank thee, and praise thee, O thou God of my fathers,| who hast given me wisdom and might,| and hast made known unto me now what we desired of thee:| for thou hast now made known unto us the king’s matter.","Therefore Daniel went in unto Arioch, whom the king had ordained to destroy the wise men of Babylon:| he went and said thus unto him; Destroy not the wise men of Babylon:| bring me in before the king,| and I will shew unto the king the interpretation.","Then Arioch brought in Daniel before the king in haste, and said thus unto him,| I have found a man of the captives of Judah,| that will make known unto the king the interpretation.","The king answered and said to Daniel, whose name was Belteshazzar,| Art thou able to make known unto me the dream which I have seen, and the interpretation thereof?","Daniel answered in the presence of the king, and said,| The secret which the king hath demanded cannot the wise men, the astrologers, the magicians, the soothsayers, shew unto the king;","But there is a God in heaven that revealeth secrets,| and maketh known to the king Nebuchadnezzar| what shall be in the latter days.| Thy dream, and the visions of thy head upon thy bed, are these;","As for thee, O king,| thy thoughts came into thy mind upon thy bed,| what should come to pass hereafter:| and he that revealeth secrets maketh known to thee what shall come to pass.","But as for me, this secret is not revealed| to me for any wisdom that I have more than any living,| but for their sakes that shall make known the interpretation to the king,| and that thou mightest know the thoughts of thy heart.","Thou, O king, sawest, and behold a great image.| This great image, whose brightness was excellent,| stood before thee; and the form thereof was terrible.","This image’s head was of fine gold,| his breast and his arms of silver, his belly and his thighs of brass,","His legs of iron,| his feet part of iron and part of clay.","Thou sawest till that a stone was cut out without hands,| which smote the image upon his feet that were of iron and clay,| and brake them to pieces.","Then was the iron, the clay, the brass, the silver, and the gold,| broken to pieces together, and became like the chaff of the summer threshingfloors;| and the wind carried them away, that no place was found for them:| and the stone that smote the image became a great mountain, and filled the whole earth.","This is the dream;| and we will tell the interpretation thereof before the king.","Thou, O king, art a king of kings:| for the God of heaven hath given thee a kingdom, power, and strength, and glory.","And wheresoever the children of men dwell,| the beasts of the field and the fowls of the heaven hath he given into thine hand,| and hath made thee ruler over them all.| Thou art this head of gold.","And after thee shall arise another kingdom inferior to thee,| and another third kingdom of brass,| which shall bear rule over all the earth.","And the fourth kingdom shall be strong as iron:| forasmuch as iron breaketh in pieces and subdueth all things:| and as iron that breaketh all these,| shall it break in pieces and bruise.","And whereas thou sawest the feet and toes, part of potters’ clay, and part of iron, the kingdom shall be divided;| but there shall be in it of the strength of the iron, forasmuch as thou sawest the iron mixed with miry clay.","And as the toes of the feet were part of iron, and part of clay,| so the kingdom shall be partly strong, and partly broken.","And whereas thou sawest iron mixed with miry clay, they shall mingle themselves with the seed of men:| but they shall not cleave one to another, even as iron is not mixed with clay.","And in the days of these kings shall the God of heaven set up a kingdom, which shall never be destroyed:| and the kingdom shall not be left to other people,| but it shall break in pieces and consume all these kingdoms, and it shall stand for ever.","Forasmuch as thou sawest that the stone was cut out of the mountain without hands,| and that it brake in pieces the iron, the brass, the clay, the silver, and the gold;| the great God hath made known to the king what shall come to pass hereafter:| and the dream is certain, and the interpretation thereof sure.","Then the king Nebuchadnezzar fell upon his face, and worshipped Daniel,| and commanded that they should offer an oblation and sweet odours unto him.","The king answered unto Daniel, and said, Of a truth it is,| that your God is a God of gods, and a Lord of kings,| and a revealer of secrets, seeing thou couldest reveal this secret.","Then the king made Daniel a great man,| and gave him many great gifts, and made him ruler over the whole province of Babylon,| and chief of the governors over all the wise men of Babylon.","Then Daniel requested of the king, and he set Shadrach, Meshach, and Abed-nego,| over the affairs of the province of Babylon:| but Daniel sat in the gate of the king."],
        ["Nebuchadnezzar the king made an image of gold, whose height was threescore cubits,| and the breadth thereof six cubits:| he set it up in the plain of Dura, in the province of Babylon.","Then Nebuchadnezzar the king sent| to gather together the princes, the governors, and the captains, the judges, the treasurers, the counsellers, the sheriffs, and all the rulers of the provinces,| to come to the dedication of the image which Nebuchadnezzar the king had set up.","Then the princes, the governors, and captains, the judges, the treasurers, the counsellers, the sheriffs, and all the rulers of the provinces,| were gathered together unto the dedication of the image that Nebuchadnezzar the king had set up;| and they stood before the image that Nebuchadnezzar had set up.","Then an herald cried aloud,| To you it is commanded, O people, nations, and languages,","That at what time ye hear the sound of the cornet, flute, harp, sackbut, psaltery, dulcimer, and all kinds of musick,| ye fall down and worship the golden image that Nebuchadnezzar the king hath set up:","And whoso falleth not down and worshippeth shall the same hour| be cast into the midst of a burning fiery furnace.","Therefore at that time, when all the people heard the sound of the cornet, flute, harp, sackbut, psaltery, and all kinds of musick,| all the people, the nations, and the languages, fell down and worshipped the golden image that Nebuchadnezzar the king had set up.","Wherefore at that time certain Chaldeans| came near, and accused the Jews.","They spake and said to the king Nebuchadnezzar,| O king, live for ever.","Thou, O king, hast made a decree, that every man that shall hear the sound of the cornet, flute, harp, sackbut, psaltery, and dulcimer, and all kinds of musick,| shall fall down and worship the golden image:","And whoso falleth not down and worshippeth, that he should be cast into the midst of a burning fiery furnace.","There are certain Jews whom thou hast set over the affairs of the province of Babylon, Shadrach, Meshach, and Abed-nego;| these men, O king,| have not regarded thee:| they serve not thy gods, nor worship the golden image which thou hast set up.","Then Nebuchadnezzar in his rage and fury| commanded to bring Shadrach, Meshach, and Abed-nego.| Then they brought these men before the king.","Nebuchadnezzar spake and said unto them, Is it true,| O Shadrach, Meshach, and Abed-nego, do not ye serve my gods,| nor worship the golden image which I have set up?","Now if ye be ready that at what time ye hear the sound of the cornet, flute, harp, sackbut, psaltery, and dulcimer, and all kinds of musick,| ye fall down and worship the image which I have made; well:| but if ye worship not, ye shall be cast the same hour into the midst of a burning fiery furnace;| and who is that God that shall deliver you out of my hands?","Shadrach, Meshach, and Abed-nego, answered and said to the king,| O Nebuchadnezzar, we are not careful to answer thee in this matter.","If it be so, our God whom we serve is able| to deliver us from the burning fiery furnace,| and he will deliver us out of thine hand, O king.","But if not, be it known unto thee, O king,| that we will not serve thy gods, nor worship the golden image which thou hast set up.","Then was Nebuchadnezzar full of fury, and the form of his visage was changed against Shadrach, Meshach, and Abed-nego:| therefore he spake, and commanded that they should heat the furnace one seven times more than it was wont to be heated.","And he commanded the most mighty men that were in his army to bind Shadrach, Meshach, and Abed-nego,| and to cast them into the burning fiery furnace.","Then these men were bound| in their coats, their hosen, and their hats, and their other garments, and were cast into the midst of the burning fiery furnace.","Therefore because the king’s commandment was urgent, and the furnace exceeding hot,| the flame of the fire slew those men that took up Shadrach, Meshach, and Abed-nego.","And these three men, Shadrach, Meshach, and Abed-nego, fell down| bound into the midst of the burning fiery furnace.","Then Nebuchadnezzar the king was astonied,| and rose up in haste,| and spake, and said unto his counsellers,| Did not we cast three men bound into the midst of the fire?| They answered and said unto the king, True, O king.","He answered and said, Lo, I see four men loose,| walking in the midst of the fire,| and they have no hurt;| and the form of the fourth is like the Son of God.","Then Nebuchadnezzar came near to the mouth of the burning fiery furnace,| and spake, and said, Shadrach, Meshach, and Abed-nego, ye servants of the most high God,| come forth, and come hither. Then Shadrach, Meshach, and Abed-nego,| came forth of the midst of the fire.","And the princes, governors, and captains, and the king’s counsellers,| being gathered together, saw these men,| upon whose bodies the fire had no power,| nor was an hair of their head singed,| neither were their coats changed,| nor the smell of fire had passed on them.","Then Nebuchadnezzar spake, and said, Blessed be the God of Shadrach, Meshach, and Abed-nego,| who hath sent his angel, and delivered his servants that trusted in him,| and have changed the king’s word, and yielded their bodies, that they might not serve nor worship any god,| except their own God.","Therefore I make a decree, That every people, nation, and language,| which speak any thing amiss against the God of Shadrach, Meshach, and Abed-nego,| shall be cut in pieces, and their houses shall be made a dunghill:| because there is no other God that can deliver after this sort.","Then the king promoted| Shadrach, Meshach, and Abed-nego, in the province of Babylon."],
        ["Nebuchadnezzar the king, unto all people, nations, and languages,| that dwell in all the earth; Peace be multiplied unto you.","I thought it good| to shew the signs and wonders that the high God hath wrought toward me.","How great are his signs!| and how mighty are his wonders! his kingdom is an everlasting kingdom, and his dominion is from generation to generation.","I Nebuchadnezzar was at rest in mine house,| and flourishing in my palace:","I saw a dream which made me afraid,| and the thoughts upon my bed and the visions of my head troubled me.","Therefore made I a decree to bring in all the wise men of Babylon before me,| that they might make known unto me the interpretation of the dream.","Then came in the magicians, the astrologers, the Chaldeans, and the soothsayers:| and I told the dream before them; but they did not make known unto me the interpretation thereof.","But at the last Daniel came in before me,| whose name was Belteshazzar, according to the name of my god,| and in whom is the spirit of the holy gods: and before him I told the dream, saying,","O Belteshazzar, master of the magicians,| because I know that the spirit of the holy gods is in thee, and no secret troubleth thee, tell me the visions of my dream that I have seen, and the interpretation thereof.","Thus were the visions of mine head in my bed;| I saw, and behold a tree in the midst of the earth,| and the height thereof was great.","The tree grew, and was strong,| and the height thereof reached unto heaven, and the sight thereof to the end of all the earth:","The leaves thereof were fair,| and the fruit thereof much, and in it was meat for all:| the beasts of the field had shadow under it,| and the fowls of the heaven dwelt in the boughs thereof,| and all flesh was fed of it.","I saw in the visions of my head upon my bed,| and, behold, a watcher and an holy one came down from heaven;","He cried aloud, and said thus, Hew down the tree,| and cut off his branches, shake off his leaves, and scatter his fruit:| let the beasts get away from under it,| and the fowls from his branches:","Nevertheless leave the stump of his roots in the earth,| even with a band of iron and brass, in the tender grass of the field;| and let it be wet with the dew of heaven,| and let his portion be with the beasts in the grass of the earth:","Let his heart be changed from man’s, and let a beast’s heart be given unto him;| and let seven times pass over him.","This matter is by the decree of the watchers,| and the demand by the word of the holy ones:| to the intent that the living may know that the most High ruleth in the kingdom of men,| and giveth it to whomsoever he will, and setteth up over it the basest of men.","This dream I king Nebuchadnezzar have seen.| Now thou, O Belteshazzar, declare the interpretation thereof, forasmuch as all the wise men of my kingdom are not able to make known unto me the interpretation: but thou art able; for the spirit of the holy gods is in thee.","Then Daniel, whose name was Belteshazzar, was astonied for one hour,| and his thoughts troubled him.| The king spake, and said, Belteshazzar, let not the dream, or the interpretation thereof, trouble thee.| Belteshazzar answered and said, My lord, the dream be to them that hate thee,| and the interpretation thereof to thine enemies.","The tree that thou sawest, which grew, and was strong,| whose height reached unto the heaven,| and the sight thereof to all the earth;","Whose leaves were fair, and the fruit thereof much, and in it was meat for all;| under which the beasts of the field dwelt, and upon whose branches the fowls of the heaven had their habitation:","It is thou, O king, that art grown and become strong:| for thy greatness is grown, and reacheth unto heaven, and thy dominion to the end of the earth.","And whereas the king saw a watcher and an holy one coming down from heaven,| and saying, Hew the tree down, and destroy it;| yet leave the stump of the roots thereof in the earth, even with a band of iron and brass,| in the tender grass of the field; and let it be wet with the dew of heaven,| and let his portion be with the beasts of the field, till seven times pass over him;","This is the interpretation, O king,| and this is the decree of the most High, which is come upon my lord the king:","That they shall drive thee from men, and thy dwelling shall be with the beasts of the field,| and they shall make thee to eat grass as oxen, and they shall wet thee with the dew of heaven, and seven times shall pass over thee, till thou know that the most High ruleth in the kingdom of men, and giveth it to whomsoever he will.","And whereas they commanded to leave the stump of the tree roots;| thy kingdom shall be sure unto thee,| after that thou shalt have known that the heavens do rule.","Wherefore, O king, let my counsel be acceptable unto thee,| and break off thy sins by righteousness,| and thine iniquities by shewing mercy to the poor;| if it may be a lengthening of thy tranquillity.","All this came upon the king Nebuchadnezzar.","At the end of twelve months he walked| in the palace of the kingdom of Babylon.","The king spake, and said, Is not this great Babylon,| that I have built for the house of the kingdom by the might of my power,| and for the honour of my majesty?","While the word was in the king’s mouth, there fell a voice from heaven, saying,| O king Nebuchadnezzar, to thee it is spoken; The kingdom is departed from thee.","And they shall drive thee from men, and thy dwelling shall be with the beasts of the field:| they shall make thee to eat grass as oxen, and seven times shall pass over thee, until thou know that the most High ruleth in the kingdom of men, and giveth it to whomsoever he will.","The same hour was the thing fulfilled upon Nebuchadnezzar:| and he was driven from men, and did eat grass as oxen,| and his body was wet with the dew of heaven,| till his hairs were grown like eagles’ feathers, and his nails like birds’ claws.","And at the end of the days I Nebuchadnezzar lifted up mine eyes unto heaven,| and mine understanding returned unto me,| and I blessed the most High, and I praised and honoured him that liveth for ever,| whose dominion is an everlasting dominion, and his kingdom is from generation to generation:","And all the inhabitants of the earth are reputed as nothing:| and he doeth according to his will in the army of heaven,| and among the inhabitants of the earth:| and none can stay his hand, or say unto him, What doest thou?","At the same time my reason returned unto me;| and for the glory of my kingdom, mine honour and brightness returned unto me;| and my counsellers and my lords sought unto me; and I was established in my kingdom,| and excellent majesty was added unto me.","Now I Nebuchadnezzar praise and extol and honour the King of heaven,| all whose works are truth,| and his ways judgment:| and those that walk in pride he is able to abase."],
        ["Belshazzar the king made a great feast to a thousand of his lords,| and drank wine before the thousand.","Belshazzar, whiles he tasted the wine,| commanded to bring the golden and silver vessels which his father Nebuchadnezzar| had taken out of the temple which was in Jerusalem; that the king, and his princes, his wives, and his concubines, might drink therein.","Then they brought the golden vessels that were taken out of the temple of the house of God| which was at Jerusalem; and the king, and his princes, his wives, and his concubines, drank in them.","They drank wine, and praised the gods of gold, and of silver, of brass, of iron, of wood, and of stone.","In the same hour came forth fingers of a man’s hand,| and wrote over against the candlestick upon the plaister| of the wall of the king’s palace: and the king saw the part of the hand that wrote.","Then the king’s countenance was changed,| and his thoughts troubled him, so that the joints of his loins were loosed,| and his knees smote one against another.","The king cried aloud to bring in the astrologers, the Chaldeans, and the soothsayers.| And the king spake, and said to the wise men of Babylon,| Whosoever shall read this writing, and shew me the interpretation thereof, shall be clothed with scarlet, and have a chain of gold about his neck, and shall be the third ruler in the kingdom.","Then came in all the king’s wise men:| but they could not read the writing, nor make known to the king the interpretation thereof.","Then was king Belshazzar greatly troubled,| and his countenance was changed in him, and his lords were astonied.","Now the queen,| by reason of the words of the king and his lords, came into the banquet house:| and the queen spake and said, O king, live for ever:| let not thy thoughts trouble thee, nor let thy countenance be changed:","There is a man in thy kingdom,| in whom is the spirit of the holy gods; and in the days of thy father| light and understanding and wisdom, like the wisdom of the gods, was found in him;| whom the king Nebuchadnezzar thy father, the king, I say, thy father, made master of the magicians, astrologers, Chaldeans, and soothsayers;","Forasmuch as an excellent spirit, and knowledge, and understanding, interpreting of dreams, and shewing of hard sentences, and dissolving of doubts,| were found in the same Daniel, whom the king named Belteshazzar: now let Daniel be called, and he will shew the interpretation.","Then was Daniel brought in before the king.| And the king spake and said unto Daniel, Art thou that Daniel,| which art of the children of the captivity of Judah,| whom the king my father brought out of Jewry?","I have even heard of thee, that the spirit of the gods is in thee,| and that light and understanding and excellent wisdom is found in thee.","And now the wise men, the astrologers, have been brought in before me,| that they should read this writing, and make known unto me the interpretation thereof:| but they could not shew the interpretation of the thing:","And I have heard of thee, that thou canst make interpretations, and dissolve doubts:| now if thou canst read the writing, and make known to me the interpretation thereof, thou shalt be clothed with scarlet, and have a chain of gold about thy neck, and shalt be the third ruler in the kingdom.","Then Daniel answered and said before the king, Let thy gifts be to thyself,| and give thy rewards to another;| yet I will read the writing unto the king, and make known to him the interpretation.","O thou king, the most high God gave Nebuchadnezzar| thy father a kingdom, and majesty, and glory, and honour:","And for the majesty that he gave him, all people, nations, and languages, trembled and feared before him:| whom he would he slew;| and whom he would he kept alive;| and whom he would he set up;| and whom he would he put down.","But when his heart was lifted up, and his mind hardened in pride,| he was deposed from his kingly throne,| and they took his glory from him:","And he was driven from the sons of men;| and his heart was made like the beasts,| and his dwelling was with the wild asses:| they fed him with grass like oxen, and his body was wet with the dew of heaven;| till he knew that the most high God ruled in the kingdom of men, and that he appointeth over it whomsoever he will.","And thou his son, O Belshazzar,| hast not humbled thine heart, though thou knewest all this;","But hast lifted up thyself against the Lord of heaven;| and they have brought the vessels of his house before thee, and thou, and thy lords, thy wives, and thy concubines, have drunk wine in them;| and thou hast praised the gods of silver, and gold, of brass, iron, wood, and stone,| which see not, nor hear, nor know: and the God in whose hand thy breath is, and whose are all thy ways, hast thou not glorified:","Then was the part of the hand sent from him;| and this writing was written.","And this is the writing that was written,| MENE, MENE, TEKEL, UPHARSIN.","This is the interpretation of the thing: MENE;| God hath numbered thy kingdom, and finished it.","TEKEL; Thou art weighed in the balances,| and art found wanting.","PERES; Thy kingdom is divided,| and given to the Medes and Persians.","Then commanded Belshazzar, and they clothed Daniel with scarlet,| and put a chain of gold about his neck, and made a proclamation concerning him, that he should be the third ruler in the kingdom.","In that night was Belshazzar the king| of the Chaldeans slain.","And Darius the Median took the kingdom,| being about threescore and two years old."],
        ["It pleased Darius to set over the kingdom| an hundred and twenty princes, which should be over the whole kingdom;","And over these three presidents;| of whom Daniel was first:| that the princes might give accounts unto them, and the king should have no damage.","Then this Daniel was preferred above the presidents and princes,| because an excellent spirit was in him; and the king thought to set him over the whole realm.","Then the presidents and princes sought to find occasion| against Daniel concerning the kingdom;| but they could find none occasion nor fault;| forasmuch as he was faithful, neither was there any error or fault found in him.","Then said these men, We shall not find any occasion against this Daniel,| except we find it against him concerning the law of his God.","Then these presidents and princes assembled together to the king,| and said thus unto him, King Darius, live for ever.","All the presidents of the kingdom, the governors, and the princes, the counsellers, and the captains,| have consulted together to establish a royal statute,| and to make a firm decree, that whosoever shall ask a petition of any God or man for thirty days,| save of thee, O king,| he shall be cast into the den of lions.","Now, O king, establish the decree,| and sign the writing, that it be not changed, according to the law of the Medes and Persians, which altereth not.","Wherefore king Darius signed the writing and the decree.","Now when Daniel knew that the writing was signed,| he went into his house;| and his windows being open in his chamber toward Jerusalem,| he kneeled upon his knees three times a day, and prayed,| and gave thanks before his God, as he did aforetime.","Then these men assembled, and found Daniel| praying and making supplication before his God.","Then they came near, and spake before the king concerning the king’s decree;| Hast thou not signed a decree, that every man that shall ask a petition of any God or man within thirty days,| save of thee, O king, shall be cast into the den of lions?| The king answered and said, The thing is true, according to the law of the Medes and Persians, which altereth not.","Then answered they and said before the king, That Daniel,| which is of the children of the captivity of Judah, regardeth not thee, O king,| nor the decree that thou hast signed, but maketh his petition three times a day.","Then the king, when he heard these words,| was sore displeased with himself,| and set his heart on Daniel to deliver him:| and he laboured till the going down of the sun to deliver him.","Then these men assembled unto the king, and said unto the king, Know, O king,| that the law of the Medes and Persians is, That no decree nor statute which the king establisheth may be changed.","Then the king commanded, and they brought Daniel, and cast him into the den of lions.| Now the king spake and said unto Daniel, Thy God whom thou servest continually,| he will deliver thee.","And a stone was brought,| and laid upon the mouth of the den;| and the king sealed it with his own signet,| and with the signet of his lords;| that the purpose might not be changed concerning Daniel.","Then the king went to his palace, and passed the night fasting:| neither were instruments of musick brought before him:| and his sleep went from him.","Then the king arose very early in the morning,| and went in haste unto the den of lions.","And when he came to the den,| he cried with a lamentable voice unto Daniel:| and the king spake and said to Daniel, O Daniel, servant of the living God,| is thy God, whom thou servest continually, able to deliver thee from the lions?","Then said Daniel unto the king, O king, live for ever.","My God hath sent his angel,| and hath shut the lions’ mouths, that they have not hurt me:| forasmuch as before him innocency was found in me;| and also before thee, O king, have I done no hurt.","Then was the king exceeding glad for him,| and commanded that they should take Daniel up out of the den.| So Daniel was taken up out of the den,| and no manner of hurt was found upon him,| because he believed in his God.","And the king commanded, and they brought those men which had accused Daniel,| and they cast them into the den of lions, them, their children, and their wives;| and the lions had the mastery of them,| and brake all their bones in pieces or ever they came at the bottom of the den.","Then king Darius wrote unto all people, nations, and languages, that dwell in all the earth; Peace be multiplied unto you.","I make a decree, That in every dominion of my kingdom| men tremble and fear before the God of Daniel:| for he is the living God, and stedfast for ever,| and his kingdom that which shall not be destroyed,| and his dominion shall be even unto the end.","He delivereth and rescueth, and he worketh signs and wonders in heaven and in earth,| who hath delivered Daniel from the power of the lions.","So this Daniel prospered in the reign of Darius,| and in the reign of Cyrus the Persian."]
    ]
    var rom18 = [
        ["In the third year of the reign of Jehoiakim king of Judah came Nebuchadnezzar king of Babylon unto Jerusalem, and besieged it.","And the Lord gave Jehoiakim king of Judah into his hand, with part of the vessels of the house of God: which he carried into the land of Shinar to the house of his god; and he brought the vessels into the treasure house of his god.","And the king spake unto Ashpenaz the master of his eunuchs, that he should bring certain of the children of Israel, and of the king’s seed, and of the princes;","Children in whom was no blemish, but well favoured, and skilful in all wisdom, and cunning in knowledge, and understanding science, and such as had ability in them to stand in the king’s palace, and whom they might teach the learning and the tongue of the Chaldeans.","And the king appointed them a daily provision of the king’s meat, and of the wine which he drank: so nourishing them three years, that at the end thereof they might stand before the king.","Now among these were of the children of Judah, Daniel, Hananiah, Mishael, and Azariah:","Unto whom the prince of the eunuchs gave names: for he gave unto Daniel the name of Belteshazzar; and to Hananiah, of Shadrach; and to Mishael, of Meshach; and to Azariah, of Abed-nego.","But Daniel purposed in his heart that he would not defile himself with the portion of the king’s meat, nor with the wine which he drank: therefore he requested of the prince of the eunuchs that he might not defile himself.","Now God had brought Daniel into favour and tender love with the prince of the eunuchs.","And the prince of the eunuchs said unto Daniel, I fear my lord the king, who hath appointed your meat and your drink: for why should he see your faces worse liking than the children which are of your sort? then shall ye make me endanger my head to the king.","Then said Daniel to Melzar, whom the prince of the eunuchs had set over Daniel, Hananiah, Mishael, and Azariah,","Prove thy servants, I beseech thee, ten days; and let them give us pulse to eat, and water to drink.","Then let our countenances be looked upon before thee, and the countenance of the children that eat of the portion of the king’s meat: and as thou seest, deal with thy servants.","So he consented to them in this matter, and proved them ten days.","And at the end of ten days their countenances appeared fairer and fatter in flesh than all the children which did eat the portion of the king’s meat.","Thus Melzar took away the portion of their meat, and the wine that they should drink; and gave them pulse.","As for these four children, God gave them knowledge and skill in all learning and wisdom: and Daniel had understanding in all visions and dreams.","Now at the end of the days that the king had said he should bring them in, then the prince of the eunuchs brought them in before Nebuchadnezzar.","And the king communed with them; and among them all was found none like Daniel, Hananiah, Mishael, and Azariah: therefore stood they before the king.","And in all matters of wisdom and understanding, that the king inquired of them, he found them ten times better than all the magicians and astrologers that were in all his realm.","And Daniel continued even unto the first year of king Cyrus."],
        ["And in the second year of the reign of Nebuchadnezzar Nebuchadnezzar dreamed dreams, wherewith his spirit was troubled, and his sleep brake from him.","Then the king commanded to call the magicians, and the astrologers, and the sorcerers, and the Chaldeans, for to shew the king his dreams. So they came and stood before the king.","And the king said unto them, I have dreamed a dream, and my spirit was troubled to know the dream.","Then spake the Chaldeans to the king in Syriack, O king, live for ever: tell thy servants the dream, and we will shew the interpretation.","The king answered and said to the Chaldeans, The thing is gone from me: if ye will not make known unto me the dream, with the interpretation thereof, ye shall be cut in pieces, and your houses shall be made a dunghill.","But if ye shew the dream, and the interpretation thereof, ye shall receive of me gifts and rewards and great honour: therefore shew me the dream, and the interpretation thereof.","They answered again and said, Let the king tell his servants the dream, and we will shew the interpretation of it.","The king answered and said, I know of certainty that ye would gain the time, because ye see the thing is gone from me.","But if ye will not make known unto me the dream, there is but one decree for you: for ye have prepared lying and corrupt words to speak before me, till the time be changed: therefore tell me the dream, and I shall know that ye can shew me the interpretation thereof.","The Chaldeans answered before the king, and said, There is not a man upon the earth that can shew the king’s matter: therefore there is no king, lord, nor ruler, that asked such things at any magician, or astrologer, or Chaldean.","And it is a rare thing that the king requireth, and there is none other that can shew it before the king, except the gods, whose dwelling is not with flesh.","For this cause the king was angry and very furious, and commanded to destroy all the wise men of Babylon.","And the decree went forth that the wise men should be slain; and they sought Daniel and his fellows to be slain.","Then Daniel answered with counsel and wisdom to Arioch the captain of the king’s guard, which was gone forth to slay the wise men of Babylon:","He answered and said to Arioch the king’s captain, Why is the decree so hasty from the king? Then Arioch made the thing known to Daniel.","Then Daniel went in, and desired of the king that he would give him time, and that he would shew the king the interpretation.","Then Daniel went to his house, and made the thing known to Hananiah, Mishael, and Azariah, his companions:","That they would desire mercies of the God of heaven concerning this secret; that Daniel and his fellows should not perish with the rest of the wise men of Babylon.","Then was the secret revealed unto Daniel in a night vision. Then Daniel blessed the God of heaven.","Daniel answered and said, Blessed be the name of God for ever and ever: for wisdom and might are his:","And he changeth the times and the seasons: he removeth kings, and setteth up kings: he giveth wisdom unto the wise, and knowledge to them that know understanding:","He revealeth the deep and secret things: he knoweth what is in the darkness, and the light dwelleth with him.","I thank thee, and praise thee, O thou God of my fathers, who hast given me wisdom and might, and hast made known unto me now what we desired of thee: for thou hast now made known unto us the king’s matter.","Therefore Daniel went in unto Arioch, whom the king had ordained to destroy the wise men of Babylon: he went and said thus unto him; Destroy not the wise men of Babylon: bring me in before the king, and I will shew unto the king the interpretation.","Then Arioch brought in Daniel before the king in haste, and said thus unto him, I have found a man of the captives of Judah, that will make known unto the king the interpretation.","The king answered and said to Daniel, whose name was Belteshazzar, Art thou able to make known unto me the dream which I have seen, and the interpretation thereof?","Daniel answered in the presence of the king, and said, The secret which the king hath demanded cannot the wise men, the astrologers, the magicians, the soothsayers, shew unto the king;","But there is a God in heaven that revealeth secrets, and maketh known to the king Nebuchadnezzar what shall be in the latter days. Thy dream, and the visions of thy head upon thy bed, are these;","As for thee, O king, thy thoughts came into thy mind upon thy bed, what should come to pass hereafter: and he that revealeth secrets maketh known to thee what shall come to pass.","But as for me, this secret is not revealed to me for any wisdom that I have more than any living, but for their sakes that shall make known the interpretation to the king, and that thou mightest know the thoughts of thy heart.","Thou, O king, sawest, and behold a great image. This great image, whose brightness was excellent, stood before thee; and the form thereof was terrible.","This image’s head was of fine gold, his breast and his arms of silver, his belly and his thighs of brass,","His legs of iron, his feet part of iron and part of clay.","Thou sawest till that a stone was cut out without hands, which smote the image upon his feet that were of iron and clay, and brake them to pieces.","Then was the iron, the clay, the brass, the silver, and the gold, broken to pieces together, and became like the chaff of the summer threshingfloors; and the wind carried them away, that no place was found for them: and the stone that smote the image became a great mountain, and filled the whole earth.","This is the dream; and we will tell the interpretation thereof before the king.","Thou, O king, art a king of kings: for the God of heaven hath given thee a kingdom, power, and strength, and glory.","And wheresoever the children of men dwell, the beasts of the field and the fowls of the heaven hath he given into thine hand, and hath made thee ruler over them all. Thou art this head of gold.","And after thee shall arise another kingdom inferior to thee, and another third kingdom of brass, which shall bear rule over all the earth.","And the fourth kingdom shall be strong as iron: forasmuch as iron breaketh in pieces and subdueth all things: and as iron that breaketh all these, shall it break in pieces and bruise.","And whereas thou sawest the feet and toes, part of potters’ clay, and part of iron, the kingdom shall be divided; but there shall be in it of the strength of the iron, forasmuch as thou sawest the iron mixed with miry clay.","And as the toes of the feet were part of iron, and part of clay, so the kingdom shall be partly strong, and partly broken.","And whereas thou sawest iron mixed with miry clay, they shall mingle themselves with the seed of men: but they shall not cleave one to another, even as iron is not mixed with clay.","And in the days of these kings shall the God of heaven set up a kingdom, which shall never be destroyed: and the kingdom shall not be left to other people, but it shall break in pieces and consume all these kingdoms, and it shall stand for ever.","Forasmuch as thou sawest that the stone was cut out of the mountain without hands, and that it brake in pieces the iron, the brass, the clay, the silver, and the gold; the great God hath made known to the king what shall come to pass hereafter: and the dream is certain, and the interpretation thereof sure.","Then the king Nebuchadnezzar fell upon his face, and worshipped Daniel, and commanded that they should offer an oblation and sweet odours unto him.","The king answered unto Daniel, and said, Of a truth it is, that your God is a God of gods, and a Lord of kings, and a revealer of secrets, seeing thou couldest reveal this secret.","Then the king made Daniel a great man, and gave him many great gifts, and made him ruler over the whole province of Babylon, and chief of the governors over all the wise men of Babylon.","Then Daniel requested of the king, and he set Shadrach, Meshach, and Abed-nego, over the affairs of the province of Babylon: but Daniel sat in the gate of the king."],
        ["Nebuchadnezzar the king made an image of gold, whose height was threescore cubits, and the breadth thereof six cubits: he set it up in the plain of Dura, in the province of Babylon.","Then Nebuchadnezzar the king sent to gather together the princes, the governors, and the captains, the judges, the treasurers, the counsellers, the sheriffs, and all the rulers of the provinces, to come to the dedication of the image which Nebuchadnezzar the king had set up.","Then the princes, the governors, and captains, the judges, the treasurers, the counsellers, the sheriffs, and all the rulers of the provinces, were gathered together unto the dedication of the image that Nebuchadnezzar the king had set up; and they stood before the image that Nebuchadnezzar had set up.","Then an herald cried aloud, To you it is commanded, O people, nations, and languages,","That at what time ye hear the sound of the cornet, flute, harp, sackbut, psaltery, dulcimer, and all kinds of musick, ye fall down and worship the golden image that Nebuchadnezzar the king hath set up:","And whoso falleth not down and worshippeth shall the same hour be cast into the midst of a burning fiery furnace.","Therefore at that time, when all the people heard the sound of the cornet, flute, harp, sackbut, psaltery, and all kinds of musick, all the people, the nations, and the languages, fell down and worshipped the golden image that Nebuchadnezzar the king had set up.","Wherefore at that time certain Chaldeans came near, and accused the Jews.","They spake and said to the king Nebuchadnezzar, O king, live for ever.","Thou, O king, hast made a decree, that every man that shall hear the sound of the cornet, flute, harp, sackbut, psaltery, and dulcimer, and all kinds of musick, shall fall down and worship the golden image:","And whoso falleth not down and worshippeth, that he should be cast into the midst of a burning fiery furnace.","There are certain Jews whom thou hast set over the affairs of the province of Babylon, Shadrach, Meshach, and Abed-nego; these men, O king, have not regarded thee: they serve not thy gods, nor worship the golden image which thou hast set up.","Then Nebuchadnezzar in his rage and fury commanded to bring Shadrach, Meshach, and Abed-nego. Then they brought these men before the king.","Nebuchadnezzar spake and said unto them, Is it true, O Shadrach, Meshach, and Abed-nego, do not ye serve my gods, nor worship the golden image which I have set up?","Now if ye be ready that at what time ye hear the sound of the cornet, flute, harp, sackbut, psaltery, and dulcimer, and all kinds of musick, ye fall down and worship the image which I have made; well: but if ye worship not, ye shall be cast the same hour into the midst of a burning fiery furnace; and who is that God that shall deliver you out of my hands?","Shadrach, Meshach, and Abed-nego, answered and said to the king, O Nebuchadnezzar, we are not careful to answer thee in this matter.","If it be so, our God whom we serve is able to deliver us from the burning fiery furnace, and he will deliver us out of thine hand, O king.","But if not, be it known unto thee, O king, that we will not serve thy gods, nor worship the golden image which thou hast set up.","Then was Nebuchadnezzar full of fury, and the form of his visage was changed against Shadrach, Meshach, and Abed-nego: therefore he spake, and commanded that they should heat the furnace one seven times more than it was wont to be heated.","And he commanded the most mighty men that were in his army to bind Shadrach, Meshach, and Abed-nego, and to cast them into the burning fiery furnace.","Then these men were bound in their coats, their hosen, and their hats, and their other garments, and were cast into the midst of the burning fiery furnace.","Therefore because the king’s commandment was urgent, and the furnace exceeding hot, the flame of the fire slew those men that took up Shadrach, Meshach, and Abed-nego.","And these three men, Shadrach, Meshach, and Abed-nego, fell down bound into the midst of the burning fiery furnace.","Then Nebuchadnezzar the king was astonied, and rose up in haste, and spake, and said unto his counsellers, Did not we cast three men bound into the midst of the fire? They answered and said unto the king, True, O king.","He answered and said, Lo, I see four men loose, walking in the midst of the fire, and they have no hurt; and the form of the fourth is like the Son of God.","Then Nebuchadnezzar came near to the mouth of the burning fiery furnace, and spake, and said, Shadrach, Meshach, and Abed-nego, ye servants of the most high God, come forth, and come hither. Then Shadrach, Meshach, and Abed-nego, came forth of the midst of the fire.","And the princes, governors, and captains, and the king’s counsellers, being gathered together, saw these men, upon whose bodies the fire had no power, nor was an hair of their head singed, neither were their coats changed, nor the smell of fire had passed on them.","Then Nebuchadnezzar spake, and said, Blessed be the God of Shadrach, Meshach, and Abed-nego, who hath sent his angel, and delivered his servants that trusted in him, and have changed the king’s word, and yielded their bodies, that they might not serve nor worship any god, except their own God.","Therefore I make a decree, That every people, nation, and language, which speak any thing amiss against the God of Shadrach, Meshach, and Abed-nego, shall be cut in pieces, and their houses shall be made a dunghill: because there is no other God that can deliver after this sort.","Then the king promoted Shadrach, Meshach, and Abed-nego, in the province of Babylon."],
        ["Nebuchadnezzar the king, unto all people, nations, and languages, that dwell in all the earth; Peace be multiplied unto you.","I thought it good to shew the signs and wonders that the high God hath wrought toward me.","How great are his signs! and how mighty are his wonders! his kingdom is an everlasting kingdom, and his dominion is from generation to generation.","I Nebuchadnezzar was at rest in mine house, and flourishing in my palace:","I saw a dream which made me afraid, and the thoughts upon my bed and the visions of my head troubled me.","Therefore made I a decree to bring in all the wise men of Babylon before me, that they might make known unto me the interpretation of the dream.","Then came in the magicians, the astrologers, the Chaldeans, and the soothsayers: and I told the dream before them; but they did not make known unto me the interpretation thereof.","But at the last Daniel came in before me, whose name was Belteshazzar, according to the name of my god, and in whom is the spirit of the holy gods: and before him I told the dream, saying,","O Belteshazzar, master of the magicians, because I know that the spirit of the holy gods is in thee, and no secret troubleth thee, tell me the visions of my dream that I have seen, and the interpretation thereof.","Thus were the visions of mine head in my bed; I saw, and behold a tree in the midst of the earth, and the height thereof was great.","The tree grew, and was strong, and the height thereof reached unto heaven, and the sight thereof to the end of all the earth:","The leaves thereof were fair, and the fruit thereof much, and in it was meat for all: the beasts of the field had shadow under it, and the fowls of the heaven dwelt in the boughs thereof, and all flesh was fed of it.","I saw in the visions of my head upon my bed, and, behold, a watcher and an holy one came down from heaven;","He cried aloud, and said thus, Hew down the tree, and cut off his branches, shake off his leaves, and scatter his fruit: let the beasts get away from under it, and the fowls from his branches:","Nevertheless leave the stump of his roots in the earth, even with a band of iron and brass, in the tender grass of the field; and let it be wet with the dew of heaven, and let his portion be with the beasts in the grass of the earth:","Let his heart be changed from man’s, and let a beast’s heart be given unto him; and let seven times pass over him.","This matter is by the decree of the watchers, and the demand by the word of the holy ones: to the intent that the living may know that the most High ruleth in the kingdom of men, and giveth it to whomsoever he will, and setteth up over it the basest of men.","This dream I king Nebuchadnezzar have seen. Now thou, O Belteshazzar, declare the interpretation thereof, forasmuch as all the wise men of my kingdom are not able to make known unto me the interpretation: but thou art able; for the spirit of the holy gods is in thee.","Then Daniel, whose name was Belteshazzar, was astonied for one hour, and his thoughts troubled him. The king spake, and said, Belteshazzar, let not the dream, or the interpretation thereof, trouble thee. Belteshazzar answered and said, My lord, the dream be to them that hate thee, and the interpretation thereof to thine enemies.","The tree that thou sawest, which grew, and was strong, whose height reached unto the heaven, and the sight thereof to all the earth;","Whose leaves were fair, and the fruit thereof much, and in it was meat for all; under which the beasts of the field dwelt, and upon whose branches the fowls of the heaven had their habitation:","It is thou, O king, that art grown and become strong: for thy greatness is grown, and reacheth unto heaven, and thy dominion to the end of the earth.","And whereas the king saw a watcher and an holy one coming down from heaven, and saying, Hew the tree down, and destroy it; yet leave the stump of the roots thereof in the earth, even with a band of iron and brass, in the tender grass of the field; and let it be wet with the dew of heaven, and let his portion be with the beasts of the field, till seven times pass over him;","This is the interpretation, O king, and this is the decree of the most High, which is come upon my lord the king:","That they shall drive thee from men, and thy dwelling shall be with the beasts of the field, and they shall make thee to eat grass as oxen, and they shall wet thee with the dew of heaven, and seven times shall pass over thee, till thou know that the most High ruleth in the kingdom of men, and giveth it to whomsoever he will.","And whereas they commanded to leave the stump of the tree roots; thy kingdom shall be sure unto thee, after that thou shalt have known that the heavens do rule.","Wherefore, O king, let my counsel be acceptable unto thee, and break off thy sins by righteousness, and thine iniquities by shewing mercy to the poor; if it may be a lengthening of thy tranquillity.","All this came upon the king Nebuchadnezzar.","At the end of twelve months he walked in the palace of the kingdom of Babylon.","The king spake, and said, Is not this great Babylon, that I have built for the house of the kingdom by the might of my power, and for the honour of my majesty?","While the word was in the king’s mouth, there fell a voice from heaven, saying, O king Nebuchadnezzar, to thee it is spoken; The kingdom is departed from thee.","And they shall drive thee from men, and thy dwelling shall be with the beasts of the field: they shall make thee to eat grass as oxen, and seven times shall pass over thee, until thou know that the most High ruleth in the kingdom of men, and giveth it to whomsoever he will.","The same hour was the thing fulfilled upon Nebuchadnezzar: and he was driven from men, and did eat grass as oxen, and his body was wet with the dew of heaven, till his hairs were grown like eagles’ feathers, and his nails like birds’ claws.","And at the end of the days I Nebuchadnezzar lifted up mine eyes unto heaven, and mine understanding returned unto me, and I blessed the most High, and I praised and honoured him that liveth for ever, whose dominion is an everlasting dominion, and his kingdom is from generation to generation:","And all the inhabitants of the earth are reputed as nothing: and he doeth according to his will in the army of heaven, and among the inhabitants of the earth: and none can stay his hand, or say unto him, What doest thou?","At the same time my reason returned unto me; and for the glory of my kingdom, mine honour and brightness returned unto me; and my counsellers and my lords sought unto me; and I was established in my kingdom, and excellent majesty was added unto me.","Now I Nebuchadnezzar praise and extol and honour the King of heaven, all whose works are truth, and his ways judgment: and those that walk in pride he is able to abase."],
        ["Belshazzar the king made a great feast to a thousand of his lords, and drank wine before the thousand.","Belshazzar, whiles he tasted the wine, commanded to bring the golden and silver vessels which his father Nebuchadnezzar had taken out of the temple which was in Jerusalem; that the king, and his princes, his wives, and his concubines, might drink therein.","Then they brought the golden vessels that were taken out of the temple of the house of God which was at Jerusalem; and the king, and his princes, his wives, and his concubines, drank in them.","They drank wine, and praised the gods of gold, and of silver, of brass, of iron, of wood, and of stone.","In the same hour came forth fingers of a man’s hand, and wrote over against the candlestick upon the plaister of the wall of the king’s palace: and the king saw the part of the hand that wrote.","Then the king’s countenance was changed, and his thoughts troubled him, so that the joints of his loins were loosed, and his knees smote one against another.","The king cried aloud to bring in the astrologers, the Chaldeans, and the soothsayers. And the king spake, and said to the wise men of Babylon, Whosoever shall read this writing, and shew me the interpretation thereof, shall be clothed with scarlet, and have a chain of gold about his neck, and shall be the third ruler in the kingdom.","Then came in all the king’s wise men: but they could not read the writing, nor make known to the king the interpretation thereof.","Then was king Belshazzar greatly troubled, and his countenance was changed in him, and his lords were astonied.","Now the queen, by reason of the words of the king and his lords, came into the banquet house: and the queen spake and said, O king, live for ever: let not thy thoughts trouble thee, nor let thy countenance be changed:","There is a man in thy kingdom, in whom is the spirit of the holy gods; and in the days of thy father light and understanding and wisdom, like the wisdom of the gods, was found in him; whom the king Nebuchadnezzar thy father, the king, I say, thy father, made master of the magicians, astrologers, Chaldeans, and soothsayers;","Forasmuch as an excellent spirit, and knowledge, and understanding, interpreting of dreams, and shewing of hard sentences, and dissolving of doubts, were found in the same Daniel, whom the king named Belteshazzar: now let Daniel be called, and he will shew the interpretation.","Then was Daniel brought in before the king. And the king spake and said unto Daniel, Art thou that Daniel, which art of the children of the captivity of Judah, whom the king my father brought out of Jewry?","I have even heard of thee, that the spirit of the gods is in thee, and that light and understanding and excellent wisdom is found in thee.","And now the wise men, the astrologers, have been brought in before me, that they should read this writing, and make known unto me the interpretation thereof: but they could not shew the interpretation of the thing:","And I have heard of thee, that thou canst make interpretations, and dissolve doubts: now if thou canst read the writing, and make known to me the interpretation thereof, thou shalt be clothed with scarlet, and have a chain of gold about thy neck, and shalt be the third ruler in the kingdom.","Then Daniel answered and said before the king, Let thy gifts be to thyself, and give thy rewards to another; yet I will read the writing unto the king, and make known to him the interpretation.","O thou king, the most high God gave Nebuchadnezzar thy father a kingdom, and majesty, and glory, and honour:","And for the majesty that he gave him, all people, nations, and languages, trembled and feared before him: whom he would he slew; and whom he would he kept alive; and whom he would he set up; and whom he would he put down.","But when his heart was lifted up, and his mind hardened in pride, he was deposed from his kingly throne, and they took his glory from him:","And he was driven from the sons of men; and his heart was made like the beasts, and his dwelling was with the wild asses: they fed him with grass like oxen, and his body was wet with the dew of heaven; till he knew that the most high God ruled in the kingdom of men, and that he appointeth over it whomsoever he will.","And thou his son, O Belshazzar, hast not humbled thine heart, though thou knewest all this;","But hast lifted up thyself against the Lord of heaven; and they have brought the vessels of his house before thee, and thou, and thy lords, thy wives, and thy concubines, have drunk wine in them; and thou hast praised the gods of silver, and gold, of brass, iron, wood, and stone, which see not, nor hear, nor know: and the God in whose hand thy breath is, and whose are all thy ways, hast thou not glorified:","Then was the part of the hand sent from him; and this writing was written.","And this is the writing that was written, MENE, MENE, TEKEL, UPHARSIN.","This is the interpretation of the thing: MENE; God hath numbered thy kingdom, and finished it.","TEKEL; Thou art weighed in the balances, and art found wanting.","PERES; Thy kingdom is divided, and given to the Medes and Persians.","Then commanded Belshazzar, and they clothed Daniel with scarlet, and put a chain of gold about his neck, and made a proclamation concerning him, that he should be the third ruler in the kingdom.","In that night was Belshazzar the king of the Chaldeans slain.","And Darius the Median took the kingdom, being about threescore and two years old."],
        ["It pleased Darius to set over the kingdom an hundred and twenty princes, which should be over the whole kingdom;","And over these three presidents; of whom Daniel was first: that the princes might give accounts unto them, and the king should have no damage.","Then this Daniel was preferred above the presidents and princes, because an excellent spirit was in him; and the king thought to set him over the whole realm.","Then the presidents and princes sought to find occasion against Daniel concerning the kingdom; but they could find none occasion nor fault; forasmuch as he was faithful, neither was there any error or fault found in him.","Then said these men, We shall not find any occasion against this Daniel, except we find it against him concerning the law of his God.","Then these presidents and princes assembled together to the king, and said thus unto him, King Darius, live for ever.","All the presidents of the kingdom, the governors, and the princes, the counsellers, and the captains, have consulted together to establish a royal statute, and to make a firm decree, that whosoever shall ask a petition of any God or man for thirty days, save of thee, O king, he shall be cast into the den of lions.","Now, O king, establish the decree, and sign the writing, that it be not changed, according to the law of the Medes and Persians, which altereth not.","Wherefore king Darius signed the writing and the decree.","Now when Daniel knew that the writing was signed, he went into his house; and his windows being open in his chamber toward Jerusalem, he kneeled upon his knees three times a day, and prayed, and gave thanks before his God, as he did aforetime.","Then these men assembled, and found Daniel praying and making supplication before his God.","Then they came near, and spake before the king concerning the king’s decree; Hast thou not signed a decree, that every man that shall ask a petition of any God or man within thirty days, save of thee, O king, shall be cast into the den of lions? The king answered and said, The thing is true, according to the law of the Medes and Persians, which altereth not.","Then answered they and said before the king, That Daniel, which is of the children of the captivity of Judah, regardeth not thee, O king, nor the decree that thou hast signed, but maketh his petition three times a day.","Then the king, when he heard these words, was sore displeased with himself, and set his heart on Daniel to deliver him: and he laboured till the going down of the sun to deliver him.","Then these men assembled unto the king, and said unto the king, Know, O king, that the law of the Medes and Persians is, That no decree nor statute which the king establisheth may be changed.","Then the king commanded, and they brought Daniel, and cast him into the den of lions. Now the king spake and said unto Daniel, Thy God whom thou servest continually, he will deliver thee.","And a stone was brought, and laid upon the mouth of the den; and the king sealed it with his own signet, and with the signet of his lords; that the purpose might not be changed concerning Daniel.","Then the king went to his palace, and passed the night fasting: neither were instruments of musick brought before him: and his sleep went from him.","Then the king arose very early in the morning, and went in haste unto the den of lions.","And when he came to the den, he cried with a lamentable voice unto Daniel: and the king spake and said to Daniel, O Daniel, servant of the living God, is thy God, whom thou servest continually, able to deliver thee from the lions?","Then said Daniel unto the king, O king, live for ever.","My God hath sent his angel, and hath shut the lions’ mouths, that they have not hurt me: forasmuch as before him innocency was found in me; and also before thee, O king, have I done no hurt.","Then was the king exceeding glad for him, and commanded that they should take Daniel up out of the den. So Daniel was taken up out of the den, and no manner of hurt was found upon him, because he believed in his God.","And the king commanded, and they brought those men which had accused Daniel, and they cast them into the den of lions, them, their children, and their wives; and the lions had the mastery of them, and brake all their bones in pieces or ever they came at the bottom of the den.","Then king Darius wrote unto all people, nations, and languages, that dwell in all the earth; Peace be multiplied unto you.","I make a decree, That in every dominion of my kingdom men tremble and fear before the God of Daniel: for he is the living God, and stedfast for ever, and his kingdom that which shall not be destroyed, and his dominion shall be even unto the end.","He delivereth and rescueth, and he worketh signs and wonders in heaven and in earth, who hath delivered Daniel from the power of the lions.","So this Daniel prospered in the reign of Darius, and in the reign of Cyrus the Persian."]
    ];
    var chapter = Number(params.chapter) || randInt(1,6);
    var currentRandChapter = 0;
    var curVerse = randVerse();
    var correctAnswer = curVerse[0];
    var typingIndex = 0;
    var typingMax = 5;
    var missiles = [];
    curVerse = curVerse[1];
    // textDiv.innerHTML = curVerse;
    var fullLevel = false;
    var difficulty = 0.75;
    function randInt(min, max, not) {
        if(max === undefined) {
            max = min
            min = 1
        }
        var num = Math.floor(Math.random() * (max - min + 1)) + min;
        while(num === not && max-min > 0) {
            num = Math.floor(Math.random() * (max - min + 1)) + min;
        }
        return num;
    }
    function weightedRandInt(min,max, not, chapter) {
        console.log("Min:", min, "Max:", max);
        var weightedArr = [];
        var sum = 0;
        var maxNum = max;
        for(var i = 0; i <= maxNum; i++) {
            if(i < min) {
                weightedArr.push(0);
                continue;
            }
            var score = 1;
            if(verseTracking[getRealChapter(chapter) + "." + (i+1).toString()]) {
                var cur = verseTracking[getRealChapter(chapter) + "." + (i+1).toString()];
                if(cur) {
                    if(cur.correct && cur.incorrect) {
                        score /= cur.correct/cur.incorrect;
                    } else if(cur.correct) {
                        score /= cur.correct;
                    } else {
                        score += cur.incorrect;
                    }
                }
            }
            weightedArr.push(sum+score);
            sum += score;
        }
        console.log("Sum:", sum, "arr:", weightedArr, "not", not);
        var randomNumber = not;
        while(randomNumber === not) {
            var rand = Math.random() * (sum+1);
            for(var i = 0; i < weightedArr.length; i++) {
                if(weightedArr[i] >= rand) {
                    randomNumber = i;
                    i = Infinity;
                }
            }
        }
        if(randomNumber < min) {
            console.log(rand,weightedArr);
        }
        return randomNumber;
    }
    function getRealChapter(chapter) {
        return (chapter).toString();
    }
    function randVerse() {
        if(chapter) {
            var verseArr = rom18[chapter-1];
            var rand = weightedRandInt((params.min ? Number(params.min)-1 : 0), Number(params.max)-1 || verseArr.length-1, (correctAnswer ? Number(correctAnswer.split(".")[1])-1 : -1), chapter);
            if(chapter === 7) {
                var verseNumber = 20 + "." + (rand+1);
            } else {
                var verseNumber = (chapter) + "." + (rand+1);
            }
            if(toCrack) {
                return [verseNumber, crack(gauntletArr[chapter][rand])];
            } else {
                return [verseNumber, verseArr[rand]];
            }
        } else {
            var currentRandChapter = randInt(0,5)
            var verseArr = rom18[currentRandChapter];
            var rand = randInt(0,verseArr.length-1);
            var verseNumber = (currentRandChapter+1) + "." + (rand+1);
            if(toCrack) {
                return [verseNumber, crack(gauntletArr[currentRandChapter-1][rand])];
            } else {
                return [verseNumber, verseArr[rand]];
            }
        }
    }
    function crack(string) {
        var arr = string.split("|");
        for(var i = 0; i < 1; i++) {
            var cur = arr[randInt(0,arr.length-1)].trim();
            if(!overlaps(cur)) {
                return cur;
            }
        }
        return string;
    }
    function overlaps(str) {
        var occurs = 0;
        for(var i = 0; i < gauntletArr.length; i++) {
            var curArr = gauntletArr[i];
            for(var j = 0; j < curArr.length; j++) {
                var cur = curArr[j].split("|");
                cur.forEach(function(e) {
                    if(e.trim() === str) {
                        ++occurs;

                    }
                });
                if(occurs > 1) {
                    return true;
                }
            }
        }
        return false;
    }
    // energyHolder.beginFill();
    var state;
    var keys = {};
    var rocket;
    var enemies = [];
    var explosions = [];
    var mouseX,mouseY;
    var lasers = [];
    var lastFire = 0;
    var reloadTime = 500;
    var energyToFire = 5;
    var healthToHit = 10;
    var emp;
    var enemyEMP;
    var laserGraphics = new PIXI.Graphics();
    laserGraphics.beginFill(0xffffaa);
    laserGraphics.drawRect(-25,0,50, -innerHeight * 2);
    app.stage.addChild(laserGraphics);
    app.stage.sortableChildren = true;
    var scaleFactor = innerWidth/1920;
    var rocketIndicator;
    function setup() {
        spawnNewEnemy(1,"easy");
        rocket = new Sprite(resources["sprites/rocket.png"].texture);
        app.stage.addChild(rocket);
        rocket.anchor.set(0.5,0.5);
        rocket.scale.set(3*scaleFactor);
        rocketIndicator = new Sprite(resources["sprites/rocket.png"].texture);
        app.stage.addChild(rocketIndicator);
        rocketIndicator.anchor.set(0.5,0.5);
        rocketIndicator.scale.set(1.5*scaleFactor);
        rocketIndicator.x = innerWidth - 50*scaleFactor;
        rocketIndicator.y = innerHeight - 200*scaleFactor;
        rocketIndicator.alpha = 0.5;
        rocket.x = innerWidth/2;
        rocket.y = innerHeight - rocket.height;
        rocket.vx = 0;
        rocket.vr = 0;
        rocket.vy = 0;
        rocket.tek = {
            cooldown: 0,
            leftFlare: false,
            rightFlare: false,
            active: 0,
            maxCooldown: 120
        }

        emp = new Sprite(resources["sprites/emp.png"].texture);
        app.stage.addChild(emp);
        emp.anchor.set(0.5,0.5);
        emp.x = 100;
        emp.y = 100;
        emp.visible = false;

        enemyEMP = new Sprite(resources["sprites/enemyEMP.png"].texture);
        app.stage.addChild(enemyEMP);
        enemyEMP.anchor.set(0.5,0.5);
        enemyEMP.x = 100;
        enemyEMP.y = 100;
        enemyEMP.visible = false;
        enemyEMP.zIndex = 10000;
    }
    function gameLoop(delta) {
      state(delta)
    }
    var level = 1;
    function explode(amount, position, magnitude) {
        for(var i = 0; i < amount; i++) {
            if(magnitude) {
                var rand = magnitude/3-0.1;
            } else {
                var rand = Math.random();
            }
            if(rand < 0.33) {
                var explosion = new Sprite(resources["sprites/exp1.png"].texture);
            } else if(rand < 0.66) {
                var explosion = new Sprite(resources["sprites/exp2.png"].texture);
            } else {
                var explosion = new Sprite(resources["sprites/exp3.png"].texture);
            }
            app.stage.addChild(explosion);
            explosion.x = position.x + randInt(-20,20);
            explosion.y = position.y + randInt(-20,20);
            explosions.push(explosion);
            explosion.scale.set(3*scaleFactor);
        }
    }
    function bigExplosion(amount, position, magnitude) {
        for(var i = 0; i < amount; i++) {
            if(magnitude) {
                var rand = magnitude/3-0.1;
            } else {
                var rand = Math.random();
            }
            if(rand < 0.33) {
                var explosion = new Sprite(resources["sprites/exp1.png"].texture);
            } else if(rand < 0.66) {
                var explosion = new Sprite(resources["sprites/exp2.png"].texture);
            } else {
                var explosion = new Sprite(resources["sprites/exp3.png"].texture);
            }
            app.stage.addChild(explosion);
            explosion.x = position.x + randInt(-150,150);
            explosion.y = position.y + randInt(-150,150);
            explosions.push(explosion);
            explosion.scale.set(3*scaleFactor);
        }
    }
    function win() {
        explode(1,{x:enemies[0].x,y:enemies[0].y});
        for(var i = 0; i < explosions.length; i++) {
            explosions[i].alpha -= 0.05;
            if(explosions[i].alpha <= 0) {
                app.stage.removeChild(explosions[i]);
                explosions.splice(i,1);
                --i;
            }
        }

        for(var i = 0; i < lasers.length; i++) {
            lasers[i].alpha -= 0.05;
            if(lasers[i].alpha <= 0) {
                app.stage.removeChild(lasers[i]);
                lasers.splice(i,1);
                --i;
            }
        }


        for(var i = 0; i < missiles.length; i++) {
            missiles[i].alpha -= 0.05;
            if(missiles[i].alpha <= 0) {
                app.stage.removeChild(missiles[i]);
                missiles.splice(i,1);
                --i;
            }
        }
    }
    function die() {
        explode(1,{x:rocket.x,y:rocket.y});
        for(var i = 0; i < explosions.length; i++) {
            explosions[i].alpha -= 0.05;
            if(explosions[i].alpha <= 0) {
                app.stage.removeChild(explosions[i]);
                explosions.splice(i,1);
                --i;
            }
        }
        for(var i = 0; i < enemies.length; i++) {
            enemies[i].alpha -= 0.05;
            if(enemies[i].alpha <= 0) {
                app.stage.removeChild(enemies[i]);
                enemies.splice(i,1);
                --i;
            }
        }

        for(var i = 0; i < lasers.length; i++) {
            lasers[i].alpha -= 0.05;
            if(lasers[i].alpha <= 0) {
                app.stage.removeChild(lasers[i]);
                lasers.splice(i,1);
                --i;
            }
        }


        for(var i = 0; i < missiles.length; i++) {
            missiles[i].alpha -= 0.05;
            if(missiles[i].alpha <= 0) {
                app.stage.removeChild(missiles[i]);
                missiles.splice(i,1);
                --i;
            }
        }
    }
    function play(){
        if(healthBar.width < 0) {
            state = die;
        }
        rocket.ax = 0;
        rocket.ay = 0;
        rocket.ar = 0;
        if(keys.ArrowUp || (keys.w && !reverse)) {
            rocket.ay += -1.1;
        }
        if(keys.ArrowDown || (keys.s && !reverse)) {
            rocket.ay += 1.1;
        }
        if(keys.ArrowLeft || (keys.a && !reverse)) {
            rocket.ax += -1.1;
            rocket.ar += -0.025;
        }
        if(keys.ArrowRight || (keys.d && !reverse)) {
            rocket.ax += 1.1;
            rocket.ar += 0.025;
        }
        if((rocket.tek.cooldown === 0 || rocket.tek.active) && energyBar.width > 0) {
            if(reverse) {
                var leftFlare = keys.ctrl;
                var rightFlare = keys.shift;
            } else {
                var leftFlare = keys.z;
                var rightFlare = keys.x;
            }
            if(leftFlare && rightFlare) {
                rocket.ay += -0.75;
                rocket.tek.cooldown++;
                rocket.tek.active = 5;
                rocket.tek.rightFlare = true;
                rocket.tek.leftFlare = true;
            } else if(leftFlare) {
                rocket.ax += -0.75;
                rocket.tek.cooldown++;
                rocket.tek.active = 5;
                rocket.ar += -0.1;
                rocket.tek.leftFlare = true;
            } else if(rightFlare) {
                rocket.ax += 0.75;
                rocket.tek.cooldown++;
                rocket.tek.active = 5;
                rocket.ar += 0.1;
                rocket.tek.rightFlare = true;
            } else {
                rocket.tek.rightFlare = false;
                rocket.tek.leftFlare = false;
                rocket.tek.active = 0;
                rocket.tek.cooldown -= 1;
                rocket.tek.cooldown = Math.max(rocket.tek.cooldown,0);
            }
            if(rocket.tek.cooldown >= rocket.tek.maxCooldown) {
                rocket.tek.active = 0;
            }
        } else {
            rocket.tek.active = 0;
            rocket.tek.cooldown -= 1;
            rocket.tek.cooldown = Math.max(rocket.tek.cooldown,0);
        }
        if(rocket.tek.active) {
            rocketIndicator.alpha = 1;
        } else if(rocket.tek.cooldown > 0) {
            rocketIndicator.alpha = 0;
        } else {
            rocketIndicator.alpha = 0.5;
        }
        var vector = radDirection(-rocket.height/2, -rocket.rotation);
        var rocketPoint = {x:vector.r + rocket.x,y:vector.u+rocket.y};
        if(keys[" "] && Date.now() - reloadTime > lastFire && energyBar.width >= energyToFire) {
            shootLaser("good", rocketPoint, -rocket.rotation);
            lastFire = Date.now();
            energyBar.width -= energyToFire;
        }
        if(reverse) {
            var missileKey = keys["1"];
            var empKey = keys["2"];
            var laserKey = keys["3"];
        } else {
            var missileKey = keys.m;
            var empKey = keys.e;
            var laserKey = keys.l;
        }
        if(missileKey && energyBar.width >= energyToFire*7 && enemies.length && canUseMissiles) {
            var closestEnemy;
            var closestDist = Infinity;
            for(let i = 0; i < enemies.length; i++) {
                var enemy = enemies[i];
                if(getDistance(rocket.x,rocket.y,enemy.x,enemy.y) < closestDist && enemy.alpha === 1 && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    closestDist = getDistance(rocket.x,rocket.y,enemy.x,enemy.y)
                    closestEnemy = enemy;
                }
            }
            launchMissile("good",  {x:rocket.x, y: rocket.y - rocket.height/2}, closestEnemy, 10);
            keys.m = false;
            keys["1"] = false;
            energyBar.width -= energyToFire*7;
        }
        if(empKey && energyBar.width > 0 && canUseEMP) {
            if(!emp.visible) {
                emp.scale.set(0.5*scaleFactor);
            }
            emp.scale.x += 0.1*scaleFactor;
            emp.scale.y += 0.1*scaleFactor;
            emp.visible = true;
            emp.rotation += 0.1;
            emp.x = rocket.x;
            emp.y = rocket.y;
            energyBar.width -= energyToFire/5;
            for(var i = 0; i < enemies.length; i++) {
                var enemy = enemies[i];
                if(getDistance(enemy.x,enemy.y,emp.x,emp.y) < emp.width/2 && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    explode(1,{x:enemy.x,y:enemy.y});
                    enemy.health -= 0.1;
                }
            }
        } else {
            emp.visible = false;
        }
        if(laserKey && energyBar.width > 0 && canUseLaser) {
            laserGraphics.visible = true;
            for(var i = 0; i < enemies.length; i++) {
                var enemy = enemies[i];
                var enemyRect = {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height/2, width: enemy.width, height: enemy.height};
                var laserRect = {x:laserGraphics.x-25,y:laserGraphics.y-innerHeight*2,width:50,height:innerHeight*2};
                if(hitTestRectangle(laserRect,enemyRect) && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    explode(1,{x:enemy.x,y:enemy.y});
                    enemy.health -= 0.1;
                }
            }
            energyBar.width -= energyToFire/4;
        } else {
            laserGraphics.visible = false;
        }
        if(energyBar.width > Math.abs(rocket.vx/100) + Math.abs(rocket.vy/100)) {
            rocket.vx += rocket.ax;
            rocket.vy += rocket.ay;
            rocket.vr += rocket.ar;
            energyBar.width -= Math.abs(rocket.ax/25)*(energyToFire/5) + Math.abs(rocket.ay/25)*(energyToFire/5);
            if(rocket.tek.active) {
                energyBar.width -= scaleFactor/3;
            }
        }
        rocket.vx *= 0.9;
        rocket.vy *= 0.9;
        rocket.vr *= 0.9;
        rocket.rotation = rocket.vr;
        if(Math.abs(rocket.rotation) < 0.01 && !Math.abs(rocket.ar)) {
            rocket.rotation = 0;
            rocket.vr = 0;
        }
        if(rocket.x > rocket.width/2 && rocket.vx < 0) {
            rocket.x += rocket.vx*scaleFactor;
        } else if(rocket.x + rocket.width/2 < innerWidth && rocket.vx > 0) {
            rocket.x += rocket.vx*scaleFactor;
        }

        if(rocket.y > rocket.height/2 && rocket.vy < 0) {
            rocket.y += rocket.vy*scaleFactor;
        } else if(rocket.y + rocket.height/2 < innerHeight && rocket.vy > 0) {
            rocket.y += rocket.vy*scaleFactor;
        }
        laserGraphics.x = rocket.x;
        laserGraphics.y = rocket.y;

        for(var i = 0; i < missiles.length; i++) {
            var missile = missiles[i];
            if(missile === undefined) {
                break;
            }
            --missile.health;
            if((missile.target ? missile.target.health <= 0 : true) || missile.target.level === "nursing-mother" || missile.target.level === "bossattack") {
                var closestEnemy;
                var closestDist = Infinity;
                for(let i = 0; i < enemies.length; i++) {
                    var enemy = enemies[i];
                    if(getDistance(missile.x,missile.y,enemy.x,enemy.y) < closestDist && enemy.alpha === 1) {
                        closestDist = getDistance(rocket.x,rocket.y,enemy.x,enemy.y)
                        closestEnemy = enemy;
                    }
                }
                if(closestEnemy) {
                    missile.target = closestEnemy;
                } else {
                    explode(1,{x:missile.x,y:missile.y});
                    app.stage.removeChild(missile);
                    missiles.splice(i,1);
                    --i;
                    break;
                }
            }
            if (missile.health <= 0) {
                explode(1,{x:missile.x,y:missile.y});
                app.stage.removeChild(missile);
                missiles.splice(i,1);
                --i;
            }
            missile.rotation = pointTowards(missile.x,missile.y,missile.target.x,missile.target.y) * Math.PI/180;
            missile.rotation *= -1;
            var missileDirection = radDirection(missile.speed, -missile.rotation + Math.PI);
            missile.x += missileDirection.r*scaleFactor;
            missile.y += missileDirection.u*scaleFactor;
            if(missile.y < -10 || missile.y > innerHeight + 10 || missile.x < 10 || missile.x > innerWidth + 10) {
                app.stage.removeChild(missile);
                missiles.splice(i,1);
                --i;
                continue;
            }
            var missileRect = {x: missile.x-missile.width/2, y: missile.y-missile.height/2,width:missile.width,height:missile.height};
            var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
            if(hitTestRectangle(missileRect, rocketRect) && !missile.good) {
                if(!invincible) {
                    if(restoreHealthWithQuestion === true) {
                        healthBar.width -= healthToHit*1.5;
                    } else {
                        healthBar.width -= healthToHit*3;
                    }
                }
                explode(20,{x:missile.x - missile.width, y:missile.y + missile.height});
                app.stage.removeChild(missile);
                missiles.splice(i,1);
                --i;
                continue;
            }
            for(var j = 0; j < enemies.length; j++) { 
                var enemy = enemies[j];
                var enemyRect = {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height/2, width: enemy.width, height: enemy.height};
                if(hitTestRectangle(missileRect, enemyRect) && missile.good && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    enemy.health -= 4;
                    explode(10,{x:missile.x - missile.width, y:missile.y - missile.height});
                    if(enemy.health <= 0) {
                        bigExplosion(100,{x:enemy.x,y:enemy.y});
                    }
                    enemies.forEach(function(enemya){
                        if(getDistance(enemya.x,enemya.y,missile.x,missile.y) < 200 * scaleFactor && enemya !== enemy) {
                            explode(10,{x:enemya.x, y:enemya.y});
                            enemya.health -= 2;
                        }
                    });
                    app.stage.removeChild(missile);
                    missiles.splice(i,1);
                    --i;
                    j = enemies.length;
                    continue;
                }   
            }
        }

        for(var i = 0; i < lasers.length; i++) {
            var laser = lasers[i];
            var laserDirection = radDirection(laser.speed,-laser.rotation + Math.PI);
            laser.x += laserDirection.r*scaleFactor;
            laser.y += laserDirection.u*scaleFactor;
            if(laser.y < -10 || laser.y > innerHeight + 10 || laser.x < 10 || laser.x > innerWidth + 10) {
                app.stage.removeChild(laser);
                lasers.splice(i,1);
                --i;
                continue;
            }
            var laserRect = {x: laser.x-laser.width/2, y: laser.y-laser.height/2,width:laser.width,height:laser.height};
            var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
            if(hitTestRectangle(laserRect, rocketRect) && !laser.good) {
                if(!invincible) {
                    healthBar.width -= healthToHit;
                }
                explode(1,{x:laser.x - laser.width, y:laser.y + laser.height});
                app.stage.removeChild(laser);
                lasers.splice(i,1);
                --i;
                continue;
            }
            for(var j = 0; j < enemies.length; j++) { 
                var enemy = enemies[j];
                var enemyRect = {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height/2, width: enemy.width, height: enemy.height};
                if(hitTestRectangle(laserRect, enemyRect) && laser.good && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    enemy.health--;
                    explode(1,{x:laser.x - laser.width/2, y:laser.y - laser.height/2});
                    if(enemy.health <= 0) {
                        explode(20,{x:enemy.x,y:enemy.y});
                    }
                    app.stage.removeChild(laser);
                    lasers.splice(i,1);
                    --i;
                    j = enemies.length;
                    continue;
                }   
            }
        }
        for(var i = 0; i < formations.length; i++) {
            var formation = formations[i];
            var inSight = false;
            var closestEnemy;
            var closestDist = Infinity;
            formation.forEach(function(enemy){
                if(enemy.health >= 0) {
                    if(enemy.x + enemy.width/2 < rocket.x) {
                    } else if(enemy.x - enemy.width/2 > rocket.x) {
                    } else {
                        inSight = true;
                    }
                    if(getDistance(rocket.x,rocket.y, enemy.x, enemy.y) < closestDist) {
                        closestDist = getDistance(rocket.x,rocket.y, enemy.x, enemy.y);
                        closestEnemy = enemy;
                    }
                }
            });
            var movement = {x:0, y:0}
            if(!inSight) {
                if(closestEnemy) {
                    if(closestEnemy.x < rocket.x) {
                        movement.x = 3;
                    } else {
                        movement.x = -3;
                    }
                } else {
                    formations.splice(i,1);
                    --i;
                }
            }
            formation.forEach(function(child){
                child.formationMovement = movement;
            })
        }
        for(var i = 0; i < enemies.length; i++) {
            var enemy = enemies[i];
            if(enemy.health > 0) {
                if(enemy.level === "easy") {
                    if(enemy.y < innerHeight + 200) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    } else {
                        enemy.y = -400;
                    }
                    if(enemy.x + 5 < rocket.x) {
                        enemy.x += 1.5 * difficulty*scaleFactor;
                    } else if(enemy.x - 5 > rocket.x) {
                        enemy.x -= 1.5 * difficulty*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "boss1") {
                    if(enemy.y < innerHeight + 200) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    } else {
                        enemy.y = -400;
                    }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 7.5*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 7.5*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        launchMissile("bad", {x:enemy.x + enemy.width/3, y: enemy.y}, rocket, 7.5)
                        launchMissile("bad", {x:enemy.x - enemy.width/3, y: enemy.y}, rocket, 7.5);
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "medium") {
                    if(enemy.y < 100) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    }
                    if(Math.abs(rocket.x - enemy.x) < 300) {
                        if((rocket.x > enemy.x || (innerWidth - rocket.x < 300)) && rocket.x >= 300) {
                            enemy.x -= 3 * difficulty*scaleFactor;
                        } else {
                            enemy.x += 3 * difficulty*scaleFactor;
                        }
                    }
                    if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x - enemy.width / 3, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        shootLaser("bad", {x:enemy.x + enemy.width / 3, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "boss2") {
                    enemy.rotation = (0-pointTowards(enemy.x,enemy.y,rocket.x,rocket.y)) * Math.PI/180;
                    if(enemy.y < innerHeight/2) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    }
                    if(Date.now() - enemy.burstRate > enemy.burstFire) {
                        if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                            enemy.bursts--;
                            shootLaser("bad", {x:enemy.x - enemy.width / 3, y: enemy.y}, pointTowards(enemy.x - enemy.width/6,enemy.y,rocket.x,rocket.y) * Math.PI/180);
                            shootLaser("bad", {x:enemy.x + enemy.width / 3, y: enemy.y}, pointTowards(enemy.x + enemy.width/6,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                            enemy.lastFire = Date.now();
                            if(enemy.bursts === 0) {
                                enemy.bursts = 25;
                                enemy.burstFire = Date.now();
                            }
                        }
                    }
                    if(Date.now() - enemy.empRate > enemy.empFire) {
                        --enemy.energy;
                        if(!enemyEMP.visible) {
                            enemyEMP.scale.set(0.5*scaleFactor);
                        }
                        enemyEMP.visible = true;
                        enemyEMP.x = enemy.x;
                        enemyEMP.y = enemy.y;
                        enemyEMP.scale.x += 0.1*scaleFactor;
                        enemyEMP.scale.y += 0.1*scaleFactor;
                        enemyEMP.rotation += 0.1;
                        if(getDistance(rocket.x,rocket.y,enemyEMP.x,enemyEMP.y) < enemyEMP.width/2) {
                            if(!invincible) {
                                healthBar.width -= healthToHit/8;
                            }
                            explode(1,rocket);
                        }
                        if(enemy.energy <= 0) {
                            enemy.energy = innerWidth/10;
                            enemyEMP.visible = false;
                            enemy.empFire = Date.now();
                        }
                    }
                } else if(enemy.level === "drone") {
                    if(enemy.y < innerHeight + 200) {
                        enemy.y += 5 * difficulty*scaleFactor;
                    } else {
                        enemy.y = -400;
                    }
                    if(enemy.formationMovement) {
                        enemy.x += enemy.formationMovement.x*scaleFactor;
                        enemy.y += enemy.formationMovement.y*scaleFactor;
                    }
                    if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x + 10, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x - 10, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x + enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x - enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "boss3") {
                    if(enemy.y < 100) {
                        enemy.y += 5 * difficulty*scaleFactor;
                    }
                    if(enemy.x + enemy.xOffset + 15 < rocket.x) {
                        enemy.x += 2.5*scaleFactor;
                    } else if(enemy.x + enemy.xOffset - 15 > rocket.x) {
                        enemy.x -= 2.5*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x + 10, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x - 10, y: enemy.y}, 180 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x + enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x - enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        enemy.lastFire = Date.now();
                    }

                    if(Date.now() - enemy.backupRate > enemy.backupFire) {
                        spawnNewFormation("drone", "V", 1);
                        enemy.backupFire = Date.now();
                    }
                    if(Date.now() - enemy.laserRate > enemy.laserFire) {
                        --enemy.energy;
                        enemy.laser.visible = true;
                        enemy.laser.x = enemy.x;
                        enemy.laser.y = enemy.y;
                        var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                        var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                        if(hitTestRectangle(laserRect,rocketRect)) {
                            explode(1,{x:rocket.x,y:rocket.y});
                            if(!invincible) {
                                healthBar.width -= 1;
                            }
                        }
                        if(enemy.energy <= 0) {
                            enemy.laser.visible = false;
                            enemy.energy = 150;
                            enemy.laserFire = Date.now();
                        }
                    }
                } else if(enemy.level === "mothership") {
                    if(enemy.alpha < 1) {
                        enemy.alpha += 0.001;
                    }
                    if(enemy.scale.x < 3) {
                        enemy.scale.x += 0.01*scaleFactor;
                        enemy.scale.y += 0.01*scaleFactor;
                    }
                    if(enemy.health < 10) {
                        enemy.level = "nursing-mother";
                        healthBar.width = 200;
                        energyBar.width = 200;
                        enemy.waitTime = Date.now();
                        enemy.waitRate = 40000 * difficulty;
                        enemy.backupRate = 20000;
                        enemy.backupFire = Date.now() - 150000;
                        enemy.laser.visible = false;
                        enemy.laserRate = 40000 * difficulty;
                        enemy.health = Infinity;
                    }
                    if(enemy.y < 150) {
                        enemy.y += 1*scaleFactor;
                    }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 5*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 5*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                        enemy.lastFire = Date.now();
                    }

                    if(Date.now() - enemy.laserRate > enemy.laserFire && enemy.level !== "nursing-mother") {
                        --enemy.energy;
                        enemy.laser.visible = true;
                        enemy.laser.x = enemy.x;
                        enemy.laser.y = enemy.y;
                        var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                        var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                        if(hitTestRectangle(laserRect,rocketRect)) {
                            explode(1,{x:rocket.x,y:rocket.y});
                            if(!invincible) {
                                healthBar.width -= 1;
                            }
                        }
                        if(enemy.energy <= 0) {
                            enemy.laser.visible = false;
                            enemy.energy = 150;
                            enemy.laserFire = Date.now();
                        }
                    }
                } else if(enemy.level === "nursing-mother") {
                    if(enemy.waitTime + enemy.waitRate < Date.now() && enemies.length === 1) {
                        enemy.level = "missileship";
                        healthBar.width = 200;
                        energyBar.width = 200;
                        enemy.health = 250*difficulty;
                        enemy.lastFire = Date.now();
                    }
                    if(enemy.alpha > 0.5) {
                        enemy.alpha -= 0.001;
                    }
                    if(enemy.scale.x > 1*scaleFactor) {
                        enemy.scale.x -= 0.01*scaleFactor;
                        enemy.scale.y -= 0.01*scaleFactor;
                    }
                    // if(enemy.y > -350) {
                        // enemy.y -= 3;
                    // }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 2*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 2*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                        // enemy.lastFire = Date.now();
                    }
                    if(Date.now() - enemy.backupRate > enemy.backupFire && (enemy.waitTime + enemy.waitRate > Date.now())) {
                        var formationTypeToSummon = randInt(1,6);
                        if(formationTypeToSummon < 2) {
                            spawnNewFormation("drone", "V", 7);
                        } else if(formationTypeToSummon < 3) {
                            spawnNewFormation("drone", "N", 7);
                        } else if(formationTypeToSummon < 4) {
                            spawnNewEnemy(10, "easy");
                        } else if(formationTypeToSummon < 5) {
                            spawnNewEnemy(4, "medium");
                        } else if(formationTypeToSummon < 6) {
                            spawnNewEnemy(4, "medium");
                            spawnNewEnemy(4, "easy");
                        } else {
                            spawnNewFormation("drone", "V", 5);
                            spawnNewFormation("drone", "N", 5);
                        }
                        enemy.backupFire = Date.now();
                    }
                    if(Date.now() - enemy.laserRate > enemy.laserFire) {
                        // --enemy.energy;
                        // enemy.laser.visible = true;
                        // enemy.laser.x = enemy.x;
                        // enemy.laser.y = enemy.y;
                        // var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                        // var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                        // if(hitTestRectangle(laserRect,rocketRect)) {
                        //     explode(1,{x:rocket.x,y:rocket.y});
                        //     if(!invincible) {
                        //         healthBar.width -= 1;
                        //     }
                        // }
                        // if(enemy.energy <= 0) {
                        //     enemy.laser.visible = false;
                        //     enemy.energy = 150;
                        //     enemy.laserFire = Date.now();
                        // }
                    }
                    
                } else if(enemy.level === "missileship") {
                    if(enemy.alpha < 1) {
                        enemy.alpha += 0.001;
                    }
                    if(enemy.scale.x < 3*scaleFactor) {
                        enemy.scale.x += 0.01*scaleFactor;
                        enemy.scale.y += 0.01*scaleFactor;
                    }
                    if(enemy.health < 10) {
                        healthBar.width = 200;
                        energyBar.width = 200;
                        enemy.level = "bossattack";
                        enemy.waitTime = Date.now();
                        enemy.waitRate = 40000 * difficulty;
                        enemy.backupRate = 20000;
                        enemy.backupFire = Date.now() - 150000;
                        enemy.laser.visible = false;
                        // enemy.laserRate = 40000 * difficulty;
                        enemy.health = Infinity;
                        enemy.bossesToSpawn = 3;

                    }
                    if(enemy.y < 150) {
                        enemy.y += 1*scaleFactor;
                    }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 5*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 5*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                        launchMissile("bad", {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                        launchMissile("bad", {x: enemy.x + enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                        launchMissile("bad", {x: enemy.x, y: enemy.y + enemy.height / 2.1}, rocket, 5);
                        enemy.lastFire = Date.now();
                    }

                    // if(Date.now() - enemy.laserRate > enemy.laserFire && enemy.level !== "nursing-mother") {
                    //     --enemy.energy;
                    //     enemy.laser.visible = true;
                    //     enemy.laser.x = enemy.x;
                    //     enemy.laser.y = enemy.y;
                    //     var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                    //     var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                    //     if(hitTestRectangle(laserRect,rocketRect)) {
                    //         explode(1,{x:rocket.x,y:rocket.y});
                    //         if(!invincible) {
                    //             healthBar.width -= 1;
                    //         }
                    //     }
                    //     if(enemy.energy <= 0) {
                    //         enemy.laser.visible = false;
                    //         enemy.energy = 150;
                    //         enemy.laserFire = Date.now();
                    //     }
                    } else if(enemy.level === "bossattack") {
                        if(enemy.alpha > 0.5) {
                            enemy.alpha -= 0.001;
                        }
                        if(enemy.scale.x > 1*scaleFactor) {
                            enemy.scale.x -= 0.01*scaleFactor;
                            enemy.scale.y -= 0.01*scaleFactor;
                        }
                        if(enemies.length === 1) {
                            if(enemy.bossesToSpawn === 3) {
                                --enemy.bossesToSpawn;
                                spawnNewEnemy(1, "boss1");
                            } else if(enemy.bossesToSpawn === 2) {
                                spawnNewEnemy(1, "boss2");
                                --enemy.bossesToSpawn;
                            } else if(enemy.bossesToSpawn === 1) {
                                spawnNewEnemy(1, "boss3")[0].xOffset = 200;
                                spawnNewEnemy(1, "boss3")[0].xOffset = -200;
                                spawnNewEnemy(1, "boss3")[0].xOffset = 0;
                                --enemy.bossesToSpawn;
                            } else {
                                healthBar.width = 200;
                                energyBar.width = 200;
                                enemy.level = "maxxforce";
                                enemy.health = 250*difficulty;
                                enemy.lastFire = Date.now();
                                enemy.empFire = Date.now();
                                enemy.empRate = 17500/difficulty;
                                enemy.EMPenergy = innerWidth / 10;
                            }
                        }
                        if(enemy.alpha > 0.5) {
                            enemy.alpha -= 0.001;
                        }
                        if(enemy.scale.x > 1*scaleFactor) {
                            enemy.scale.x -= 0.01*scaleFactor;
                            enemy.scale.y -= 0.01*scaleFactor;
                        }
                        // if(enemy.y > -350) {
                            // enemy.y -= 3;
                        // }
                        if(enemy.x + 15 < rocket.x) {
                            enemy.x += 2*scaleFactor;
                        } else if(enemy.x - 15 > rocket.x) {
                            enemy.x -= 2*scaleFactor;
                        } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                            // enemy.lastFire = Date.now();
                        }
                        // if(Date.now() - enemy.backupRate > enemy.backupFire && (enemy.waitTime + enemy.waitRate > Date.now())) {
                        //     var formationTypeToSummon = randInt(1,6);
                        //     if(formationTypeToSummon < 2) {
                        //         spawnNewFormation("drone", "V", 7);
                        //     } else if(formationTypeToSummon < 3) {
                        //         spawnNewFormation("drone", "N", 7);
                        //     } else if(formationTypeToSummon < 4) {
                        //         spawnNewEnemy(10, "easy");
                        //     } else if(formationTypeToSummon < 5) {
                        //         spawnNewEnemy(4, "medium");
                        //     } else if(formationTypeToSummon < 6) {
                        //         spawnNewEnemy(4, "medium");
                        //         spawnNewEnemy(4, "easy");
                        //     } else {
                        //         spawnNewFormation("drone", "V", 5);
                        //         spawnNewFormation("drone", "N", 5);
                        //     }
                        //     enemy.backupFire = Date.now();
                        // }
                        if(Date.now() - enemy.laserRate > enemy.laserFire) {
                            // --enemy.energy;
                            // enemy.laser.visible = true;
                            // enemy.laser.x = enemy.x;
                            // enemy.laser.y = enemy.y;
                            // var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                            // var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                            // if(hitTestRectangle(laserRect,rocketRect)) {
                            //     explode(1,{x:rocket.x,y:rocket.y});
                            //     if(!invincible) {
                            //         healthBar.width -= 1;
                            //     }
                            // }
                            // if(enemy.energy <= 0) {
                            //     enemy.laser.visible = false;
                            //     enemy.energy = 150;
                            //     enemy.laserFire = Date.now();
                            // }
                        }
                    } else if(enemy.level === "maxxforce") {
                        if(enemy.alpha < 1) {
                            enemy.alpha += 0.001;
                        }
                        if(enemy.scale.x < 3*scaleFactor) {
                            enemy.scale.x += 0.01*scaleFactor;
                            enemy.scale.y += 0.01*scaleFactor;
                        }
                        if(enemy.health < 5) {
                            
                            state = win;
                            textDiv.innerHTML = "You win!";
                        }
                        if(enemy.y < 150) {
                            enemy.y += 1*scaleFactor;
                        }
                        if(enemy.x + 15 < rocket.x) {
                            enemy.x += 5*scaleFactor;
                        } else if(enemy.x - 15 > rocket.x) {
                            enemy.x -= 5*scaleFactor;
                        } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                            launchMissile("bad", {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                            launchMissile("bad", {x: enemy.x + enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                            launchMissile("bad", {x: enemy.x, y: enemy.y + enemy.height / 2.1}, rocket, 5);
                            enemy.lastFire = Date.now();
                        }

                        if(Date.now() - enemy.empRate > enemy.empFire) {
                            --enemy.EMPenergy;
                            if(!enemyEMP.visible) {
                                enemyEMP.scale.set(0.5*scaleFactor);
                            }
                            enemyEMP.visible = true;
                            enemyEMP.x = enemy.x;
                            enemyEMP.y = enemy.y;
                            enemyEMP.scale.x += 0.1*scaleFactor;
                            enemyEMP.scale.y += 0.1*scaleFactor;
                            enemyEMP.rotation += 0.1;
                            if(getDistance(rocket.x,rocket.y,enemyEMP.x,enemyEMP.y) < enemyEMP.width/2) {
                                if(!invincible) {
                                    healthBar.width -= healthToHit/8;
                                }
                                explode(1,rocket);
                            }
                            if(enemy.EMPenergy <= 0) {
                                enemy.EMPenergy = innerWidth/10;
                                enemyEMP.visible = false;
                                enemy.empFire = Date.now();
                            }
                        }
                        if(Date.now() - enemy.laserRate > enemy.laserFire && enemy.level !== "nursing-mother") {
                            --enemy.energy;
                            enemy.laser.visible = true;
                            enemy.laser.x = enemy.x;
                            enemy.laser.y = enemy.y;
                            var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                            var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                            if(hitTestRectangle(laserRect,rocketRect)) {
                                explode(1,{x:rocket.x,y:rocket.y});
                                if(!invincible) {
                                    healthBar.width -= 1;
                                }
                            }
                            if(enemy.energy <= 0) {
                                enemy.laser.visible = false;
                                enemy.energy = 150;
                                enemy.laserFire = Date.now();
                            }
                        }
                    }
            } else {
                enemy.alpha -= 0.05;
                enemyEMP.visible = false;
                if (enemy.alpha <= 0) {
                    if(enemy.level === "boss1" && enemies[0].level !== "bossattack") {
                        healthBar.width = 200;
                        healthToHit -= 2;
                        energyToFire--;
                        energyBar.width = 200;
                        boss1.fade(0.5,0, 3000);
                        setTimeout(function() {
                            music.fade(0, 0.5, 3000);
                        },3000);
                        canUseMissiles = true;
                    }
                    if(enemy.level === "boss2" && enemies[0].level !== "bossattack") {
                        healthBar.width = 200;
                        healthToHit -= 2;
                        energyToFire--;
                        energyBar.width = 200;
                        boss2.fade(0.5,0, 3000);
                        setTimeout(function() {
                            music.fade(0, 0.5, 3000);
                        },3000);
                        canUseEMP = true;
                    } else if(enemy.level === "boss3" && enemy.xOffset === 0 && enemies[0].level !== "bossattack") {
                        var foundEnemy1 = false;
                        var foundEnemy2 = false;
                        enemies.forEach(function(bad) {
                            if(bad.xOffset === -200) {
                                foundEnemy1 = bad;
                            } else if(bad.xOffset === 200) {
                                foundEnemy2 = bad;
                            }
                        });
                        if(foundEnemy1) {
                            foundEnemy1.xOffset = 0;
                        } else if(foundEnemy2) {
                            foundEnemy2.xOffset = 0;
                        } else {
                            healthBar.width = 200;
                            reloadTime /= 2;
                            energyBar.width = 200;
                            boss3.fade(0.5,0, 3000);
                            setTimeout(function() {
                                music.fade(0, 0.5, 3000);
                            },3000);
                        }
                        canUseLaser = true;
                    }
                    if(enemy.laser) {
                        enemy.laser.visible = false;
                    }
                    app.stage.removeChild(enemy);
                    enemies.splice(i,1);
                    --i;
                }
            }
        }
        if(enemies.length === 0) {
            ++level;
            difficulty += 0.05;
            if(level < 6) {
                spawnNewEnemy(level, "easy");
            } else if (level < 6.1) {
                spawnNewEnemy(1, "boss1");
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    boss1.play();
                    boss1.fade(0,0.5,2000);
                }, 2000);
            } else if(level < 8) {
                spawnNewEnemy(2, "medium");
            } else if(level < 10) {
                spawnNewEnemy(3, "medium");
            } else if(level < 11) {
                spawnNewEnemy(4, "medium");
            } else if(level < 11.1) {
                spawnNewEnemy(1, "boss2");
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    boss2.play();
                    boss2.fade(0,0.5,2000);
                }, 2000);
            } else if(level < 12) {
                spawnNewFormation("drone", "V", 4);
            } else if(level < 13) {
                spawnNewFormation("drone", "N", 5);
            } else if(level < 14) {
                spawnNewFormation("drone", "V", 7);
            } else if (level < 15) {
                spawnNewFormation("drone", "N", 9);
            } else if(level < 16) {
                spawnNewFormation("drone", "N", 5);
                spawnNewFormation("drone", "V", 5);
            } else if(level < 16.1) {
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    boss3.play();
                    boss3.fade(0,0.5,2000);
                }, 2000);
                spawnNewEnemy(1, "boss3")[0].xOffset = 200;
                spawnNewEnemy(1, "boss3")[0].xOffset = -200;
                spawnNewEnemy(1, "boss3")[0].xOffset = 0;
            } else if(fullLevel) {
                spawnNewEnemy(1, "mothership");
                if(levelEl.selectedIndex === 0) {
                    difficulty = 1;
                    invincible = true;
                } else if(levelEl.selectedIndex === 1) {
                    difficulty = 0.25;
                } else if(levelEl.selectedIndex === 2) {
                    difficulty = 0.5;
                } else if(levelEl.selectedIndex === 3) {
                    difficulty = 0.75;
                } else if(levelEl.selectedIndex === 4) {
                    difficulty = 1;
                } else if(levelEl.selectedIndex === 5) {
                    difficulty = 1.25;
                }
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    mothership.play();
                    mothership.fade(0,0.5,2000);
                }, 2000);
            } else {
                spawnNewEnemy(level/5, "medium");
                spawnNewEnemy(level/5, "easy");
                if(level > 20) {
                    spawnNewFormation("drone", "N", 5);
                    spawnNewFormation("drone", "V", 5);
                    fullLevel = true;
                } else if(level > 19) {
                    spawnNewFormation("drone", "N", 5);
                } else if(level > 18) {
                    spawnNewFormation("drone", "V", 3);
                }
            }
        }
        for(var i = 0; i < explosions.length; i++) {
            explosions[i].alpha -= 0.05;
            if(explosions[i].alpha <= 0) {
                app.stage.removeChild(explosions[i]);
                explosions.splice(i,1);
                --i;
            }
        }
    }
    var formations = [];
    function spawnNewFormation(type, formation, endSize) {
        var set = [];
        if(formation === "V") {
            var counter = Math.floor((innerWidth/2-100)/100);
            for(var i = ((Math.ceil(innerWidth/200) * 100 ) -endSize*100); i < innerWidth/2; i+=100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                --counter;
            }
            // i += 100;
            for(i; i < innerWidth/2 + endSize*100; i += 100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                ++counter;
            }
        } else if(formation === "N") {
            var counter = Math.floor((innerWidth/2-100)/100);
            for(var i = ((Math.ceil(innerWidth/200) * 100 ) -endSize*100); i < innerWidth/2; i+=100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                ++counter;
            }
            // i += 100;
            for(i; i < innerWidth/2 + endSize*100; i += 100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                --counter;
            }
        }
        for(let i = 0; i < set.length; i++) {
            set[i].formation = set;
            set[i].formationMovement = {x:0,y:0};
        }
        formations.push(set);
    }
    function spawnNewEnemy(amount, type, position) {
        var y = -200;
        var enemiesAdded = [];
        for(let i = 0; i < amount; i++) {
            if(type === "easy") {
                var enemy = new Sprite(resources["sprites/enemy.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = y;
                }
                enemy.rotation = Math.PI;
                enemy.health = randInt(0.5,1.5) * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 3000/difficulty;
            } else if (type === "medium") {
                var enemy = new Sprite(resources["sprites/medium.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = y;
                }
                enemy.rotation = Math.PI;
                enemy.health = randInt(5,7) * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 5000/difficulty;
            } else if(type === "boss1") {
                var enemy = new Sprite(resources["sprites/boss1.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 15 * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 5000/difficulty;
                if(enemies[0]) {
                    if(enemies[0].level === "bossattack") {
                        enemy.health *= 3;
                    }
                }
            } else if(type === "boss2") {
                var enemy = new Sprite(resources["sprites/boss2.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = innerWidth/2;
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 20 * difficulty;
                enemy.burstFire = 0;
                enemy.burstRate = 10000/difficulty;
                enemy.lastFire = Date.now();
                enemy.reloadTime = 100/difficulty;
                enemy.empFire = Date.now();
                enemy.empRate = 17500/difficulty;
                enemy.bursts = 25;
                enemy.energy = innerWidth/10;
                if(enemies[0]) {
                    if(enemies[0].level === "bossattack") {
                        enemy.health *= 3;
                    }
                }
            } else if(type === "drone") {
                var enemy = new Sprite(resources["sprites/drone.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = y;
                }
                enemy.rotation = Math.PI;
                enemy.health = randNum(0.1,0.5) * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 3000/difficulty;
            } else if(type === "boss3") {
                var enemy = new Sprite(resources["sprites/boss3.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 15 * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 5000/difficulty;
                enemy.laserFire = Date.now();
                enemy.laserRate = 10000/difficulty;
                enemy.energy = 150;
                enemy.backupFire = Date.now() - randInt(0, 30000);
                enemy.backupRate = 55000/difficulty;
                enemy.laser = new PIXI.Graphics();
                enemy.laser.beginFill(0xffaaaa);
                enemy.laser.drawRect(-25,0,50, innerHeight * 2);
                app.stage.addChild(enemy.laser);
                enemy.laser.visible = false;
                if(enemies[0]) {
                    if(enemies[0].level === "bossattack") {
                        enemy.health *= 1.5;
                    }
                }
            } else if(type === "mothership") {
                var enemy = new Sprite(resources["sprites/mothership.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 100 * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 2500/difficulty;
                enemy.laserFire = Date.now();
                enemy.laserRate = 5000/difficulty;
                enemy.energy = 200;
                enemy.backupFire = Date.now() - randInt(0, 30000);
                enemy.backupRate = 55000/difficulty;
                enemy.laser = new PIXI.Graphics();
                enemy.laser.beginFill(0xffaaaa);
                enemy.laser.drawRect(-25,0,50, innerHeight * 2);
                app.stage.addChild(enemy.laser);
                enemy.laser.visible = false;
            }
            enemiesAdded.push(enemy);
            enemy.level = type;
            enemies.push(enemy);
            y -= 150 + randInt(25,100);
        }
        return enemiesAdded;
    }
    function launchMissile(type, position, target, speed) {
        if(type === "good") {
            var laser = new Sprite(resources["sprites/missile.png"].texture);
            laser.good = true;
        } else {
            /// TODO: Red
            var laser = new Sprite(resources["sprites/missile.png"].texture);
            laser.good = false;
        }
        laser.speed = speed;
        laser.x = position.x;
        laser.y = position.y;
        laser.anchor.set(0.5,0.5);
        if(type === "good") {
            laser.health = 300;
        } else {
            laser.health = 200;
        }
        laser.target = target;
        missiles.push(laser);
        app.stage.addChild(laser);
    }
    var storeRange;
    function shootLaser(type, position, dir) {
        if(type === "good") {
            var laser = new Sprite(resources["sprites/laser.png"].texture);
            laser.good = true;
        } else {
            var laser = new Sprite(resources["sprites/enemy-laser.png"].texture);
            laser.good = false;
        }
        laser.x = position.x;
        laser.y = position.y;
        laser.anchor.set(0.5,0.5);
        laser.speed = 20;
        if(type === "good" && rocket.tek.leftFlare && rocket.tek.rightFlare && keys.ArrowUp) {
            laser.speed = 40;
        }
        laser.scale.set(3*scaleFactor);
        laser.rotation = -dir;
        lasers.push(laser);
        app.stage.addChild(laser);
    }
    function press(key){
        if(keys[key]){
            keys[key] = false;
            return true;
        }
        return false;
    }
    addEventListener("mousedown",function(e){
        if(e.button == 0) {
            keys.mouse = true;
        } else if(e.button == 2) {
            keys.rightMouse = true;
        }
        mouseX = e.pageX;
        mouseY = e.pageY;
    });
    addEventListener("mouseup",function(e){
        if(e.button == 0) { 
            keys.mouse = false;
        } else if(e.button == 2) {
            keys.rightMouse = true;
        }
    });
    addEventListener("blur", function (){
        keys = {};
    });
    addEventListener("mousemove",function(e){
        mouseX = e.pageX;
        mouseY = e.pageY;
    });
    var learnSpeed = 2;
    var answersLocked = false;
    var code = ["R", "E", "S", "T", "O", "R", "E"];
    var codeNum = 0;
    var mistakeReview = false;
    addEventListener("keydown", function (e){
        if(code[codeNum] === e.key) {
            ++codeNum;
            if(codeNum === code.length) {
                codeNum = 0;
                healthBar.width = 200;
                energyBar.width = 200;
                if(!invincible) {
                    invincible = true;
                    rocket.alpha = 0.5;
                    setTimeout(function() {
                        invincible = false;
                        rocket.alpha = 1;
                    }, 5000);
                }
            }
        }
        if(!reverse) {
            handleNumber(e);
        } else {
            e.preventDefault();
            handleText(e);
        }
        keys[e.key] = true;
        if(e.ctrlKey) {
            keys.ctrl = true;
        }
        if(e.shiftKey) {
            keys.shift = true;
        }
        if(e.altKey) {
            keys.alt = true;
        }
    });
    function handleText(e) {
        if(answersLocked) {
            return;
        }
        if(e.key === "Enter") {
            answersLocked = true;
            textDiv.innerHTML = curVerse;
            textDiv.style.color = "green";
            setTimeout(function() {
                textDiv.style.color = "white";
                answersLocked = false;
                typingIndex = 0;
                textDiv.innerHTML = "";
                curVerse = randVerse();
                correctAnswer = curVerse[0];
                curVerse = curVerse[1];
                numDiv.innerHTML = correctAnswer;
            },3000);
        } else {
            var keystroke = e.key.toLowerCase();
            var words = curVerse.split(" ");
            if(keystroke === words[typingIndex][0].toLowerCase()) {
                textDiv.innerHTML += words[typingIndex++] + " ";
                if(typingIndex === typingMax || typingIndex >= words.length) {
                    if(restoreHealthWithQuestion) {
                        healthBar.width += 10 * typeBonus;
                    }
                    if(energyBar.width + 40 * typeBonus > 200) {
                        healthBar.width += (energyBar.width + 40 * typeBonus - 200)/3;
                        energyBar.width = 200;
                    } else {
                        energyBar.width += 40 * typeBonus;
                    }
                    if(healthBar.width > 200) {
                        healthBar.width = 200;
                    }
                    if(verseTracking[correctAnswer]) {
                        verseTracking[correctAnswer].correct++;
                    } else {
                        verseTracking[correctAnswer] = {correct: 1, incorrect: 0};
                    }
                    numDiv.innerHTML = "";
                    --questionsLeft;
                    if(questionsLeft <= 0) {
                        if(chapter !== false) {
                            if(rangeDiv.innerHTML !== "Review") {
                                var range = rangeDiv.innerHTML;
                            } else {
                                range = storeRange;
                            }
                            var full = true;
                            if (range.split("-")[0] === "1") {
                                var arr = range.split(/\-|\,/);
                                if(Number(arr[1]) + 3 < rom18[chapter-1].length) {
                                    range = (Number(arr[1])) + "-" + (Number(arr[1]) + 3);
                                } else if(Number(arr[1]) < rom18[chapter-1].length) {
                                    range = arr[1] + "-" + rom18[chapter-1].length;
                                }
                                full = false;
                                rangeDiv.innerHTML = range;
                                mistakeReview = false;
                            } else {
                                var arr = range.split(/\-|\,/);
                                range = "1-" + arr[1];
                                rangeDiv.innerHTML = range;
                                mistakeReview = false;
                            }
                            var cur = range.split(/\-|\,/);
                            if(Number(cur[0]) < Number(cur[1]) && Number(cur[0]) >= 0) {
                                if(Number(cur[1]) <= rom18[chapter-1].length) {
                                    params.min = cur[0];
                                    params.max = cur[1];
                                }
                            }
                            if(full && !mistakeReview) {
                                questionsLeft = params.max/learnSpeed;
                            } else {
                                questionsLeft = params.max/(2*learnSpeed);
                            }
                        }
                    }
                    typingIndex = 0;
                    textDiv.innerHTML = "";
                    curVerse = randVerse();
                    correctAnswer = curVerse[0];
                    curVerse = curVerse[1];
                    numDiv.innerHTML = correctAnswer;
                }
            }   
        }
    }
    function handleNumber(e) {
        if(!answersLocked && ((Number(e.key) >= 0 && e.key !== " ") || e.key === "." || e.key === ":")) {
            numDiv.innerHTML += e.key;
        }
        if(e.key === "Enter" && !answersLocked) {
            if (numDiv.innerHTML === correctAnswer || (chapter !== false && (correctAnswer.split(".")[1] === numDiv.innerHTML)) || numDiv.innerHTML.replace(" ",".") === correctAnswer || numDiv.innerHTML.replace(":",".") === correctAnswer) { 
                if(restoreHealthWithQuestion) {
                    healthBar.width += 10;
                }
                if(energyBar.width + 40 > 200) {
                    healthBar.width += (energyBar.width + 40 - 200)/3;
                    energyBar.width = 200;
                } else {
                    energyBar.width += 40;
                }
                if(healthBar.width > 200) {
                    healthBar.width = 200;
                }
                if(verseTracking[correctAnswer]) {
                    verseTracking[correctAnswer].correct++;
                } else {
                    verseTracking[correctAnswer] = {correct: 1, incorrect: 0};
                }
                numDiv.innerHTML = "";
                --questionsLeft;
                if(questionsLeft <= 0) {
                    if(chapter !== false) {
                        if(rangeDiv.innerHTML !== "Review") {
                            var range = rangeDiv.innerHTML;
                        } else {
                            range = storeRange;
                        }
                        var full = true;
                        if (range.split("-")[0] === "1") {
                            var arr = range.split(/\-|\,/);
                            if(Number(arr[1]) + 3 < rom18[chapter-1].length) {
                                range = (Number(arr[1])) + "-" + (Number(arr[1]) + 3);
                            } else if(Number(arr[1]) < rom18[chapter-1].length) {
                                range = arr[1] + "-" + rom18[chapter-1].length;
                            }
                            full = false;
                            rangeDiv.innerHTML = range;
                            mistakeReview = false;
                        } else {
                            var arr = range.split(/\-|\,/);
                            range = "1-" + arr[1];
                            rangeDiv.innerHTML = range;
                            mistakeReview = false;
                        }
                        var cur = range.split(/\-|\,/);
                        if(Number(cur[0]) < Number(cur[1]) && Number(cur[0]) >= 0) {
                            if(Number(cur[1]) <= rom18[chapter-1].length) {
                                params.min = cur[0];
                                params.max = cur[1];
                            }
                        }
                        if(full && !mistakeReview) {
                            questionsLeft = params.max/learnSpeed;
                        } else {
                            questionsLeft = params.max/(2*learnSpeed);
                        }
                    }
                }
            } else {
                if(verseTracking[correctAnswer]) {
                    verseTracking[correctAnswer].incorrect++;
                } else {
                    verseTracking[correctAnswer] = {correct: 0, incorrect: 1};
                }
                answersLocked = true;
                numDiv.style.color = "red";
                var corAns = correctAnswer;
                setTimeout(function() {
                    numDiv.style.color = "green";
                    numDiv.innerHTML = corAns;
                },1000);
                setTimeout(function() {
                    numDiv.style.color = "white";
                    numDiv.innerHTML = "";
                    answersLocked = false;
                },2000);
            }

            curVerse = randVerse();
            correctAnswer = curVerse[0];
            curVerse = curVerse[1];
            textDiv.innerHTML = curVerse;
        }
        if(e.key === "Delete" || e.key === "Backspace") {
            numDiv.innerHTML = "";
        }
    }
    addEventListener("keyup", function (e){
        keys[e.key] = false;
        console.log(e.ctrlKey);
        keys.ctrl = e.ctrlKey;
        keys.shift = e.shiftKey;
        keys.alt = e.altKey;
    });
  </script>
</body>
</html>
