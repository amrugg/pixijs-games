<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>RA Blaster</title>
</head>
    <style>* {padding: 0; margin: 0}</style>
    <script src="pixi/pixi.min.js"></script>
    <script src="usefulFunctions.js"></script>
    <script src="howler.core.min.js"></script>
    <div id="central"></div>
    <select style="position:absolute", id="chapter">
        <option>Hebrews 1</option>
        <option>Hebrews 2</option>
        <option>Hebrews 3</option>
        <option>Hebrews 4</option>
        <option>Hebrews 5</option>
        <option>Hebrews 6</option>
        <option>Hebrews 7</option>
        <option>Hebrews 8</option>
        <option>Hebrews 9</option>
        <option>Hebrews 10</option>
        <option>Hebrews 11</option>
        <option>Hebrews 12</option>
        <option>Hebrews 13</option>
        <option>Hebrews 1-13</option>
    </select>
    <select style="position:absolute; top: 20px", id="level">
        <option>Invincible</option>
        <option>Novice</option>
        <option>Easy</option>
        <option>Medium</option>
        <option>Hard</option>
        <option>Insane</option>
    </select>
    <input type="text" value="1-4" style="position:absolute; top: 40px", id="range">
    <button id="start", style="position: absolute; top: 60px">&nbsp;Start&nbsp;</button>
<body>
  <script type="text/javascript">
    "use strict";
    
    var params = getParams();
    function getParams() {
      var params = {};
      location.search.substr(1).split("&").forEach(function(el) {
        var data = el.replace(/\+/g, " ").split("=");
        params[decodeURIComponent(data[0])] = data[1] ? decodeURIComponent(data[1]) : true;
      });
      return params;
    }
    PIXI.utils.skipHello();
    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;
    let Application = PIXI.Application,
        Container = PIXI.Container,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        TextureCache = PIXI.utils.TextureCache,
        Sprite = PIXI.Sprite,
        Rectangle = PIXI.Rectangle,
        Graphics = PIXI.Graphics;
    let app = new Application({ 
        width: 800,
        height: 800,              
        antialias: true,
        transparent: false,
        resolution: 1
      }
    );
    var chapterEl = document.getElementById("chapter");
    var levelEl = document.getElementById("level");
    levelEl.selectedIndex = 3;
    var inputEl = document.getElementById("range");
    var buttonStartEl = document.getElementById("start");
    var invincible = false;
    chapterEl.style.zIndex = "100";
    levelEl.style.zIndex = "100";
    inputEl.style.zIndex = "100";
    buttonStartEl.style.zIndex = "100";
    buttonStartEl.addEventListener("click", function() {
        if(chapterEl.selectedIndex === 13) {
            chapter = false;
        } else {
            chapter = chapterEl.selectedIndex+1;
        }
        rangeDiv.innerHTML = inputEl.value;
        params.min = inputEl.value.split("-")[0];
        params.max = inputEl.value.split("-")[1];
        questionsLeft = params.max;

        if(levelEl.selectedIndex === 0) {
            difficulty = 1;
            invincible = true;
        } else if(levelEl.selectedIndex === 1) {
            difficulty = 0.25;
        } else if(levelEl.selectedIndex === 2) {
            difficulty = 0.5;
        } else if(levelEl.selectedIndex === 3) {
            difficulty = 0.75;
        } else if(levelEl.selectedIndex === 4) {
            difficulty = 1;
        } else if(levelEl.selectedIndex === 5) {
            difficulty = 1.25;
        }
        chapterEl.remove();
        levelEl.remove();
        inputEl.remove();
        buttonStartEl.remove();

        curVerse = randVerse();
        correctAnswer = curVerse[0];
        console.log(curVerse);
        curVerse = curVerse[1];
        textDiv.innerHTML = curVerse;

        intro.fade(0.5,0, 3000);
        setTimeout(function() {
            music.play();
            music.fade(0, 0.5, 3000);
        },3000);
        state = play;
        app.ticker.add(delta => gameLoop(delta));
    });
    var central = document.getElementById("central");
    central.style.position = "absolute";
    central.style.zIndex = "100";
    central.style.width = (innerWidth- 200) + "px";
    central.style.display = "flex";
    central.style.left = "100px";
    central.style.alignItems = "center";
    central.style.justifyContent = "center";
    app.renderer.backgroundColor = 0x000015;
    /// Fill the screen 
    app.renderer.view.style.position = "absolute";
    app.renderer.view.style.display = "block";
    app.renderer.autoResize = true;
    app.renderer.resize(window.innerWidth, window.innerHeight);
    document.body.appendChild(app.view);
    loader.add(["sprites/exp1.png","sprites/exp2.png","sprites/exp3.png", "sprites/enemy.png", "sprites/rocket.png", "sprites/laser.png", "sprites/medium.png", "sprites/emp.png", "sprites/enemyEMP.png", "sprites/boss1.png", "sprites/missile.png", "sprites/boss2.png", "sprites/drone.png", "sprites/boss3.png", "sprites/enemy-laser.png", "sprites/mothership.png"]).load(setup);
    var textDiv = document.createElement("div");
    textDiv.style.position = "relative";
    // textDiv.innerHTML = "In the beginning was the Word."
    textDiv.style.fontSize = "30px";
    textDiv.style.color = "white";
    central.appendChild(textDiv);
    var numDiv = document.createElement("div");
    numDiv.style.position = "absolute";
    numDiv.style.right = "-100px";
    numDiv.innerHTML = "";
    numDiv.style.fontSize = "30px";
    numDiv.style.color = "white";
    central.appendChild(numDiv);

    var rangeDiv = document.createElement("div");
    rangeDiv.style.position = "absolute";
    rangeDiv.style.left = "-100px";
    rangeDiv.style.top = innerHeight-40 + "px";
    rangeDiv.innerHTML = "1-4";
    params.min = 1;
    params.max = 4;
    var questionsLeft = 4;
    rangeDiv.style.fontSize = "30px";
    rangeDiv.style.color = "white";
    central.appendChild(rangeDiv);
    var energyHolder = new PIXI.Graphics();
    energyHolder.lineStyle(5, 0x00AAAA,10);
    energyHolder.beginFill(0x000015);
    energyHolder.drawRect(0,0,200,25)
    app.stage.addChild(energyHolder);
    energyHolder.x = innerWidth - 225;
    energyHolder.y = innerHeight - 50;
    var energyBar = new PIXI.Graphics();
    energyBar.lineStyle(5, 0x00AAAA,10);
    energyBar.beginFill(0x00AAAA, 10);
    energyBar.drawRect(0,0,200,25);
    energyBar.x = innerWidth - 225;
    energyBar.y = innerHeight - 50;
    app.stage.addChild(energyBar);



    var healthHolder = new PIXI.Graphics();
    healthHolder.lineStyle(5, 0xFF0000,10);
    healthHolder.beginFill(0x000015);
    healthHolder.drawRect(0,0,200,25)
    app.stage.addChild(healthHolder);
    healthHolder.x = innerWidth - 225;
    healthHolder.y = innerHeight - 100;
    var healthBar = new PIXI.Graphics();
    healthBar.lineStyle(5, 0xFF0000,10);
    healthBar.beginFill(0xFF0000, 10);
    healthBar.drawRect(0,0,200,25);
    healthBar.x = innerWidth - 225;
    healthBar.y = innerHeight - 100;
    app.stage.addChild(healthBar);
    var canUseMissiles = false;
    var canUseEMP = false;
    var canUseLaser = false;
    var intro = new Howl({src: ["music/intro.mp3"], autoplay: true, loop: true, volume: 0.5});
    var music = new Howl({src: ["music/level1.mp3"], autoplay: false, loop: true, volume: 0.5});
    /// TODO: Change intro to intro after we get intro and music to battle after the intro ends.
    var boss1 = new Howl({src: ["music/boss1.mp3"], autoplay: false, loop: true, volume: 0});
    var boss2 = new Howl({src: ["music/boss2.mp3"], autoplay: false, loop: true, volume: 0});
    var boss3 = new Howl({src: ["music/boss3.mp3"], autoplay: false, loop: true, volume: 0});
    var mothership = new Howl({src: ["music/mothership.mp3"], autoplay: false, loop: true, volume: 0});


    var rom18 = [
        ["God, who at sundry times and in divers manners spake in time past unto the fathers by the prophets,", "Hath in these last days spoken unto us by his Son, whom he hath appointed heir of all things, by whom also he made the worlds;", "Who being the brightness of his glory, and the express image of his person, and upholding all things by the word of his power, when he had by himself purged our sins, sat down on the right hand of the Majesty on high;", "Being made so much better than the angels, as he hath by inheritance obtained a more excellent name than they.", "For unto which of the angels said he at any time, Thou art my Son, this day have I begotten thee? And again, I will be to him a Father, and he shall be to me a Son?", "And again, when he bringeth in the firstbegotten into the world, he saith, And let all the angels of God worship him.", "And of the angels he saith, Who maketh his angels spirits, and his ministers a flame of fire.", "But unto the Son he saith, Thy throne, O God, is for ever and ever: a sceptre of righteousness is the sceptre of thy kingdom.", "Thou hast loved righteousness, and hated iniquity; therefore God, even thy God, hath anointed thee with the oil of gladness above thy fellows.", "And, Thou, Lord, in the beginning hast laid the foundation of the earth; and the heavens are the works of thine hands:", "They shall perish; but thou remainest; and they all shall wax old as doth a garment;", "And as a vesture shalt thou fold them up, and they shall be changed: but thou art the same, and thy years shall not fail.", "But to which of the angels said he at any time, Sit on my right hand, until I make thine enemies thy footstool?", "Are they not all ministering spirits, sent forth to minister for them who shall be heirs of salvation?"],
        ["Therefore we ought to give the more earnest heed to the things which we have heard, lest at any time we should let them slip.", "For if the word spoken by angels was stedfast, and every transgression and disobedience received a just recompence of reward;", "How shall we escape, if we neglect so great salvation; which at the first began to be spoken by the Lord, and was confirmed unto us by them that heard him;", "God also bearing them witness, both with signs and wonders, and with divers miracles, and gifts of the Holy Ghost, according to his own will?", "For unto the angels hath he not put in subjection the world to come, whereof we speak.", "But one in a certain place testified, saying, What is man, that thou art mindful of him? or the son of man, that thou visitest him?", "Thou madest him a little lower than the angels; thou crownedst him with glory and honour, and didst set him over the works of thy hands:", "Thou hast put all things in subjection under his feet. For in that he put all in subjection under him, he left nothing that is not put under him. But now we see not yet all things put under him.", "But we see Jesus, who was made a little lower than the angels for the suffering of death, crowned with glory and honour; that he by the grace of God should taste death for every man.", "For it became him, for whom are all things, and by whom are all things, in bringing many sons unto glory, to make the captain of their salvation perfect through sufferings.", "For both he that sanctifieth and they who are sanctified are all of one: for which cause he is not ashamed to call them brethren,", "Saying, I will declare thy name unto my brethren, in the midst of the church will I sing praise unto thee.", "And again, I will put my trust in him. And again, Behold I and the children which God hath given me.", "Forasmuch then as the children are partakers of flesh and blood, he also himself likewise took part of the same; that through death he might destroy him that had the power of death, that is, the devil;", "And deliver them who through fear of death were all their lifetime subject to bondage.", "For verily he took not on him the nature of angels; but he took on him the seed of Abraham.", "Wherefore in all things it behoved him to be made like unto his brethren, that he might be a merciful and faithful high priest in things pertaining to God, to make reconciliation for the sins of the people.", "For in that he himself hath suffered being tempted, he is able to succour them that are tempted."],
        ["Wherefore, holy brethren, partakers of the heavenly calling, consider the Apostle and High Priest of our profession, Christ Jesus;", "Who was faithful to him that appointed him, as also Moses was faithful in all his house.", "For this man was counted worthy of more glory than Moses, inasmuch as he who hath builded the house hath more honour than the house.", "For every house is builded by some man; but he that built all things is God.", "And Moses verily was faithful in all his house, as a servant, for a testimony of those things which were to be spoken after;", "But Christ as a son over his own house; whose house are we, if we hold fast the confidence and the rejoicing of the hope firm unto the end.", "Wherefore (as the Holy Ghost saith, To day if ye will hear his voice,", "Harden not your hearts, as in the provocation, in the day of temptation in the wilderness:", "When your fathers tempted me, proved me, and saw my works forty years.", "Wherefore I was grieved with that generation, and said, They do alway err in their heart; and they have not known my ways.", "So I sware in my wrath, They shall not enter into my rest.)", "Take heed, brethren, lest there be in any of you an evil heart of unbelief, in departing from the living God.", "But exhort one another daily, while it is called To day; lest any of you be hardened through the deceitfulness of sin.", "For we are made partakers of Christ, if we hold the beginning of our confidence stedfast unto the end;", "While it is said, To day if ye will hear his voice, harden not your hearts, as in the provocation.", "For some, when they had heard, did provoke: howbeit not all that came out of Egypt by Moses.", "But with whom was he grieved forty years? was it not with them that had sinned, whose carcases fell in the wilderness?", "And to whom sware he that they should not enter into his rest, but to them that believed not?", "So we see that they could not enter in because of unbelief."],
        ["Let us therefore fear, lest, a promise being left [us] of entering into his rest, any of you should seem to come short of it.", "For unto us was the gospel preached, as well as unto them: but the word preached did not profit them, not being mixed with faith in them that heard [it].", "For we which have believed do enter into rest, as he said, As I have sworn in my wrath, if they shall enter into my rest: although the works were finished from the foundation of the world.", "For he spake in a certain place of the seventh [day] on this wise, And God did rest the seventh day from all his works.", "And in this [place] again, If they shall enter into my rest.", "Seeing therefore it remaineth that some must enter therein, and they to whom it was first preached entered not in because of unbelief:", "Again, he limiteth a certain day, saying in David, To day, after so long a time; as it is said, To day if ye will hear his voice, harden not your hearts.", "For if Jesus had given them rest, then would he not afterward have spoken of another day.", "There remaineth therefore a rest to the people of God.", "For he that is entered into his rest, he also hath ceased from his own works, as God [did] from his.", "Let us labour therefore to enter into that rest, lest any man fall after the same example of unbelief.", "For the word of God [is] quick, and powerful, and sharper than any twoedged sword, piercing even to the dividing asunder of soul and spirit, and of the joints and marrow, and [is] a discerner of the thoughts and intents of the heart.", "Neither is there any creature that is not manifest in his sight: but all things [are] naked and opened unto the eyes of him with whom we have to do.", "Seeing then that we have a great high priest, that is passed into the heavens, Jesus the Son of God, let us hold fast [our] profession.", "For we have not an high priest which cannot be touched with the feeling of our infirmities; but was in all points tempted like as [we are, yet] without sin.", "Let us therefore come boldly unto the throne of grace, that we may obtain mercy, and find grace to help in time of need."],
        ["For every high priest taken from among men is ordained for men in things pertaining to God, that he may offer both gifts and sacrifices for sins:", "Who can have compassion on the ignorant, and on them that are out of the way; for that he himself also is compassed with infirmity.", "And by reason hereof he ought, as for the people, so also for himself, to offer for sins.", "And no man taketh this honour unto himself, but he that is called of God, as was Aaron.", "So also Christ glorified not himself to be made an high priest; but he that said unto him, Thou art my Son, to day have I begotten thee.", "As he saith also in another place, Thou art a priest for ever after the order of Melchisedec.", "Who in the days of his flesh, when he had offered up prayers and supplications with strong crying and tears unto him that was able to save him from death, and was heard in that he feared;", "Though he were a Son, yet learned he obedience by the things which he suffered;", "And being made perfect, he became the author of eternal salvation unto all them that obey him;", "Called of God an high priest after the order of Melchisedec.", "Of whom we have many things to say, and hard to be uttered, seeing ye are dull of hearing.", "For when for the time ye ought to be teachers, ye have need that one teach you again which be the first principles of the oracles of God; and are become such as have need of milk, and not of strong meat.", "For every one that useth milk is unskilful in the word of righteousness: for he is a babe.", "But strong meat belongeth to them that are of full age, even those who by reason of use have their senses exercised to discern both good and evil."],
        ["Therefore leaving the principles of the doctrine of Christ, let us go on unto perfection; not laying again the foundation of repentance from dead works, and of faith toward God,", "Of the doctrine of baptisms, and of laying on of hands, and of resurrection of the dead, and of eternal judgment.", "And this will we do, if God permit.", "For it is impossible for those who were once enlightened, and have tasted of the heavenly gift, and were made partakers of the Holy Ghost,", "And have tasted the good word of God, and the powers of the world to come,", "If they shall fall away, to renew them again unto repentance; seeing they crucify to themselves the Son of God afresh, and put him to an open shame.", "For the earth which drinketh in the rain that cometh oft upon it, and bringeth forth herbs meet for them by whom it is dressed, receiveth blessing from God:", "But that which beareth thorns and briers is rejected, and is nigh unto cursing; whose end is to be burned.", "But, beloved, we are persuaded better things of you, and things that accompany salvation, though we thus speak.", "For God is not unrighteous to forget your work and labour of love, which ye have shewed toward his name, in that ye have ministered to the saints, and do minister.", "And we desire that every one of you do shew the same diligence to the full assurance of hope unto the end:", "That ye be not slothful, but followers of them who through faith and patience inherit the promises.", "For when God made promise to Abraham, because he could swear by no greater, he sware by himself,", "Saying, Surely blessing I will bless thee, and multiplying I will multiply thee.", "And so, after he had patiently endured, he obtained the promise.", "For men verily swear by the greater: and an oath for confirmation is to them an end of all strife.", "Wherein God, willing more abundantly to shew unto the heirs of promise the immutability of his counsel, confirmed it by an oath:", "That by two immutable things, in which it was impossible for God to lie, we might have a strong consolation, who have fled for refuge to lay hold upon the hope set before us:", "Which hope we have as an anchor of the soul, both sure and stedfast, and which entereth into that within the veil;", "Whither the forerunner is for us entered, even Jesus, made an high priest for ever after the order of Melchisedec."],
        ["For this Melchisedec, king of Salem, priest of the most high God, who met Abraham returning from the slaughter of the kings, and blessed him;", "To whom also Abraham gave a tenth part of all; first being by interpretation King of righteousness, and after that also King of Salem, which is, King of peace;", "Without father, without mother, without descent, having neither beginning of days, nor end of life; but made like unto the Son of God; abideth a priest continually.", "Now consider how great this man was, unto whom even the patriarch Abraham gave the tenth of the spoils.", "And verily they that are of the sons of Levi, who receive the office of the priesthood, have a commandment to take tithes of the people according to the law, that is, of their brethren, though they come out of the loins of Abraham:", "But he whose descent is not counted from them received tithes of Abraham, and blessed him that had the promises.", "And without all contradiction the less is blessed of the better.", "And here men that die receive tithes; but there he receiveth them, of whom it is witnessed that he liveth.", "And as I may so say, Levi also, who receiveth tithes, payed tithes in Abraham.", "For he was yet in the loins of his father, when Melchisedec met him.", "If therefore perfection were by the Levitical priesthood, (for under it the people received the law,) what further need was there that another priest should rise after the order of Melchisedec, and not be called after the order of Aaron?", "For the priesthood being changed, there is made of necessity a change also of the law.", "For he of whom these things are spoken pertaineth to another tribe, of which no man gave attendance at the altar.", "For it is evident that our Lord sprang out of Juda; of which tribe Moses spake nothing concerning priesthood.", "And it is yet far more evident: for that after the similitude of Melchisedec there ariseth another priest,", "Who is made, not after the law of a carnal commandment, but after the power of an endless life.", "For he testifieth, Thou art a priest for ever after the order of Melchisedec.", "For there is verily a disannulling of the commandment going before for the weakness and unprofitableness thereof.", "For the law made nothing perfect, but the bringing in of a better hope did; by the which we draw nigh unto God.", "And inasmuch as not without an oath he was made priest:", "(For those priests were made without an oath; but this with an oath by him that said unto him, The Lord sware and will not repent, Thou art a priest for ever after the order of Melchisedec:)", "By so much was Jesus made a surety of a better testament.", "And they truly were many priests, because they were not suffered to continue by reason of death:", "But this man, because he continueth ever, hath an unchangeable priesthood.", "Wherefore he is able also to save them to the uttermost that come unto God by him, seeing he ever liveth to make intercession for them.", "For such an high priest became us, who is holy, harmless, undefiled, separate from sinners, and made higher than the heavens;", "Who needeth not daily, as those high priests, to offer up sacrifice, first for his own sins, and then for the people's: for this he did once, when he offered up himself.", "For the law maketh men high priests which have infirmity; but the word of the oath, which was since the law, maketh the Son, who is consecrated for evermore."],
        ["Now of the things which we have spoken this is the sum: We have such an high priest, who is set on the right hand of the throne of the Majesty in the heavens;", "A minister of the sanctuary, and of the true tabernacle, which the Lord pitched, and not man.", "For every high priest is ordained to offer gifts and sacrifices: wherefore it is of necessity that this man have somewhat also to offer.", "For if he were on earth, he should not be a priest, seeing that there are priests that offer gifts according to the law:", "Who serve unto the example and shadow of heavenly things, as Moses was admonished of God when he was about to make the tabernacle: for, See, saith he, that thou make all things according to the pattern shewed to thee in the mount.", "But now hath he obtained a more excellent ministry, by how much also he is the mediator of a better covenant, which was established upon better promises.", "For if that first covenant had been faultless, then should no place have been sought for the second.", "For finding fault with them, he saith, Behold, the days come, saith the Lord, when I will make a new covenant with the house of Israel and with the house of Judah:", "Not according to the covenant that I made with their fathers in the day when I took them by the hand to lead them out of the land of Egypt; because they continued not in my covenant, and I regarded them not, saith the Lord.", "For this is the covenant that I will make with the house of Israel after those days, saith the Lord; I will put my laws into their mind, and write them in their hearts: and I will be to them a God, and they shall be to me a people:", "And they shall not teach every man his neighbour, and every man his brother, saying, Know the Lord: for all shall know me, from the least to the greatest.", "For I will be merciful to their unrighteousness, and their sins and their iniquities will I remember no more.", "In that he saith, A new covenant, he hath made the first old. Now that which decayeth and waxeth old is ready to vanish away."],
        ["Then verily the first covenant had also ordinances of divine service, and a worldly sanctuary.", "For there was a tabernacle made; the first, wherein was the candlestick, and the table, and the shewbread; which is called the sanctuary.", "And after the second veil, the tabernacle which is called the Holiest of all;", "Which had the golden censer, and the ark of the covenant overlaid round about with gold, wherein was the golden pot that had manna, and Aaron's rod that budded, and the tables of the covenant;", "And over it the cherubims of glory shadowing the mercyseat; of which we cannot now speak particularly.", "Now when these things were thus ordained, the priests went always into the first tabernacle, accomplishing the service of God.", "But into the second went the high priest alone once every year, not without blood, which he offered for himself, and for the errors of the people:", "The Holy Ghost this signifying, that the way into the holiest of all was not yet made manifest, while as the first tabernacle was yet standing:", "Which was a figure for the time then present, in which were offered both gifts and sacrifices, that could not make him that did the service perfect, as pertaining to the conscience;", "Which stood only in meats and drinks, and divers washings, and carnal ordinances, imposed on them until the time of reformation.", "But Christ being come an high priest of good things to come, by a greater and more perfect tabernacle, not made with hands, that is to say, not of this building;", "Neither by the blood of goats and calves, but by his own blood he entered in once into the holy place, having obtained eternal redemption for us.", "For if the blood of bulls and of goats, and the ashes of an heifer sprinkling the unclean, sanctifieth to the purifying of the flesh:", "How much more shall the blood of Christ, who through the eternal Spirit offered himself without spot to God, purge your conscience from dead works to serve the living God?", "And for this cause he is the mediator of the new testament, that by means of death, for the redemption of the transgressions that were under the first testament, they which are called might receive the promise of eternal inheritance.", "For where a testament is, there must also of necessity be the death of the testator.", "For a testament is of force after men are dead: otherwise it is of no strength at all while the testator liveth.", "Whereupon neither the first testament was dedicated without blood.", "For when Moses had spoken every precept to all the people according to the law, he took the blood of calves and of goats, with water, and scarlet wool, and hyssop, and sprinkled both the book, and all the people,", "Saying, This is the blood of the testament which God hath enjoined unto you.", "Moreover he sprinkled with blood both the tabernacle, and all the vessels of the ministry.", "And almost all things are by the law purged with blood; and without shedding of blood is no remission.", "It was therefore necessary that the patterns of things in the heavens should be purified with these; but the heavenly things themselves with better sacrifices than these.", "For Christ is not entered into the holy places made with hands, which are the figures of the true; but into heaven itself, now to appear in the presence of God for us:", "Nor yet that he should offer himself often, as the high priest entereth into the holy place every year with blood of others;", "For then must he often have suffered since the foundation of the world: but now once in the end of the world hath he appeared to put away sin by the sacrifice of himself.", "And as it is appointed unto men once to die, but after this the judgment:", "So Christ was once offered to bear the sins of many; and unto them that look for him shall he appear the second time without sin unto salvation."],
        ["For the law having a shadow of good things to come, and not the very image of the things, can never with those sacrifices which they offered year by year continually make the comers thereunto perfect.", "For then would they not have ceased to be offered? because that the worshippers once purged should have had no more conscience of sins.", "But in those sacrifices there is a remembrance again made of sins every year.", "For it is not possible that the blood of bulls and of goats should take away sins.", "Wherefore when he cometh into the world, he saith, Sacrifice and offering thou wouldest not, but a body hast thou prepared me:", "In burnt offerings and sacrifices for sin thou hast had no pleasure.", "Then said I, Lo, I come (in the volume of the book it is written of me,) to do thy will, O God.", "Above when he said, Sacrifice and offering and burnt offerings and offering for sin thou wouldest not, neither hadst pleasure therein; which are offered by the law;", "Then said he, Lo, I come to do thy will, O God. He taketh away the first, that he may establish the second.", "By the which will we are sanctified through the offering of the body of Jesus Christ once for all.", "And every priest standeth daily ministering and offering oftentimes the same sacrifices, which can never take away sins:", "But this man, after he had offered one sacrifice for sins for ever, sat down on the right hand of God;", "From henceforth expecting till his enemies be made his footstool.", "For by one offering he hath perfected for ever them that are sanctified.", "Whereof the Holy Ghost also is a witness to us: for after that he had said before,", "This is the covenant that I will make with them after those days, saith the Lord, I will put my laws into their hearts, and in their minds will I write them;", "And their sins and iniquities will I remember no more.", "Now where remission of these is, there is no more offering for sin.", "Having therefore, brethren, boldness to enter into the holiest by the blood of Jesus,", "By a new and living way, which he hath consecrated for us, through the veil, that is to say, his flesh;", "And having an high priest over the house of God;", "Let us draw near with a true heart in full assurance of faith, having our hearts sprinkled from an evil conscience, and our bodies washed with pure water.", "Let us hold fast the profession of our faith without wavering; (for he is faithful that promised;)", "And let us consider one another to provoke unto love and to good works:", "Not forsaking the assembling of ourselves together, as the manner of some is; but exhorting one another: and so much the more, as ye see the day approaching.", "For if we sin wilfully after that we have received the knowledge of the truth, there remaineth no more sacrifice for sins,", "But a certain fearful looking for of judgment and fiery indignation, which shall devour the adversaries.", "He that despised Moses' law died without mercy under two or three witnesses:", "Of how much sorer punishment, suppose ye, shall he be thought worthy, who hath trodden under foot the Son of God, and hath counted the blood of the covenant, wherewith he was sanctified, an unholy thing, and hath done despite unto the Spirit of grace?", "For we know him that hath said, Vengeance belongeth unto me, I will recompense, saith the Lord. And again, The Lord shall judge his people.", "It is a fearful thing to fall into the hands of the living God.", "But call to remembrance the former days, in which, after ye were illuminated, ye endured a great fight of afflictions;", "Partly, whilst ye were made a gazingstock both by reproaches and afflictions; and partly, whilst ye became companions of them that were so used.", "For ye had compassion of me in my bonds, and took joyfully the spoiling of your goods, knowing in yourselves that ye have in heaven a better and an enduring substance.", "Cast not away therefore your confidence, which hath great recompence of reward.", "For ye have need of patience, that, after ye have done the will of God, ye might receive the promise.", "For yet a little while, and he that shall come will come, and will not tarry.", "Now the just shall live by faith: but if any man draw back, my soul shall have no pleasure in him.", "But we are not of them who draw back unto perdition; but of them that believe to the saving of the soul."],
        ["Now faith is the substance of things hoped for, the evidence of things not seen.", "For by it the elders obtained a good report.", "Through faith we understand that the worlds were framed by the word of God, so that things which are seen were not made of things which do appear.", "By faith Abel offered unto God a more excellent sacrifice than Cain, by which he obtained witness that he was righteous, God testifying of his gifts: and by it he being dead yet speaketh.", "By faith Enoch was translated that he should not see death; and was not found, because God had translated him: for before his translation he had this testimony, that he pleased God.", "But without faith it is impossible to please him: for he that cometh to God must believe that he is, and that he is a rewarder of them that diligently seek him.", "By faith Noah, being warned of God of things not seen as yet, moved with fear, prepared an ark to the saving of his house; by the which he condemned the world, and became heir of the righteousness which is by faith.", "By faith Abraham, when he was called to go out into a place which he should after receive for an inheritance, obeyed; and he went out, not knowing whither he went.", "By faith he sojourned in the land of promise, as in a strange country, dwelling in tabernacles with Isaac and Jacob, the heirs with him of the same promise:", "For he looked for a city which hath foundations, whose builder and maker is God.", "Through faith also Sara herself received strength to conceive seed, and was delivered of a child when she was past age, because she judged him faithful who had promised.", "Therefore sprang there even of one, and him as good as dead, so many as the stars of the sky in multitude, and as the sand which is by the sea shore innumerable.", "These all died in faith, not having received the promises, but having seen them afar off, and were persuaded of them, and embraced them, and confessed that they were strangers and pilgrims on the earth.", "For they that say such things declare plainly that they seek a country.", "And truly, if they had been mindful of that country from whence they came out, they might have had opportunity to have returned.", "But now they desire a better country, that is, an heavenly: wherefore God is not ashamed to be called their God: for he hath prepared for them a city.", "By faith Abraham, when he was tried, offered up Isaac: and he that had received the promises offered up his only begotten son,", "Of whom it was said, That in Isaac shall thy seed be called:", "Accounting that God was able to raise him up, even from the dead; from whence also he received him in a figure.", "By faith Isaac blessed Jacob and Esau concerning things to come.", "By faith Jacob, when he was a dying, blessed both the sons of Joseph; and worshipped, leaning upon the top of his staff.", "By faith Joseph, when he died, made mention of the departing of the children of Israel; and gave commandment concerning his bones.", "By faith Moses, when he was born, was hid three months of his parents, because they saw he was a proper child; and they were not afraid of the king's commandment.", "By faith Moses, when he was come to years, refused to be called the son of Pharaoh's daughter;", "Choosing rather to suffer affliction with the people of God, than to enjoy the pleasures of sin for a season;", "Esteeming the reproach of Christ greater riches than the treasures in Egypt: for he had respect unto the recompence of the reward.", "By faith he forsook Egypt, not fearing the wrath of the king: for he endured, as seeing him who is invisible.", "Through faith he kept the passover, and the sprinkling of blood, lest he that destroyed the firstborn should touch them.", "By faith they passed through the Red sea as by dry land: which the Egyptians assaying to do were drowned.", "By faith the walls of Jericho fell down, after they were compassed about seven days.", "By faith the harlot Rahab perished not with them that believed not, when she had received the spies with peace.", "And what shall I more say? for the time would fail me to tell of Gedeon, and of Barak, and of Samson, and of Jephthae; of David also, and Samuel, and of the prophets:", "Who through faith subdued kingdoms, wrought righteousness, obtained promises, stopped the mouths of lions,", "Quenched the violence of fire, escaped the edge of the sword, out of weakness were made strong, waxed valiant in fight, turned to flight the armies of the aliens.", "Women received their dead raised to life again: and others were tortured, not accepting deliverance; that they might obtain a better resurrection:", "And others had trial of cruel mockings and scourgings, yea, moreover of bonds and imprisonment:", "They were stoned, they were sawn asunder, were tempted, were slain with the sword: they wandered about in sheepskins and goatskins; being destitute, afflicted, tormented;", "(Of whom the world was not worthy:) they wandered in deserts, and in mountains, and in dens and caves of the earth.", "And these all, having obtained a good report through faith, received not the promise:", "God having provided some better thing for us, that they without us should not be made perfect."],
        ["Wherefore seeing we also are compassed about with so great a cloud of witnesses, let us lay aside every weight, and the sin which doth so easily beset us, and let us run with patience the race that is set before us,", "Looking unto Jesus the author and finisher of our faith; who for the joy that was set before him endured the cross, despising the shame, and is set down at the right hand of the throne of God.", "For consider him that endured such contradiction of sinners against himself, lest ye be wearied and faint in your minds.", "Ye have not yet resisted unto blood, striving against sin.", "And ye have forgotten the exhortation which speaketh unto you as unto children, My son, despise not thou the chastening of the Lord, nor faint when thou art rebuked of him:", "For whom the Lord loveth he chasteneth, and scourgeth every son whom he receiveth.", "If ye endure chastening, God dealeth with you as with sons; for what son is he whom the father chasteneth not?", "But if ye be without chastisement, whereof all are partakers, then are ye bastards, and not sons.", "Furthermore we have had fathers of our flesh which corrected us, and we gave them reverence: shall we not much rather be in subjection unto the Father of spirits, and live?", "For they verily for a few days chastened us after their own pleasure; but he for our profit, that we might be partakers of his holiness.", "Now no chastening for the present seemeth to be joyous, but grievous: nevertheless afterward it yieldeth the peaceable fruit of righteousness unto them which are exercised thereby.", "Wherefore lift up the hands which hang down, and the feeble knees;", "And make straight paths for your feet, lest that which is lame be turned out of the way; but let it rather be healed.", "Follow peace with all men, and holiness, without which no man shall see the Lord:", "Looking diligently lest any man fail of the grace of God; lest any root of bitterness springing up trouble you, and thereby many be defiled;", "Lest there be any fornicator, or profane person, as Esau, who for one morsel of meat sold his birthright.", "For ye know how that afterward, when he would have inherited the blessing, he was rejected: for he found no place of repentance, though he sought it carefully with tears.", "For ye are not come unto the mount that might be touched, and that burned with fire, nor unto blackness, and darkness, and tempest,", "And the sound of a trumpet, and the voice of words; which voice they that heard intreated that the word should not be spoken to them any more:", "(For they could not endure that which was commanded, And if so much as a beast touch the mountain, it shall be stoned, or thrust through with a dart:", "And so terrible was the sight, that Moses said, I exceedingly fear and quake:)", "But ye are come unto mount Sion, and unto the city of the living God, the heavenly Jerusalem, and to an innumerable company of angels,", "To the general assembly and church of the firstborn, which are written in heaven, and to God the Judge of all, and to the spirits of just men made perfect,", "And to Jesus the mediator of the new covenant, and to the blood of sprinkling, that speaketh better things than that of Abel.", "See that ye refuse not him that speaketh. For if they escaped not who refused him that spake on earth, much more shall not we escape, if we turn away from him that speaketh from heaven:", "Whose voice then shook the earth: but now he hath promised, saying, Yet once more I shake not the earth only, but also heaven.", "And this word, Yet once more, signifieth the removing of those things that are shaken, as of things that are made, that those things which cannot be shaken may remain.", "Wherefore we receiving a kingdom which cannot be moved, let us have grace, whereby we may serve God acceptably with reverence and godly fear:", "For our God is a consuming fire."],
        ["Let brotherly love continue.", "Be not forgetful to entertain strangers: for thereby some have entertained angels unawares.", "Remember them that are in bonds, as bound with them; and them which suffer adversity, as being yourselves also in the body.", "Marriage is honourable in all, and the bed undefiled: but whoremongers and adulterers God will judge.", "Let your conversation be without covetousness; and be content with such things as ye have: for he hath said, I will never leave thee, nor forsake thee.", "So that we may boldly say, The Lord is my helper, and I will not fear what man shall do unto me.", "Remember them which have the rule over you, who have spoken unto you the word of God: whose faith follow, considering the end of their conversation.", "Jesus Christ the same yesterday, and to day, and for ever.", "Be not carried about with divers and strange doctrines. For it is a good thing that the heart be established with grace; not with meats, which have not profited them that have been occupied therein.", "We have an altar, whereof they have no right to eat which serve the tabernacle.", "For the bodies of those beasts, whose blood is brought into the sanctuary by the high priest for sin, are burned without the camp.", "Wherefore Jesus also, that he might sanctify the people with his own blood, suffered without the gate.", "Let us go forth therefore unto him without the camp, bearing his reproach.", "For here have we no continuing city, but we seek one to come.", "By him therefore let us offer the sacrifice of praise to God continually, that is, the fruit of our lips giving thanks to his name.", "But to do good and to communicate forget not: for with such sacrifices God is well pleased.", "Obey them that have the rule over you, and submit yourselves: for they watch for your souls, as they that must give account, that they may do it with joy, and not with grief: for that is unprofitable for you.", "Pray for us: for we trust we have a good conscience, in all things willing to live honestly.", "But I beseech you the rather to do this, that I may be restored to you the sooner.", "Now the God of peace, that brought again from the dead our Lord Jesus, that great shepherd of the sheep, through the blood of the everlasting covenant,", "Make you perfect in every good work to do his will, working in you that which is wellpleasing in his sight, through Jesus Christ; to whom be glory for ever and ever. Amen.", "And I beseech you, brethren, suffer the word of exhortation: for I have written a letter unto you in few words.", "Know ye that our brother Timothy is set at liberty; with whom, if he come shortly, I will see you.", "Salute all them that have the rule over you, and all the saints. They of Italy salute you.", "Grace be with you all. Amen."]
    ];
    var chapter = Number(params.chapter) || randInt(1,8);
    var currentRandChapter = 0;
    var curVerse = randVerse();
    var correctAnswer = curVerse[0];
    var missiles = [];
    curVerse = curVerse[1];
    // textDiv.innerHTML = curVerse;
    var fullLevel = false;
    var difficulty = 0.75;
    function randInt(min, max, not) {
        if(max === undefined) {
            max = min
            min = 1
        }
        var num = Math.floor(Math.random() * (max - min + 1)) + min;
        while(num === not && max-min > 0) {
            num = Math.floor(Math.random() * (max - min + 1)) + min;
        }
        return num;
    }
    function randVerse() {
        if(chapter) {
            var verseArr = rom18[chapter-1];
            var rand = randInt((params.min ? Number(params.min)-1 : 0), Number(params.max)-1 || verseArr.length-1, (correctAnswer ? Number(correctAnswer.split(".")[1])-1 : -1));
            var verseNumber = chapter + "." + (rand+1);
            return [verseNumber, verseArr[rand]];
        } else {
            var currentRandChapter = randInt(0,7)
            var verseArr = rom18[currentRandChapter];
            var rand = randInt(0,verseArr.length-1);
            var verseNumber = (currentRandChapter+1) + "." + (rand+1);
            return [verseNumber, verseArr[rand]];
        }
    }


    // energyHolder.beginFill();
    var state;
    var keys = {};
    var rocket;
    var enemies = [];
    var explosions = [];
    var mouseX,mouseY;
    var lasers = [];
    var lastFire = 0;
    var reloadTime = 500;
    var energyToFire = 5;
    var healthToHit = 10;
    var emp;
    var enemyEMP;
    var laserGraphics = new PIXI.Graphics();
    laserGraphics.beginFill(0xffffaa);
    laserGraphics.drawRect(-25,0,50, -innerHeight * 2);
    app.stage.addChild(laserGraphics);
    app.stage.sortableChildren = true;
    var scaleFactor = innerWidth/1920;
    function setup() {
        spawnNewEnemy(1,"easy");
        rocket = new Sprite(resources["sprites/rocket.png"].texture);
        app.stage.addChild(rocket);
        rocket.anchor.set(0.5,0.5);
        rocket.scale.set(3*scaleFactor);
        rocket.x = 100;
        rocket.y = 100;

        emp = new Sprite(resources["sprites/emp.png"].texture);
        app.stage.addChild(emp);
        emp.anchor.set(0.5,0.5);
        emp.x = 100;
        emp.y = 100;
        emp.visible = false;

        enemyEMP = new Sprite(resources["sprites/enemyEMP.png"].texture);
        app.stage.addChild(enemyEMP);
        enemyEMP.anchor.set(0.5,0.5);
        enemyEMP.x = 100;
        enemyEMP.y = 100;
        enemyEMP.visible = false;
        enemyEMP.zIndex = 10000;
    }
    function gameLoop(delta) {
      state(delta)
    }
    var level = 1;
    function explode(amount, position, magnitude) {
        for(var i = 0; i < amount; i++) {
            if(magnitude) {
                var rand = magnitude/3-0.1;
            } else {
                var rand = Math.random();
            }
            if(rand < 0.33) {
                var explosion = new Sprite(resources["sprites/exp1.png"].texture);
            } else if(rand < 0.66) {
                var explosion = new Sprite(resources["sprites/exp2.png"].texture);
            } else {
                var explosion = new Sprite(resources["sprites/exp3.png"].texture);
            }
            app.stage.addChild(explosion);
            explosion.x = position.x + randInt(-20,20);
            explosion.y = position.y + randInt(-20,20);
            explosions.push(explosion);
            explosion.scale.set(3*scaleFactor);
        }
    }
    function bigExplosion(amount, position, magnitude) {
        for(var i = 0; i < amount; i++) {
            if(magnitude) {
                var rand = magnitude/3-0.1;
            } else {
                var rand = Math.random();
            }
            if(rand < 0.33) {
                var explosion = new Sprite(resources["sprites/exp1.png"].texture);
            } else if(rand < 0.66) {
                var explosion = new Sprite(resources["sprites/exp2.png"].texture);
            } else {
                var explosion = new Sprite(resources["sprites/exp3.png"].texture);
            }
            app.stage.addChild(explosion);
            explosion.x = position.x + randInt(-150,150);
            explosion.y = position.y + randInt(-150,150);
            explosions.push(explosion);
            explosion.scale.set(3*scaleFactor);
        }
    }
    function win() {
        explode(1,{x:enemies[0].x,y:enemies[0].y});
        for(var i = 0; i < explosions.length; i++) {
            explosions[i].alpha -= 0.05;
            if(explosions[i].alpha <= 0) {
                app.stage.removeChild(explosions[i]);
                explosions.splice(i,1);
                --i;
            }
        }

        for(var i = 0; i < lasers.length; i++) {
            lasers[i].alpha -= 0.05;
            if(lasers[i].alpha <= 0) {
                app.stage.removeChild(lasers[i]);
                lasers.splice(i,1);
                --i;
            }
        }


        for(var i = 0; i < missiles.length; i++) {
            missiles[i].alpha -= 0.05;
            if(missiles[i].alpha <= 0) {
                app.stage.removeChild(missiles[i]);
                missiles.splice(i,1);
                --i;
            }
        }
    }
    function die() {
        explode(1,{x:rocket.x,y:rocket.y});
        for(var i = 0; i < explosions.length; i++) {
            explosions[i].alpha -= 0.05;
            if(explosions[i].alpha <= 0) {
                app.stage.removeChild(explosions[i]);
                explosions.splice(i,1);
                --i;
            }
        }
        for(var i = 0; i < enemies.length; i++) {
            enemies[i].alpha -= 0.05;
            if(enemies[i].alpha <= 0) {
                app.stage.removeChild(enemies[i]);
                enemies.splice(i,1);
                --i;
            }
        }

        for(var i = 0; i < lasers.length; i++) {
            lasers[i].alpha -= 0.05;
            if(lasers[i].alpha <= 0) {
                app.stage.removeChild(lasers[i]);
                lasers.splice(i,1);
                --i;
            }
        }


        for(var i = 0; i < missiles.length; i++) {
            missiles[i].alpha -= 0.05;
            if(missiles[i].alpha <= 0) {
                app.stage.removeChild(missiles[i]);
                missiles.splice(i,1);
                --i;
            }
        }
    }
    function play(){
        if(healthBar.width < 0) {
            state = die;
        }
        rocket.vx = 0;
        rocket.vy = 0;
        if(keys.ArrowUp || keys.w) {
            rocket.vy += -10;
        }
        if(keys.ArrowDown || keys.s) {
            rocket.vy += 10;
        }
        if(keys.ArrowLeft || keys.a) {
            rocket.vx += -10;
        }
        if(keys.ArrowRight || keys.d) {
            rocket.vx += 10;
        }
        if(keys[" "] && Date.now() - reloadTime > lastFire && energyBar.width >= energyToFire) {
            shootLaser("good", {x:rocket.x, y: rocket.y - rocket.height/2}, 0);
            lastFire = Date.now();
            energyBar.width -= energyToFire;
        }
        if(keys.m && energyBar.width >= energyToFire*7 && enemies.length && canUseMissiles) {
            var closestEnemy;
            var closestDist = Infinity;
            for(let i = 0; i < enemies.length; i++) {
                var enemy = enemies[i];
                if(getDistance(rocket.x,rocket.y,enemy.x,enemy.y) < closestDist && enemy.alpha === 1 && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    closestDist = getDistance(rocket.x,rocket.y,enemy.x,enemy.y)
                    closestEnemy = enemy;
                }
            }
            launchMissile("good",  {x:rocket.x, y: rocket.y - rocket.height/2}, closestEnemy, 10);
            keys.m = false;
            energyBar.width -= energyToFire*7;
        }
        if(keys.e && energyBar.width > 0 && canUseEMP) {
            if(!emp.visible) {
                emp.scale.set(0.5*scaleFactor);
            }
            emp.scale.x += 0.1*scaleFactor;
            emp.scale.y += 0.1*scaleFactor;
            emp.visible = true;
            emp.rotation += 0.1;
            emp.x = rocket.x;
            emp.y = rocket.y;
            energyBar.width -= energyToFire/5;
            for(var i = 0; i < enemies.length; i++) {
                var enemy = enemies[i];
                if(getDistance(enemy.x,enemy.y,emp.x,emp.y) < emp.width/2 && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    explode(1,{x:enemy.x,y:enemy.y});
                    enemy.health -= 0.1;
                }
            }
        } else {
            emp.visible = false;
        }
        if(keys.l && energyBar.width > 0 && canUseLaser) {
            laserGraphics.visible = true;
            for(var i = 0; i < enemies.length; i++) {
                var enemy = enemies[i];
                var enemyRect = {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height/2, width: enemy.width, height: enemy.height};
                var laserRect = {x:laserGraphics.x-25,y:laserGraphics.y-innerHeight*2,width:50,height:innerHeight*2};
                if(hitTestRectangle(laserRect,enemyRect) && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    explode(1,{x:enemy.x,y:enemy.y});
                    enemy.health -= 0.1;
                }
            }
            energyBar.width -= energyToFire/4;
        } else {
            laserGraphics.visible = false;
        }
        if(energyBar.width > Math.abs(rocket.vx/100) + Math.abs(rocket.vy/100)) {
            if(rocket.x > rocket.width/2 && rocket.vx < 0) {
                rocket.x += rocket.vx*scaleFactor;
            } else if(rocket.x + rocket.width/2 < innerWidth && rocket.vx > 0) {
                rocket.x += rocket.vx*scaleFactor;
            }

            if(rocket.y > rocket.height/2 && rocket.vy < 0) {
                rocket.y += rocket.vy*scaleFactor;
            } else if(rocket.y + rocket.height/2 < innerHeight && rocket.vy > 0) {
                rocket.y += rocket.vy*scaleFactor;
            }
            energyBar.width -= Math.abs(rocket.vx/100)*(energyToFire/5) + Math.abs(rocket.vy/100)*(energyToFire/5);
            laserGraphics.x = rocket.x;
            laserGraphics.y = rocket.y;
        }

        for(var i = 0; i < missiles.length; i++) {
            var missile = missiles[i];
            if(missile === undefined) {
                break;
            }
            --missile.health;
            if((missile.target ? missile.target.health <= 0 : true) || missile.target.level === "nursing-mother" || missile.target.level === "bossattack") {
                debugger;
                var closestEnemy;
                var closestDist = Infinity;
                for(let i = 0; i < enemies.length; i++) {
                    var enemy = enemies[i];
                    if(getDistance(missile.x,missile.y,enemy.x,enemy.y) < closestDist && enemy.alpha === 1) {
                        closestDist = getDistance(rocket.x,rocket.y,enemy.x,enemy.y)
                        closestEnemy = enemy;
                    }
                }
                if(closestEnemy) {
                    missile.target = closestEnemy;
                } else {
                    explode(1,{x:missile.x,y:missile.y});
                    app.stage.removeChild(missile);
                    missiles.splice(i,1);
                    --i;
                    break;
                }
            }
            if (missile.health <= 0) {
                explode(1,{x:missile.x,y:missile.y});
                app.stage.removeChild(missile);
                missiles.splice(i,1);
                --i;
            }
            missile.rotation = pointTowards(missile.x,missile.y,missile.target.x,missile.target.y) * Math.PI/180;
            missile.rotation *= -1;
            var missileDirection = radDirection(missile.speed, -missile.rotation + Math.PI);
            missile.x += missileDirection.r*scaleFactor;
            missile.y += missileDirection.u*scaleFactor;
            if(missile.y < -10 || missile.y > innerHeight + 10 || missile.x < 10 || missile.x > innerWidth + 10) {
                app.stage.removeChild(missile);
                missiles.splice(i,1);
                --i;
                continue;
            }
            var missileRect = {x: missile.x-missile.width/2, y: missile.y-missile.height/2,width:missile.width,height:missile.height};
            var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
            if(hitTestRectangle(missileRect, rocketRect) && !missile.good) {
                if(!invincible) {
                    healthBar.width -= healthToHit*3;
                }
                explode(20,{x:missile.x - missile.width, y:missile.y + missile.height});
                app.stage.removeChild(missile);
                missiles.splice(i,1);
                --i;
                continue;
            }
            for(var j = 0; j < enemies.length; j++) { 
                var enemy = enemies[j];
                var enemyRect = {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height/2, width: enemy.width, height: enemy.height};
                if(hitTestRectangle(missileRect, enemyRect) && missile.good && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    enemy.health -= 3;
                    explode(10,{x:missile.x - missile.width, y:missile.y - missile.height});
                    if(enemy.health <= 0) {
                        bigExplosion(100,{x:enemy.x,y:enemy.y});
                    }
                    enemies.forEach(function(enemy){
                        if(getDistance(enemy.x,enemy.y,missile.x,missile.y) < 200) {
                            explode(10,{x:enemy.x, y:enemy.y});
                            enemy.health -= 2;
                        }
                    });
                    app.stage.removeChild(missile);
                    missiles.splice(i,1);
                    --i;
                    j = enemies.length;
                    continue;
                }   
            }
        }

        for(var i = 0; i < lasers.length; i++) {
            var laser = lasers[i];
            var laserDirection = radDirection(20,-laser.rotation + Math.PI);
            laser.x += laserDirection.r*scaleFactor;
            laser.y += laserDirection.u*scaleFactor;
            if(laser.y < -10 || laser.y > innerHeight + 10 || laser.x < 10 || laser.x > innerWidth + 10) {
                app.stage.removeChild(laser);
                lasers.splice(i,1);
                --i;
                continue;
            }
            var laserRect = {x: laser.x-laser.width/2, y: laser.y-laser.height/2,width:laser.width,height:laser.height};
            var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
            if(hitTestRectangle(laserRect, rocketRect) && !laser.good) {
                if(!invincible) {
                    healthBar.width -= healthToHit;
                }
                explode(1,{x:laser.x - laser.width, y:laser.y + laser.height});
                app.stage.removeChild(laser);
                lasers.splice(i,1);
                --i;
                continue;
            }
            for(var j = 0; j < enemies.length; j++) { 
                var enemy = enemies[j];
                var enemyRect = {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height/2, width: enemy.width, height: enemy.height};
                if(hitTestRectangle(laserRect, enemyRect) && laser.good && enemy.level !== "nursing-mother" && enemy.level !== "bossattack") {
                    enemy.health--;
                    explode(1,{x:laser.x - laser.width/2, y:laser.y - laser.height/2});
                    if(enemy.health <= 0) {
                        explode(20,{x:enemy.x,y:enemy.y});
                    }
                    app.stage.removeChild(laser);
                    lasers.splice(i,1);
                    --i;
                    j = enemies.length;
                    continue;
                }   
            }
        }
        for(var i = 0; i < formations.length; i++) {
            var formation = formations[i];
            var inSight = false;
            var closestEnemy;
            var closestDist = Infinity;
            formation.forEach(function(enemy){
                if(enemy.health >= 0) {
                    if(enemy.x + enemy.width/2 < rocket.x) {
                    } else if(enemy.x - enemy.width/2 > rocket.x) {
                    } else {
                        inSight = true;
                    }
                    if(getDistance(rocket.x,rocket.y, enemy.x, enemy.y) < closestDist) {
                        closestDist = getDistance(rocket.x,rocket.y, enemy.x, enemy.y);
                        closestEnemy = enemy;
                    }
                }
            });
            var movement = {x:0, y:0}
            if(!inSight) {
                if(closestEnemy) {
                    if(closestEnemy.x < rocket.x) {
                        movement.x = 3;
                    } else {
                        movement.x = -3;
                    }
                } else {
                    formations.splice(i,1);
                    --i;
                }
            }
            formation.forEach(function(child){
                child.formationMovement = movement;
            })
        }
        for(var i = 0; i < enemies.length; i++) {
            var enemy = enemies[i];
            if(enemy.health > 0) {
                if(enemy.level === "easy") {
                    if(enemy.y < innerHeight + 200) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    } else {
                        enemy.y = -400;
                    }
                    if(enemy.x + 5 < rocket.x) {
                        enemy.x += 1.5 * difficulty*scaleFactor;
                    } else if(enemy.x - 5 > rocket.x) {
                        enemy.x -= 1.5 * difficulty*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "boss1") {
                    if(enemy.y < innerHeight + 200) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    } else {
                        enemy.y = -400;
                    }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 10*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 10*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        launchMissile("bad", {x:enemy.x + enemy.width/3, y: enemy.y}, rocket, 7.5)
                        launchMissile("bad", {x:enemy.x - enemy.width/3, y: enemy.y}, rocket, 7.5);
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "medium") {
                    if(enemy.y < 100) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    }
                    if(Math.abs(rocket.x - enemy.x) < 300) {
                        if((rocket.x > enemy.x || (innerWidth - rocket.x < 300)) && rocket.x >= 300) {
                            enemy.x -= 3 * difficulty*scaleFactor;
                        } else {
                            enemy.x += 3 * difficulty*scaleFactor;
                        }
                    }
                    if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x - enemy.width / 3, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        shootLaser("bad", {x:enemy.x + enemy.width / 3, y: enemy.y}, pointTowards(enemy.x,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "boss2") {
                    enemy.rotation = (0-pointTowards(enemy.x,enemy.y,rocket.x,rocket.y)) * Math.PI/180;
                    if(enemy.y < innerHeight/2) {
                        enemy.y += 1.5 * difficulty*scaleFactor;
                    }
                    if(Date.now() - enemy.burstRate > enemy.burstFire) {
                        if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                            enemy.bursts--;
                            shootLaser("bad", {x:enemy.x - enemy.width / 3, y: enemy.y}, pointTowards(enemy.x - enemy.width/6,enemy.y,rocket.x,rocket.y) * Math.PI/180);
                            shootLaser("bad", {x:enemy.x + enemy.width / 3, y: enemy.y}, pointTowards(enemy.x + enemy.width/6,enemy.y,rocket.x,rocket.y) * Math.PI/180)
                            enemy.lastFire = Date.now();
                            if(enemy.bursts === 0) {
                                enemy.bursts = 25;
                                enemy.burstFire = Date.now();
                            }
                        }
                    }
                    if(Date.now() - enemy.empRate > enemy.empFire) {
                        --enemy.energy;
                        if(!enemyEMP.visible) {
                            enemyEMP.scale.set(0.5*scaleFactor);
                        }
                        enemyEMP.visible = true;
                        enemyEMP.x = enemy.x;
                        enemyEMP.y = enemy.y;
                        enemyEMP.scale.x += 0.1*scaleFactor;
                        enemyEMP.scale.y += 0.1*scaleFactor;
                        enemyEMP.rotation += 0.1;
                        if(getDistance(rocket.x,rocket.y,enemyEMP.x,enemyEMP.y) < enemyEMP.width/2) {
                            if(!invincible) {
                                healthBar.width -= healthToHit/8;
                            }
                            explode(1,rocket);
                        }
                        if(enemy.energy <= 0) {
                            enemy.energy = innerWidth/10;
                            enemyEMP.visible = false;
                            enemy.empFire = Date.now();
                        }
                    }
                } else if(enemy.level === "drone") {
                    if(enemy.y < innerHeight + 200) {
                        enemy.y += 5 * difficulty*scaleFactor;
                    } else {
                        enemy.y = -400;
                    }
                    if(enemy.formationMovement) {
                        enemy.x += enemy.formationMovement.x*scaleFactor;
                        enemy.y += enemy.formationMovement.y*scaleFactor;
                    }
                    if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x + 10, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x - 10, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x + enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x - enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        enemy.lastFire = Date.now();
                    }
                } else if(enemy.level === "boss3") {
                    if(enemy.y < 100) {
                        enemy.y += 5 * difficulty*scaleFactor;
                    }
                    if(enemy.x + enemy.xOffset + 15 < rocket.x) {
                        enemy.x += 2.5*scaleFactor;
                    } else if(enemy.x + enemy.xOffset - 15 > rocket.x) {
                        enemy.x -= 2.5*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x + 10, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x - 10, y: enemy.y}, 180 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x + enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x - enemy.width/2, y: enemy.y}, 180 * Math.PI/180);
                        enemy.lastFire = Date.now();
                    }

                    if(Date.now() - enemy.backupRate > enemy.backupFire) {
                        spawnNewFormation("drone", "V", 1);
                        enemy.backupFire = Date.now();
                    }
                    if(Date.now() - enemy.laserRate > enemy.laserFire) {
                        --enemy.energy;
                        enemy.laser.visible = true;
                        enemy.laser.x = enemy.x;
                        enemy.laser.y = enemy.y;
                        var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                        var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                        if(hitTestRectangle(laserRect,rocketRect)) {
                            explode(1,{x:rocket.x,y:rocket.y});
                            if(!invincible) {
                                healthBar.width -= 1;
                            }
                        }
                        if(enemy.energy <= 0) {
                            enemy.laser.visible = false;
                            enemy.energy = 150;
                            enemy.laserFire = Date.now();
                        }
                    }
                } else if(enemy.level === "mothership") {
                    if(enemy.alpha < 1) {
                        enemy.alpha += 0.001;
                    }
                    if(enemy.scale.x < 3) {
                        enemy.scale.x += 0.01*scaleFactor;
                        enemy.scale.y += 0.01*scaleFactor;
                    }
                    if(enemy.health < 10) {

                        enemy.level = "nursing-mother";
                        enemy.waitTime = Date.now();
                        enemy.waitRate = 40000 * difficulty;
                        enemy.backupRate = 20000;
                        enemy.backupFire = Date.now() - 150000;
                        enemy.laser.visible = false;
                        enemy.laserRate = 40000 * difficulty;
                        enemy.health = Infinity;
                    }
                    if(enemy.y < 150) {
                        enemy.y += 1*scaleFactor;
                    }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 5*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 5*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                        enemy.lastFire = Date.now();
                    }

                    if(Date.now() - enemy.laserRate > enemy.laserFire && enemy.level !== "nursing-mother") {
                        --enemy.energy;
                        enemy.laser.visible = true;
                        enemy.laser.x = enemy.x;
                        enemy.laser.y = enemy.y;
                        var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                        var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                        if(hitTestRectangle(laserRect,rocketRect)) {
                            explode(1,{x:rocket.x,y:rocket.y});
                            if(!invincible) {
                                healthBar.width -= 1;
                            }
                        }
                        if(enemy.energy <= 0) {
                            enemy.laser.visible = false;
                            enemy.energy = 150;
                            enemy.laserFire = Date.now();
                        }
                    }
                } else if(enemy.level === "nursing-mother") {
                    if(enemy.waitTime + enemy.waitRate < Date.now() && enemies.length === 1) {
                        enemy.level = "missileship";
                        enemy.health = 250*difficulty;
                        enemy.lastFire = Date.now();
                    }
                    if(enemy.alpha > 0.5) {
                        enemy.alpha -= 0.001;
                    }
                    if(enemy.scale.x > 1*scaleFactor) {
                        enemy.scale.x -= 0.01*scaleFactor;
                        enemy.scale.y -= 0.01*scaleFactor;
                    }
                    // if(enemy.y > -350) {
                        // enemy.y -= 3;
                    // }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 2*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 2*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                        // shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                        // enemy.lastFire = Date.now();
                    }
                    if(Date.now() - enemy.backupRate > enemy.backupFire && (enemy.waitTime + enemy.waitRate > Date.now())) {
                        var formationTypeToSummon = randInt(1,6);
                        if(formationTypeToSummon < 2) {
                            spawnNewFormation("drone", "V", 7);
                        } else if(formationTypeToSummon < 3) {
                            spawnNewFormation("drone", "N", 7);
                        } else if(formationTypeToSummon < 4) {
                            spawnNewEnemy(10, "easy");
                        } else if(formationTypeToSummon < 5) {
                            spawnNewEnemy(4, "medium");
                        } else if(formationTypeToSummon < 6) {
                            spawnNewEnemy(4, "medium");
                            spawnNewEnemy(4, "easy");
                        } else {
                            spawnNewFormation("drone", "V", 5);
                            spawnNewFormation("drone", "N", 5);
                        }
                        enemy.backupFire = Date.now();
                    }
                    if(Date.now() - enemy.laserRate > enemy.laserFire) {
                        // --enemy.energy;
                        // enemy.laser.visible = true;
                        // enemy.laser.x = enemy.x;
                        // enemy.laser.y = enemy.y;
                        // var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                        // var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                        // if(hitTestRectangle(laserRect,rocketRect)) {
                        //     explode(1,{x:rocket.x,y:rocket.y});
                        //     if(!invincible) {
                        //         healthBar.width -= 1;
                        //     }
                        // }
                        // if(enemy.energy <= 0) {
                        //     enemy.laser.visible = false;
                        //     enemy.energy = 150;
                        //     enemy.laserFire = Date.now();
                        // }
                    }
                    
                } else if(enemy.level === "missileship") {
                    if(enemy.alpha < 1) {
                        enemy.alpha += 0.001;
                    }
                    if(enemy.scale.x < 3*scaleFactor) {
                        enemy.scale.x += 0.01*scaleFactor;
                        enemy.scale.y += 0.01*scaleFactor;
                    }
                    if(enemy.health < 10) {
                        
                        enemy.level = "bossattack";
                        enemy.waitTime = Date.now();
                        enemy.waitRate = 40000 * difficulty;
                        enemy.backupRate = 20000;
                        enemy.backupFire = Date.now() - 150000;
                        enemy.laser.visible = false;
                        // enemy.laserRate = 40000 * difficulty;
                        enemy.health = Infinity;
                        enemy.bossesToSpawn = 3;

                    }
                    if(enemy.y < 150) {
                        enemy.y += 1*scaleFactor;
                    }
                    if(enemy.x + 15 < rocket.x) {
                        enemy.x += 5*scaleFactor;
                    } else if(enemy.x - 15 > rocket.x) {
                        enemy.x -= 5*scaleFactor;
                    } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                        shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                        launchMissile("bad", {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                        launchMissile("bad", {x: enemy.x + enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                        launchMissile("bad", {x: enemy.x, y: enemy.y + enemy.height / 2.1}, rocket, 5);
                        enemy.lastFire = Date.now();
                    }

                    // if(Date.now() - enemy.laserRate > enemy.laserFire && enemy.level !== "nursing-mother") {
                    //     --enemy.energy;
                    //     enemy.laser.visible = true;
                    //     enemy.laser.x = enemy.x;
                    //     enemy.laser.y = enemy.y;
                    //     var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                    //     var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                    //     if(hitTestRectangle(laserRect,rocketRect)) {
                    //         explode(1,{x:rocket.x,y:rocket.y});
                    //         if(!invincible) {
                    //             healthBar.width -= 1;
                    //         }
                    //     }
                    //     if(enemy.energy <= 0) {
                    //         enemy.laser.visible = false;
                    //         enemy.energy = 150;
                    //         enemy.laserFire = Date.now();
                    //     }
                    } else if(enemy.level === "bossattack") {
                        if(enemy.alpha > 0.5) {
                            enemy.alpha -= 0.001;
                        }
                        if(enemy.scale.x > 1*scaleFactor) {
                            enemy.scale.x -= 0.01*scaleFactor;
                            enemy.scale.y -= 0.01*scaleFactor;
                        }
                        if(enemies.length === 1) {
                            if(enemy.bossesToSpawn === 3) {
                                --enemy.bossesToSpawn;
                                spawnNewEnemy(1, "boss1");
                            } else if(enemy.bossesToSpawn === 2) {
                                spawnNewEnemy(1, "boss2");
                                --enemy.bossesToSpawn;
                            } else if(enemy.bossesToSpawn === 1) {
                                spawnNewEnemy(1, "boss3")[0].xOffset = 200;
                                spawnNewEnemy(1, "boss3")[0].xOffset = -200;
                                spawnNewEnemy(1, "boss3")[0].xOffset = 0;
                                --enemy.bossesToSpawn;
                            } else {
                                enemy.level = "maxxforce";
                                enemy.health = 250*difficulty;
                                enemy.lastFire = Date.now();
                                enemy.empFire = Date.now();
                                enemy.empRate = 17500/difficulty;
                                enemy.EMPenergy = innerWidth / 10;
                            }
                        }
                        if(enemy.alpha > 0.5) {
                            enemy.alpha -= 0.001;
                        }
                        if(enemy.scale.x > 1*scaleFactor) {
                            enemy.scale.x -= 0.01*scaleFactor;
                            enemy.scale.y -= 0.01*scaleFactor;
                        }
                        // if(enemy.y > -350) {
                            // enemy.y -= 3;
                        // }
                        if(enemy.x + 15 < rocket.x) {
                            enemy.x += 2*scaleFactor;
                        } else if(enemy.x - 15 > rocket.x) {
                            enemy.x -= 2*scaleFactor;
                        } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                            // shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                            // enemy.lastFire = Date.now();
                        }
                        // if(Date.now() - enemy.backupRate > enemy.backupFire && (enemy.waitTime + enemy.waitRate > Date.now())) {
                        //     var formationTypeToSummon = randInt(1,6);
                        //     if(formationTypeToSummon < 2) {
                        //         spawnNewFormation("drone", "V", 7);
                        //     } else if(formationTypeToSummon < 3) {
                        //         spawnNewFormation("drone", "N", 7);
                        //     } else if(formationTypeToSummon < 4) {
                        //         spawnNewEnemy(10, "easy");
                        //     } else if(formationTypeToSummon < 5) {
                        //         spawnNewEnemy(4, "medium");
                        //     } else if(formationTypeToSummon < 6) {
                        //         spawnNewEnemy(4, "medium");
                        //         spawnNewEnemy(4, "easy");
                        //     } else {
                        //         spawnNewFormation("drone", "V", 5);
                        //         spawnNewFormation("drone", "N", 5);
                        //     }
                        //     enemy.backupFire = Date.now();
                        // }
                        if(Date.now() - enemy.laserRate > enemy.laserFire) {
                            // --enemy.energy;
                            // enemy.laser.visible = true;
                            // enemy.laser.x = enemy.x;
                            // enemy.laser.y = enemy.y;
                            // var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                            // var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                            // if(hitTestRectangle(laserRect,rocketRect)) {
                            //     explode(1,{x:rocket.x,y:rocket.y});
                            //     if(!invincible) {
                            //         healthBar.width -= 1;
                            //     }
                            // }
                            // if(enemy.energy <= 0) {
                            //     enemy.laser.visible = false;
                            //     enemy.energy = 150;
                            //     enemy.laserFire = Date.now();
                            // }
                        }
                    } else if(enemy.level === "maxxforce") {
                        if(enemy.alpha < 1) {
                            enemy.alpha += 0.001;
                        }
                        if(enemy.scale.x < 3*scaleFactor) {
                            enemy.scale.x += 0.01*scaleFactor;
                            enemy.scale.y += 0.01*scaleFactor;
                        }
                        if(enemy.health < 5) {
                            
                            state = win;
                            textDiv.innerHTML = "You win!";
                        }
                        if(enemy.y < 150) {
                            enemy.y += 1*scaleFactor;
                        }
                        if(enemy.x + 15 < rocket.x) {
                            enemy.x += 5*scaleFactor;
                        } else if(enemy.x - 15 > rocket.x) {
                            enemy.x -= 5*scaleFactor;
                        } else if(Date.now() - enemy.reloadTime > enemy.lastFire) {
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 190 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 195 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 185 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 200 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 170 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 160 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 180 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 175 * Math.PI/180);
                            shootLaser("bad", {x:enemy.x, y: enemy.y}, 165 * Math.PI/180);
                            launchMissile("bad", {x: enemy.x - enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                            launchMissile("bad", {x: enemy.x + enemy.width/2, y: enemy.y - enemy.height / 2.1}, rocket, 5);
                            launchMissile("bad", {x: enemy.x, y: enemy.y + enemy.height / 2.1}, rocket, 5);
                            enemy.lastFire = Date.now();
                        }

                        if(Date.now() - enemy.empRate > enemy.empFire) {
                            --enemy.EMPenergy;
                            if(!enemyEMP.visible) {
                                enemyEMP.scale.set(0.5*scaleFactor);
                            }
                            enemyEMP.visible = true;
                            enemyEMP.x = enemy.x;
                            enemyEMP.y = enemy.y;
                            enemyEMP.scale.x += 0.1*scaleFactor;
                            enemyEMP.scale.y += 0.1*scaleFactor;
                            enemyEMP.rotation += 0.1;
                            if(getDistance(rocket.x,rocket.y,enemyEMP.x,enemyEMP.y) < enemyEMP.width/2) {
                                if(!invincible) {
                                    healthBar.width -= healthToHit/8;
                                }
                                explode(1,rocket);
                            }
                            if(enemy.EMPenergy <= 0) {
                                enemy.EMPenergy = innerWidth/10;
                                enemyEMP.visible = false;
                                enemy.empFire = Date.now();
                            }
                        }
                        if(Date.now() - enemy.laserRate > enemy.laserFire && enemy.level !== "nursing-mother") {
                            --enemy.energy;
                            enemy.laser.visible = true;
                            enemy.laser.x = enemy.x;
                            enemy.laser.y = enemy.y;
                            var laserRect = {x:enemy.laser.x-25,y:enemy.laser.y,width:50,height:innerHeight*2};
                            var rocketRect = {x: rocket.x - rocket.width/2, y: rocket.y - rocket.height/2, width: rocket.width, height: rocket.height};
                            if(hitTestRectangle(laserRect,rocketRect)) {
                                explode(1,{x:rocket.x,y:rocket.y});
                                if(!invincible) {
                                    healthBar.width -= 1;
                                }
                            }
                            if(enemy.energy <= 0) {
                                enemy.laser.visible = false;
                                enemy.energy = 150;
                                enemy.laserFire = Date.now();
                            }
                        }
                    }
            } else {
                enemy.alpha -= 0.05;
                enemyEMP.visible = false;
                if (enemy.alpha <= 0) {
                    if(enemy.level === "boss1" && enemies[0].level !== "bossattack") {
                        healthBar.width = 200;
                        healthToHit -= 2;
                        energyToFire--;
                        energyBar.width = 200;
                        boss1.fade(0.5,0, 3000);
                        setTimeout(function() {
                            music.fade(0, 0.5, 3000);
                        },3000);
                        canUseMissiles = true;
                    }
                    if(enemy.level === "boss2" && enemies[0].level !== "bossattack") {
                        healthBar.width = 200;
                        healthToHit -= 2;
                        energyToFire--;
                        energyBar.width = 200;
                        boss2.fade(0.5,0, 3000);
                        setTimeout(function() {
                            music.fade(0, 0.5, 3000);
                        },3000);
                        canUseEMP = true;
                    } else if(enemy.level === "boss3" && enemy.xOffset === 0 && enemies[0].level !== "bossattack") {
                        var foundEnemy1 = false;
                        var foundEnemy2 = false;
                        enemies.forEach(function(bad) {
                            if(bad.xOffset === -200) {
                                foundEnemy1 = bad;
                            } else if(bad.xOffset === 200) {
                                foundEnemy2 = bad;
                            }
                        });
                        if(foundEnemy1) {
                            foundEnemy1.xOffset = 0;
                        } else if(foundEnemy2) {
                            foundEnemy2.xOffset = 0;
                        } else {
                            healthBar.width = 200;
                            reloadTime /= 2;
                            energyBar.width = 200;
                            boss3.fade(0.5,0, 3000);
                            setTimeout(function() {
                                music.fade(0, 0.5, 3000);
                            },3000);
                        }
                        canUseLaser = true;
                    }
                    if(enemy.laser) {
                        enemy.laser.visible = false;
                    }
                    app.stage.removeChild(enemy);
                    enemies.splice(i,1);
                    --i;
                }
            }
        }
        if(enemies.length === 0) {
            ++level;
            difficulty += 0.05;
            if(level < 6) {
                spawnNewEnemy(level, "easy");
            } else if (level < 6.1) {
                spawnNewEnemy(1, "boss1");
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    boss1.play();
                    boss1.fade(0,0.5,2000);
                }, 2000);
            } else if(level < 8) {
                spawnNewEnemy(2, "medium");
            } else if(level < 10) {
                spawnNewEnemy(3, "medium");
            } else if(level < 11) {
                spawnNewEnemy(4, "medium");
            } else if(level < 11.1) {
                spawnNewEnemy(1, "boss2");
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    boss2.play();
                    boss2.fade(0,0.5,2000);
                }, 2000);
            } else if(level < 12) {
                spawnNewFormation("drone", "V", 4);
            } else if(level < 13) {
                spawnNewFormation("drone", "N", 5);
            } else if(level < 14) {
                spawnNewFormation("drone", "V", 7);
            } else if (level < 15) {
                spawnNewFormation("drone", "N", 9);
            } else if(level < 16) {
                spawnNewFormation("drone", "N", 5);
                spawnNewFormation("drone", "V", 5);
            } else if(level < 16.1) {
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    boss3.play();
                    boss3.fade(0,0.5,2000);
                }, 2000);
                spawnNewEnemy(1, "boss3")[0].xOffset = 200;
                spawnNewEnemy(1, "boss3")[0].xOffset = -200;
                spawnNewEnemy(1, "boss3")[0].xOffset = 0;
            } else if(fullLevel) {
                spawnNewEnemy(1, "mothership");
                if(levelEl.selectedIndex === 0) {
                    difficulty = 1;
                    invincible = true;
                } else if(levelEl.selectedIndex === 1) {
                    difficulty = 0.25;
                } else if(levelEl.selectedIndex === 2) {
                    difficulty = 0.5;
                } else if(levelEl.selectedIndex === 3) {
                    difficulty = 0.75;
                } else if(levelEl.selectedIndex === 4) {
                    difficulty = 1;
                } else if(levelEl.selectedIndex === 5) {
                    difficulty = 1.25;
                }
                music.fade(0.5,0,2000);
                setTimeout(function(){
                    mothership.play();
                    mothership.fade(0,0.5,2000);
                }, 2000);
            } else {
                spawnNewEnemy(level/3.5, "medium");
                spawnNewEnemy(level/3.5, "easy");
            }
        }
        for(var i = 0; i < explosions.length; i++) {
            explosions[i].alpha -= 0.05;
            if(explosions[i].alpha <= 0) {
                app.stage.removeChild(explosions[i]);
                explosions.splice(i,1);
                --i;
            }
        }
    }
    var formations = [];
    function spawnNewFormation(type, formation, endSize) {
        var set = [];
        if(formation === "V") {
            var counter = Math.floor((innerWidth/2-100)/100);
            for(var i = ((Math.ceil(innerWidth/200) * 100 ) -endSize*100); i < innerWidth/2; i+=100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                --counter;
            }
            // i += 100;
            for(i; i < innerWidth/2 + endSize*100; i += 100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                ++counter;
            }
        } else if(formation === "N") {
            var counter = Math.floor((innerWidth/2-100)/100);
            for(var i = ((Math.ceil(innerWidth/200) * 100 ) -endSize*100); i < innerWidth/2; i+=100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                ++counter;
            }
            // i += 100;
            for(i; i < innerWidth/2 + endSize*100; i += 100) {
                set.push(spawnNewEnemy(1, type, {x:i, y: counter*-100-200})[0])
                --counter;
            }
        }
        for(let i = 0; i < set.length; i++) {
            set[i].formation = set;
            set[i].formationMovement = {x:0,y:0};
        }
        console.log(set)
        formations.push(set);
    }
    function spawnNewEnemy(amount, type, position) {
        var y = -200;
        var enemiesAdded = [];
        console.log(amount, type, position);
        for(let i = 0; i < amount; i++) {
            if(type === "easy") {
                var enemy = new Sprite(resources["sprites/enemy.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = y;
                }
                enemy.rotation = Math.PI;
                enemy.health = randInt(0.5,1.5) * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 3000/difficulty;
            } else if (type === "medium") {
                var enemy = new Sprite(resources["sprites/medium.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = y;
                }
                enemy.rotation = Math.PI;
                enemy.health = randInt(5,7) * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 5000/difficulty;
            } else if(type === "boss1") {
                var enemy = new Sprite(resources["sprites/boss1.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 15 * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 5000/difficulty;
                if(enemies[0]) {
                    if(enemies[0].level === "bossattack") {
                        enemy.health *= 3;
                    }
                }
            } else if(type === "boss2") {
                var enemy = new Sprite(resources["sprites/boss2.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = innerWidth/2;
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 20 * difficulty;
                enemy.burstFire = 0;
                enemy.burstRate = 10000/difficulty;
                enemy.lastFire = Date.now();
                enemy.reloadTime = 100/difficulty;
                enemy.empFire = Date.now();
                enemy.empRate = 17500/difficulty;
                enemy.bursts = 25;
                enemy.energy = innerWidth/10;
                if(enemies[0]) {
                    if(enemies[0].level === "bossattack") {
                        enemy.health *= 3;
                    }
                }
            } else if(type === "drone") {
                var enemy = new Sprite(resources["sprites/drone.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = y;
                }
                enemy.rotation = Math.PI;
                enemy.health = randNum(0.1,0.5) * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 3000/difficulty;
            } else if(type === "boss3") {
                var enemy = new Sprite(resources["sprites/boss3.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 15 * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 5000/difficulty;
                enemy.laserFire = Date.now();
                enemy.laserRate = 10000/difficulty;
                enemy.energy = 150;
                enemy.backupFire = Date.now() - randInt(0, 30000);
                enemy.backupRate = 55000/difficulty;
                enemy.laser = new PIXI.Graphics();
                enemy.laser.beginFill(0xffaaaa);
                enemy.laser.drawRect(-25,0,50, innerHeight * 2);
                app.stage.addChild(enemy.laser);
                enemy.laser.visible = false;
                if(enemies[0]) {
                    if(enemies[0].level === "bossattack") {
                        enemy.health *= 1.5;
                    }
                }
            } else if(type === "mothership") {
                var enemy = new Sprite(resources["sprites/mothership.png"].texture);
                app.stage.addChild(enemy);
                enemy.scale.set(3*scaleFactor);
                enemy.anchor.set(0.5,0.5);
                if(position) {
                    enemy.x = position.x;
                    enemy.y = position.y;
                } else {
                    enemy.x = randInt(100, innerWidth - 100);
                    enemy.y = -600;
                }
                enemy.rotation = Math.PI;
                enemy.health = 100 * difficulty;
                enemy.lastFire = 0;
                enemy.reloadTime = 2500/difficulty;
                enemy.laserFire = Date.now();
                enemy.laserRate = 5000/difficulty;
                enemy.energy = 200;
                enemy.backupFire = Date.now() - randInt(0, 30000);
                enemy.backupRate = 55000/difficulty;
                enemy.laser = new PIXI.Graphics();
                enemy.laser.beginFill(0xffaaaa);
                enemy.laser.drawRect(-25,0,50, innerHeight * 2);
                app.stage.addChild(enemy.laser);
                enemy.laser.visible = false;
            }
            enemiesAdded.push(enemy);
            enemy.level = type;
            enemies.push(enemy);
            y -= 150 + randInt(25,100);
        }
        return enemiesAdded;
    }
    function launchMissile(type, position, target, speed) {
        if(type === "good") {
            var laser = new Sprite(resources["sprites/missile.png"].texture);
            laser.good = true;
        } else {
            /// TODO: Red
            var laser = new Sprite(resources["sprites/missile.png"].texture);
            laser.good = false;
        }
        laser.speed = speed;
        laser.x = position.x;
        laser.y = position.y;
        laser.anchor.set(0.5,0.5);
        if(type === "good") {
            laser.health = 300;
        } else {
            laser.health = 200;
        }
        laser.target = target;
        missiles.push(laser);
        app.stage.addChild(laser);
    }
    function shootLaser(type, position, dir) {
        if(type === "good") {
            var laser = new Sprite(resources["sprites/laser.png"].texture);
            laser.good = true;
        } else {
            /// TODO: Red
            var laser = new Sprite(resources["sprites/enemy-laser.png"].texture);
            laser.good = false;
        }
        laser.x = position.x;
        laser.y = position.y;
        laser.anchor.set(0.5,0.5);
        laser.scale.set(3*scaleFactor);
        laser.rotation = -dir;
        lasers.push(laser);
        app.stage.addChild(laser);
    }
    function press(key){
        if(keys[key]){
            keys[key] = false;
            return true;
        }
        return false;
    }
    addEventListener("mousedown",function(e){
        if(e.button == 0) {
            keys.mouse = true;
        } else if(e.button == 2) {
            keys.rightMouse = true;
        }
        mouseX = e.pageX;
        mouseY = e.pageY;
    });
    addEventListener("mouseup",function(e){
        if(e.button == 0) { 
            keys.mouse = false;
        } else if(e.button == 2) {
            keys.rightMouse = true;
        }
    });
    addEventListener("blur", function (){
        keys = {};
    });
    addEventListener("mousemove",function(e){
        mouseX = e.pageX;
        mouseY = e.pageY;
    });
    var learnSpeed = 2;
    var answersLocked = false;
    var code = ["R", "E", "S", "T", "O", "R", "E"];
    var codeNum = 0;
    addEventListener("keydown", function (e){
        if(code[codeNum] === e.key) {
            ++codeNum;
            if(codeNum === code.length) {
                codeNum = 0;
                healthBar.width = 200;
                energyBar.width = 200;
                if(!invincible) {
                    invincible = true;
                    rocket.alpha = 0.5;
                    setTimeout(function() {
                        invincible = false;
                        rocket.alpha = 1;
                    }, 5000);
                }
            }
        }
        if(!answersLocked && ((Number(e.key) >= 0 && e.key !== " ") || e.key === "." || e.key === ":")) {
            numDiv.innerHTML += e.key;
        }
        if(e.key === "Enter" && !answersLocked) {
            if (numDiv.innerHTML === correctAnswer || (chapter !== false && (correctAnswer.split(".")[1] === numDiv.innerHTML)) || numDiv.innerHTML.replace(" ",".") === correctAnswer || numDiv.innerHTML.replace(":",".") === correctAnswer) { 
                if(energyBar.width + 40 > 200) {
                    healthBar.width += (energyBar.width + 40 - 200)/3;
                    energyBar.width = 200;
                } else {
                    energyBar.width += 40;
                }
                if(healthBar.width > 200) {
                    healthBar.width = 200;
                }
                numDiv.innerHTML = "";
                --questionsLeft;
                if(questionsLeft <= 0) {
                    if(chapter !== false) {
                        var range = rangeDiv.innerHTML;
                        var full = true;
                        if(range.split("-")[0] === "1") {
                            var arr = range.split(/\-|\,/);
                            if(Number(arr[1]) + 3 < rom18[chapter-1].length) {
                                range = (Number(arr[1])) + "-" + (Number(arr[1]) + 3);
                            } else if(Number(arr[1]) < rom18[chapter-1].length) {
                                range = arr[1] + "-" + rom18[chapter-1].length;
                            } else {
                                fullLevel = true;
                            }
                            full = false;
                        } else {
                            var arr = range.split(/\-|\,/);
                            range = "1-" + arr[1];
                        }
                        rangeDiv.innerHTML = range;
                        var cur = range.split(/\-|\,/);
                        if(Number(cur[0]) < Number(cur[1]) && Number(cur[0]) >= 0) {
                            if(Number(cur[1]) <= rom18[chapter-1].length) {
                                params.min = cur[0];
                                params.max = cur[1];
                            }
                        }
                        if(full) {
                            questionsLeft = params.max/learnSpeed;
                        } else {
                            questionsLeft = params.max/(2*learnSpeed);
                        }
                    } else {
                        fullLevel = true;
                    }
                }
            } else {
                answersLocked = true;
                numDiv.style.color = "red";
                var corAns = correctAnswer;
                setTimeout(function() {
                    numDiv.style.color = "green";
                    numDiv.innerHTML = corAns;
                },1000);
                setTimeout(function() {
                    numDiv.style.color = "white";
                    numDiv.innerHTML = "";
                    answersLocked = false;
                },2000);
            }

            curVerse = randVerse();
            correctAnswer = curVerse[0];
            curVerse = curVerse[1];
            textDiv.innerHTML = curVerse;
        }
        if(e.key === "Delete" || e.key === "Backspace") {
            numDiv.innerHTML = "";
        }
        keys[e.key] = true;
    });
    addEventListener("keyup", function (e){
        keys[e.key] = false;
    });
  </script>
</body>
</html>